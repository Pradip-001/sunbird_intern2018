"use strict";angular.module("playerApp").controller("GenericEditorController",["config","$stateParams","toasterService","$sce","$state","$timeout","$rootScope","contentService","permissionsService","workSpaceUtilsService","searchService",function(e,o,n,t,r,i,a,d,c,l,s){var g=this;g.contentId=_.isUndefined(o.contentId)||_.isNull(o.contentId)?"":o.contentId,g.framework=o.framework,g.setContext=function(){window.context={user:{id:a.userId,name:a.firstName+" "+a.lastName,orgIds:a.organisationIds},sid:a.sessionId,contentId:g.contentId,pdata:{id:org.sunbird.portal.appid,ver:"1.0",pid:"sunbird-portal"},tags:_.concat([],org.sunbird.portal.channel),channel:org.sunbird.portal.channel,env:"genericeditor",framework:g.framework},g.openGenericEditor()},g.openGenericEditor=function(){$("#genericEditor").iziModal({title:"",iframe:!0,iframeURL:"/thirdparty/bower_components/generic-editor-iframe/index.html",navigateArrows:!1,fullscreen:!1,openFullscreen:!0,closeOnEscape:!1,overlayClose:!1,overlay:!1,history:!1,overlayColor:"",onClosed:function(){g.openModel()}}),window.config={corePluginsPackaged:!0,modalId:"genericEditor",dispatcher:"local",apislug:"/action",alertOnUnload:!0,headerLogo:_.isUndefined(a.orgLogo)?"":a.orgLogo,loadingImage:"",plugins:[{id:"org.ekstep.sunbirdcommonheader",ver:"1.4",type:"plugin"},{id:"org.ekstep.metadata",ver:"1.0",type:"plugin"},{id:"org.ekstep.sunbirdmetadata",ver:"1.0",type:"plugin"}],previewConfig:{repos:["/content-plugins/renderer"],plugins:[{id:"org.sunbird.player.endpage",ver:1,type:"plugin"}],showEndPage:!1}},s.updateReqForChannelFilter()&&(window.config.searchCriteria=s.updateReqForChannelFilter()),i(function(){$("#genericEditor").iziModal("open")},100)},a.$on("$stateChangeStart",function(e,o,n,t){if("GenericEditor"===t.name){"opened"===$("#genericEditor").iziModal("getState")&&document.getElementById("genericEditor").remove()}}),g.openModel=function(){g.showModal=!0,$("#modalGenericEditor").modal("show"),i(function(){l.hideRemoveModel("#modalGenericEditor"),document.getElementById("genericEditor")&&document.getElementById("genericEditor").remove(),document.getElementById("modalGenericEditor")&&document.getElementById("modalGenericEditor").remove(),g.showModal=!1,o.state?r.go(o.state):a.contentModelBackLinkName?r.go(a.contentModelBackLinkName):r.go("WorkSpace.AllUploadedContent")},2e3)},g.getFramework=function(){s.getChannel().then(function(e){"OK"===e.responseCode?(window.context.framework=e.result.channel.defaultFramework,g.framework=e.result.channel.defaultFramework):window.context.framework=null,g.setContext()}).catch(function(e){g.setContext(),console.log("error is ......",e)})},o.framework?g.setContext():g.getFramework()}]);