"use strict";angular.module("playerApp").controller("NoteListCtrl",["$rootScope","noteService","$state","$stateParams","$timeout","$q","toasterService",function(e,o,t,s,d,a,r){function n(t){var s="searchApi";i[s]={},i[s].loader=r.loader("",e.messages.stmsg.m0057),o.search(t).then(function(o){o&&o.responseCode===i.successResponseCode?(i[s].loader.showLoader=!1,i.notesList=o.result.response.note||[],i.selectedNoteData=i.notesList[0],i.showNoteList(i.notesList[0])):(i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0033))}).catch(function(){i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0033)})}var i=this;i.userId=e.userId,i.userName=e.firstName+" "+e.lastName,i.courseId=s.courseId,i.contentId=s.contentId,i.contentName=s.contentName,i.add={},i.update={},i.update.showUpdateNote=!1,i.add.showCreateNote=!1,i.sortBy="desc",i.successResponseCode="OK",i.getAllNotes=function(){n({request:{filters:{userId:i.userId,courseId:i.courseId,contentId:i.contentId},sort_by:{updatedDate:i.sortBy}}})},i.createNote=function(t){var s="createApi";i[s]={},i[s].loader=r.loader("",e.messages.stmsg.m0054);var d={request:{note:t.note,userId:i.userId,title:t.title,courseId:i.courseId,contentId:i.contentId,createdBy:i.userName,updatedBy:i.userId}};o.create(d).then(function(o){if(o&&o.responseCode===i.successResponseCode){i.add.showCreateNote=!1,i[s].loader.showLoader=!1;var t=angular.copy(d.request);t.createdDate=(new Date).toISOString(),t.updatedDate=(new Date).toISOString(),t.id=o.result.id,i.add={},i.notesList.push(t),i.showNoteList(t)}else i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0030)}).catch(function(){i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0030)})},i.removeNote=function(t){var s="removeApi";i[s]={},i[s].loader=r.loader("",e.messages.stmsg.m0056);var d={noteId:t};o.remove(d).then(function(o){o&&o.responseCode===i.successResponseCode?(i.hideRemoveNoteModel(),i.notesList=i.notesList.filter(function(e){return e.id!==t}),i[s].loader.showLoader=!1,i.showNoteList(i.notesList[i.notesList.length-1],i.notesList.length-1)):(i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0032))}).catch(function(){i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0032)})},i.openRemoveNoteModel=function(e){i.removeNoteId=e,i.showRemoveNoteModel=!0,d(function(){$("#removeNoteModal").modal({}).modal("show")},10)},i.hideRemoveNoteModel=function(){$("#removeNoteModal").modal("hide"),$("#removeNoteModal").modal("hide all"),$("#removeNoteModal").modal("hide other"),$("#removeNoteModal").modal("hide dimmer"),i.removeNoteId="",i.showRemoveNoteModel=!1},i.updateNote=function(t){var s={noteId:t.id,request:{note:t.note,title:t.title,tags:t.tags,updatedBy:i.userId}},d="updateApi";i[d]={},i[d].loader=r.loader("",e.messages.stmsg.m0059),o.update(s).then(function(o){if(o&&o.responseCode===i.successResponseCode){i.notesList=i.notesList.filter(function(e){return e.id!==t.id});var s=angular.copy(t);s.updatedDate=(new Date).toISOString(),i.notesList.push(s),i[d].loader.showLoader=!1,i.update={},i.showNoteList(s)}else i[d].loader.showLoader=!1,r.error(e.messages.fmsg.m0034)}).catch(function(){i[d].loader.showLoader=!1,r.error(e.messages.fmsg.m0034)})},i.closeNoteList=function(){var e={};i.courseId&&i.contentId?(e={courseId:i.courseId,contentId:i.contentId,lectureView:"no"},t.go("Toc",e)):i.courseId?(e={courseId:i.courseId,lectureView:"yes"},t.go("Toc",e)):i.contentId&&(e={contentId:i.contentId,contentName:i.contentName},t.go("Player",e))},i.updateNoteData=function(e){i.update.metaData=angular.copy(e)},i.showNoteList=function(e,o){i.selectedIndex=o,"0"!==i.selectedIndex?$("#notelistcontent0").removeClass("notelistborder"):$("#notelistcontent0").addClass("notelistborder"),i.selectedNoteData=e},i.insertImage=function(){var e=a.defer();return i.openAddImageModal(function(o){o?e.resolve(o):e.reject()}),e.promise},i.openAddImageModal=function(e){i.showAddImageModal=!0,$(".wmd-prompt-background").css("z-index",0),$(".wmd-prompt-background").css("position","initial"),d(function(){$("#showAddImageModal").modal({onShow:function(){i.imageLink="http://"},onHide:function(){return i.showAddImageModal=!1,e(i.imageLink)}}).modal("show")},10)},i.closeAddImageModal=function(e){e&&(i.imageLink=""),$("#showAddImageModal").modal("hide"),$("#showAddImageModal").modal("hide others"),$("#showAddImageModal").modal("hide all"),$("#showAddImageModal").modal("hide dimmer")}}]);