"use strict";angular.module("playerApp").controller("orgDashboardController",["$rootScope","$scope","$timeout","$state","$stateParams","toasterService","adminService","QueryService","Visualizer",function(e,r,a,o,t,n,i,s,d){function g(e){u.showLoader=e}var u=this;u.height=110,u.datasetPreviousValue="creation";var c=new d({type:"line"});$("#dropdownMenu").dropdown();var l=new s.CreateNewInstance({eid:"downloadReport"});u.getAdminDashboardData=function(e){g(!0);var r="creation"===u.datasetPreviousValue?new s.CreateNewInstance({eid:"orgCreation"}):new s.CreateNewInstance({eid:"orgConsumption"});u.showDataDiv=!1,u.showOrgWarningDiv=!1,u.timePeriod=e||"7d",r.getData({identifier:u.orgId,timePeriod:u.timePeriod}).then(function(e){u.graphArray=c.render(e),u.numericStatArray=e.numericData,u.showDataDiv=!0,g(!1)}).catch(function(e){g(!1),n.error(e.params.errmsg)})},u.onAfterFilterChange=function(e){if(u.timePeriod===e)return!1;u.getAdminDashboardData(e)},u.onAfterDatasetChange=function(e){if(u.datasetPreviousValue===e)return!1;u.datasetPreviousValue=e,u.getAdminDashboardData()},u.showData=function(){if(u.orgIds=e.organisationIds,1===u.orgIds.length)u.orgId=u.orgIds[0],u.getAdminDashboardData();else{u.showOrgWarningDiv=!0;var r={request:{filters:{id:u.orgIds}}};i.orgSearch(r).then(function(e){if("OK"===e.responseCode){var r=[];_.forEach(e.result.response.content,function(e){r.push({organisationId:e.id,orgName:e.orgName})}),u.orgDetails=r}else n.error(e.params.errmsg)}).catch(function(){n.error(e.messages.emsg.m0005)})}},u.initDropdwon=function(){$("#dashboardMenu").dropdown({onChange:function(){}})},u.onAfterOrgChange=function(e){u.orgId=e,u.getAdminDashboardData()},u.downloadReport=function(){u.disabledClass=!0;var r="creation"===u.datasetPreviousValue?"ORG_CREATION":"ORG_CONSUMPTION";l.download({identifier:u.orgId,timePeriod:u.timePeriod},r).then(function(r){u.downloadReportText=e.messages.stmsg.m0095,$("#downloadReportModal").modal({closable:!0,observeChanges:!0}).modal("show"),u.disabledClass=!1}).catch(function(e){u.disabledClass=!1,n.error(e.params.errmsg)})}}]);