"use strict";angular.module("playerApp").controller("courseConsumptionDashboardCtrl",["$rootScope","$scope","$state","$stateParams","toasterService","searchService","QueryService","Visualizer","telemetryService",function(e,r,t,o,s,n,i,a,u){function c(e){d.showLoader=e}var d=this;d.chartHeight=110,c(!0);var l=new i.CreateNewInstance({eid:"courseConsumption"}),f=new a({type:"line"});d.getCourseDashboardData=function(e){c(!0),d.timePeriod=e||"7d",l.getData({identifier:d.courseIdentifier,timePeriod:d.timePeriod}).then(function(e){d.data=f.render(e),d.consumptionNumericData=e.numericData,c(!1),d.showError=!1}).catch(function(e){d.showErrors()})},d.onAfterFilterChange=function(e){if(d.timePeriod===e)return!1;d.getCourseDashboardData(e)},d.loadData=function(){var r={filters:{status:["Live"],createdBy:e.userId,contentType:["Course"]},sort_by:{lastUpdatedOn:"desc"}};d.myCoursesList=[],n.search(r).then(function(e){e&&"OK"===e.responseCode?e.result.content&&e.result.content.length>0?(d.myCoursesList=e.result.content,d.buildMyCoursesDropdown(),d.version=e.ver):c(!1):d.showErrors()}).catch(function(e){d.showErrors()}),d.generateImpressionEvent("dasboard","profile-course-creator-dashboard","/course-creator-dashboard","profile",d.version)},d.buildMyCoursesDropdown=function(){if(1===d.myCoursesList.length){var e=_.first(_.values(d.myCoursesList),1);d.courseIdentifier=e.identifier,d.courseName=e.name,d.getCourseDashboardData("7d")}else c(!1),d.isMultipleCourses=d.myCoursesList.length>1},d.showErrors=function(){d.showError=!0,c(!1)},d.onAfterCourseChange=function(e){if(d.courseIdentifier===e)return!1;d.courseIdentifier=e,d.isMultipleCourses=!1,d.getCourseDashboardData(d.timePeriod)},d.initDropdwon=function(){$("#myCoursesListFilter").dropdown()},d.generateImpressionEvent=function(r,t,o,s,n){var i={env:s,rollup:u.getRollUpData(e.organisationIds)},a={id:"",type:r,ver:n},c={edata:u.impressionEventData("view","scroll",t,o),context:u.getContextData(i),object:u.getObjectData(a),tags:_.concat([],org.sunbird.portal.channel)};u.impression(c)}}]);