"use strict";angular.module("playerApp").controller("contentBadgeController",["$timeout","$state","$rootScope","$scope","workSpaceUtilsService","telemetryService","badgeService","permissionsService","$q","toasterService",function(e,s,t,d,o,a,n,i,r,g){var l=this;l.showBadgeAssingModel=!1,l.selectedBadgeList=d.data&&d.data.badgeAssertions||[],l.type="content",l.contentId=d.contentid,l.getAllBadges=function(){var e={request:{filters:{issuerList:[],rootOrgId:t.rootOrgId,type:l.type,roles:i.getCurrentUserRoles()}}};n.getAllBadgesList(e).then(function(e){e&&"OK"===e.responseCode?l.allBadgeList=_.differenceBy(e.result.badges,l.selectedBadgeList,"badgeId"):g.error(t.messages.fmsg.m0078)}).catch(function(){g.error(t.messages.fmsg.m0078)})},l.hideContentBadgeModal=function(){$("#badgeAssignModel").modal("hide"),$("#badgeAssignModel").modal("hide all"),$("#badgeAssignModel").modal("hide dimmer")},l.initializeModal=function(s){l.showBadgeAssingModel=!0,e(function(){$("#badgeAssignModel").modal({onHide:function(){l.showBadgeAssingModel=!1,l.selectedBadge={}},onShow:function(){l.selectedBadge=s}}).modal("show")},0)},l.assignBadge=function(e){var s={issuerId:e.issuerId,badgeId:e.badgeId,recipientId:l.contentId,recipientType:l.type};n.addBadges({request:s}).then(function(s){s&&"OK"===s.responseCode?(l.hideContentBadgeModal(),g.success(t.messages.smsg.moo42),l.selectedBadgeList.push(e),l.allBadgeList=l.allBadgeList.filter(function(s){return s.badgeId!==e.badgeId})):g.error(t.messages.fmsg.m0079)}).catch(function(){g.error(t.messages.fmsg.m0079)})}}]);