"use strict";angular.module("playerApp").controller("PublishedContentController",["contentService","searchService","config","$rootScope","$state","toasterService","$scope","workSpaceUtilsService","$timeout","PaginationService","telemetryService",function(e,t,o,n,r,s,a,i,l,d,c){function m(e,t,o,n){var r={};return r.showError=!0,r.isClose=e,r.message=t,r.messageType=o,n&&(r.messageText=n),r}var u=this;u.userId=n.userId,u.status=["Live"],u.sortBy="desc",a.isSelected=!1,u.selectedContentItem=[],u.pageLimit=9,u.pager={},u.getPublishedContent=function(e){e=e||1,u.loader=s.loader("",n.messages.stmsg.m0021),u.error={};var r={filters:{status:u.status,createdBy:u.userId,objectType:"Content",contentType:o.contributeContentType},sort_by:{lastUpdatedOn:u.sortBy},offset:(e-1)*u.pageLimit,limit:u.pageLimit};t.search(r).then(function(t){t&&"OK"===t.responseCode?(u.error.showError=!1,u.loader.showLoader=!1,u.pager=d.GetPager(t.result.count,e,u.pageLimit),u.publishedContentData=t.result.content||[],u.totalCount=t.result.count,u.pageNumber=e,u.version=t.ver,0===u.publishedContentData.length&&(u.error=m(!0,n.messages.stmsg.m0022,n.messages.stmsg.m0008))):(u.error.showError=!1,u.loader.showLoader=!1,s.error(n.messages.fmsg.m0013))}).catch(function(){u.error.showError=!1,u.loader.showLoader=!1,s.error(n.messages.fmsg.m0013)})},u.openContentPlayer=function(e){i.openContentEditor(e,r.current.name)},u.initializeUIElement=function(){$("#actionDropDown").dropdown()},u.openRemoveContentModel=function(e){u.removeContentId=e,u.showRemoveContentModel=!0,l(function(){$("#removeContentModel").modal({}).modal("show")},10)},u.hideRemoveContentModel=function(){i.hideRemoveModel("#removeContentModel"),u.removeContentId="",u.showRemoveContentModel=!1},u.deleteContent=function(t){var o=[t];u.hideRemoveContentModel(),u.loader=s.loader("",n.messages.stmsg.m0034);var r={contentIds:o};e.retire(r).then(function(e){e&&"OK"===e.responseCode?(u.loader.showLoader=!1,u.selectedContentItem=[],s.success(n.messages.smsg.m0006),u.publishedContentData=i.removeContentLocal(u.publishedContentData,o),u.pager=d.GetPager(u.totalCount-o.length,u.pageNumber,u.pageLimit),0===u.publishedContentData.length&&u.getPublishedContent(u.pager.currentPage)):(u.loader.showLoader=!1,s.error(n.messages.fmsg.m0022))}).catch(function(){u.loader.showLoader=!1,s.error(n.messages.fmsg.m0022)})},u.setPage=function(e){e<1||e>u.pager.totalPages||u.getPublishedContent(e)},u.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})},u.generateInteractEvent=function(e,t,o,n){c.interactTelemetryData(n,o,e,u.version,e,t)};var g=[];u.lineInView=function(e,t,o,n){var r=_.filter(g,function(e){return e.objid===o.identifier});!0===t&&0===r.length&&g.push({objid:o.identifier,objtype:o.contentType||"workspace",section:n,index:e}),console.log("------",g),c.setVisitData(g)}}]);