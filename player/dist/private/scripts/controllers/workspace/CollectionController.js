"use strict";angular.module("playerApp").controller("CollectionController",["contentService","$timeout","$state","config","$rootScope","toasterService","$scope",function(e,o,t,n,a,l,r){var c=this;c.showCreateCollectionModel=!1,c.isCollectionCreated=!1,c.userId=a.userId,c.mimeType="application/vnd.ekstep.content-collection",c.defaultName="Untitled collection",c.contentType="Collection",c.resourceType="Collection",c.initializeModal=function(){c.showCreateCollectionModel=!0,o(function(){$("#createCollectionModel").modal({observeChanges:!0,onHide:function(){c.data={},c.isCollectionCreated||t.go("WorkSpace.ContentCreation")}}).modal("show")},10)},c.hideCreateCollectionModel=function(){$("#createCollectionModel").modal("hide"),$("#createCollectionModel").modal("hide others"),$("#createCollectionModel").modal("hide dimmer")},c.createCollection=function(o){c.loader=l.loader("",a.messages.stmsg.m0016),e.create(o).then(function(e){e&&"OK"===e.responseCode?(c.isCollectionCreated=!0,c.showCreateCollectionModel=!1,c.loader.showLoader=!1,c.hideCreateCollectionModel(),c.initEKStepCE(e.result.content_id)):(c.loader.showLoader=!1,l.error(a.messages.fmsg.m0010))}).catch(function(){c.loader.showLoader=!1,l.error(a.messages.fmsg.m0010)})},c.saveMetaData=function(e,o){c.framework=o;var t=angular.copy(e);t.name=t.name?t.name:c.defaultName,t.mimeType=c.mimeType,t.createdBy=c.userId,t.contentType=c.contentType,t.resourceType=c.resourceType,t.framework=c.framework;var n={content:t};c.createCollection(n)},c.initEKStepCE=function(e){var o={contentId:e,type:"Collection",framework:c.framework};t.go("CollectionEditor",o)};var i=a.$on("CreateCollection",function(e,o){c.saveMetaData(o.Data,o.framework)});r.$on("$destroy",function(){i()})}]);