"use strict";angular.module("playerApp").controller("AllUploadedContentController",["contentService","searchService","config","$rootScope","$state","toasterService","$scope","workSpaceUtilsService","$timeout","PaginationService","telemetryService",function(e,t,o,n,r,a,s,l,i,d,c){function m(e,t,o,n){var r={};return r.showError=!0,r.isClose=e,r.message=t,r.messageType=o,n&&(r.messageText=n),r}var p=this;p.userId=n.userId,p.contentStatus=["Draft","FlagDraft"];var g=o.MIME_TYPE;p.contentMimeType=[g.pdf,g.youtube,g.html,g.ePub,g.h5p,g.mp4,g.webm],p.sortBy="desc",s.isSelected=!1,p.selectedContentItem=[],p.pageLimit=9,p.pager={},p.getAllUploadedContent=function(e){e=e||1,p.loader=a.loader("",n.messages.stmsg.m0023),p.error={};var r={filters:{status:p.contentStatus,createdBy:p.userId,mimeType:p.contentMimeType,contentType:o.contributeContentType},sort_by:{lastUpdatedOn:p.sortBy},offset:(e-1)*p.pageLimit,limit:p.pageLimit};t.search(r).then(function(t){t&&"OK"===t.responseCode?(p.loader.showLoader=!1,p.error.showError=!1,p.totalCount=t.result.count,p.pageNumber=e,p.version=t.ver,p.allUploadedContentData=t.result.content||[],p.pager=d.GetPager(t.result.count,e,p.pageLimit),0===p.allUploadedContentData.length&&(p.error=m(!0,n.messages.stmsg.m0024,n.messages.stmsg.m0008))):(p.error.showError=!1,p.loader.showLoader=!1,a.error(n.messages.fmsg.m0014))}).catch(function(){p.error.showError=!1,p.loader.showLoader=!1,a.error(n.messages.fmsg.m0014)})},p.openContentEditor=function(e){l.openContentEditor(e,r.current.name)},p.initializeUIElement=function(){$("#actionDropDown").dropdown()},p.openRemoveContentModel=function(e){p.removeContentId=e,p.showRemoveContentModel=!0,i(function(){$("#removeContentModel").modal({}).modal("show")},10)},p.hideRemoveContentModel=function(){l.hideRemoveModel("#removeContentModel"),p.removeContentId="",p.showRemoveContentModel=!1},p.deleteContent=function(t){var o=[t];p.hideRemoveContentModel(),p.loader=a.loader("",n.messages.stmsg.m0034);var r={contentIds:o};e.retire(r).then(function(e){e&&"OK"===e.responseCode?(p.loader.showLoader=!1,p.selectedContentItem=[],p.version=e.ver,a.success(n.messages.smsg.m0006),p.allUploadedContentData=l.removeContentLocal(p.allUploadedContentData,o),p.pager=d.GetPager(p.totalCount-o.length,p.pageNumber,p.pageLimit),0===p.allUploadedContentData.length&&p.getAllUploadedContent(p.pager.currentPage)):(p.loader.showLoader=!1,a.error(n.messages.fmsg.m0022))}).catch(function(){p.loader.showLoader=!1,a.error(n.messages.fmsg.m0022)})},p.setPage=function(e){e<1||e>p.pager.totalPages||p.getAllUploadedContent(e)},p.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})},p.generateInteractEvent=function(e,t,o,n){c.interactTelemetryData(n,o,e,p.version,e,t)};var u=[];p.lineInView=function(e,t,o,n){var r=_.filter(u,function(e){return e.objid===o.identifier});!0===t&&0===r.length&&u.push({objid:o.identifier,objtype:o.contentType||"workspace",section:n,index:e}),console.log("------",u),c.setVisitData(u)}}]);