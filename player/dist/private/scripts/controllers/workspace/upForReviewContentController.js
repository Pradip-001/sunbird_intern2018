"use strict";angular.module("playerApp").controller("UpForReviewContentController",["contentService","searchService","config","$rootScope","$scope","$state","$timeout","toasterService","PaginationService","workSpaceUtilsService","configService","permissionsService","telemetryService",function(e,r,t,s,a,o,n,c,i,p,l,d,h){var u=this;u.filterDropDown=l.getWorkspaceUpforReviewdrpdwn(),u.userId=s.userId,u.contentStatus=["Review"],u.channelId="sunbird",u.sortBy="desc",a.contentPlayer={isContentPlayerEnabled:!1},u.pageLimit=9,u.pager={},u.typingTimer=-1,u.doneTypingInterval=1e3,u.search={},u.search.mediums=u.filterDropDown.languages,u.search.contentTypes=u.filterDropDown.contentTypes,u.search.subjects=u.filterDropDown.subjects,u.search.grades=u.filterDropDown.grades,u.search.boards=u.filterDropDown.boards,u.search.medium=u.filterDropDown.medium,u.search.sortingOptions=t.upForReviewSortingOptions,u.search.sortIcon=!0,u.search.selectedMedium=[],u.search.selectedContentType=[],u.search.selectedBoard=[],u.search.selectedSubject=[],u.search.selectedGrades=[],u.search.appliedMedium=[],u.search.appliedContentType=[],u.search.appliedBoard=[],u.search.appliedSubject=[],u.search.appliedGrades=[],$("#sortByDropDown").dropdown(),u.showErrorMessage=function(e,r,t,s){var a={};return a.showError=!0,a.isClose=e,a.message=r,a.messageType=t,s&&(a.messageText=s),a},u.keyUp=function(){clearTimeout(u.typingTimer),u.typingTimer=setTimeout(u.getUpForReviewContent,u.doneTypingInterval)},u.keyDown=function(){clearTimeout(u.typingTimer)},u.search.selectFilter=function(e,r,t){n(function(){var s=u.search[e].indexOf(r);-1===s?(u.search[e].push(r),$(t.target).addClass("active")):(u.search[e].splice(s,1),$(t.target).removeClass("active"))},0)},u.search.removeFilterSelection=function(e,r,t){u.hideFilter();var s=u.search[e].indexOf(r),a=u.search[t].indexOf(r);-1!==s&&-1!==a&&(u.search[e].splice(s,1),u.search[t].splice(a,1),u.getUpForReviewContent(1),u.showSelectedChips())},u.search.applySorting=function(){var e=u.search.sortByOption;u.search.sortBy={},u.search.sortBy[e]=!0===u.search.sortIcon?"asc":"desc",u.getUpForReviewContent(1)},u.search.resetFilter=function(){u.search.selectedMedium=[],u.search.selectedContentType=[],u.search.selectedBoard=[],u.search.selectedSubject=[],u.search.selectedGrades=[],u.search.appliedMedium=[],u.search.appliedContentType=[],u.search.appliedBoard=[],u.search.appliedSubject=[],u.search.appliedGrades=[],u.getUpForReviewContent(1)},u.getRequestObject=function(e){var r=d.getRoleOrgMap(),s={filters:{status:u.contentStatus,createdFor:d.getRoleOrgMap()&&_.compact(_.union(r.CONTENT_REVIEWER,r.BOOK_REVIEWER,r.FLAG_REVIEWER)),objectType:"Content",contentType:t.contributeContentType,createdBy:{"!=":u.userId}},sort_by:{lastUpdatedOn:u.sortBy},offset:(e-1)*u.pageLimit,limit:u.pageLimit};return u.searchText&&(s.query=u.searchText),u.appliedFilter?(u.isShowAppliedFilter=!0,(u.search.selectedMedium&&u.search.selectedMedium.length>0||u.search.appliedMedium&&u.search.appliedMedium.length>0)&&(u.search.appliedMedium=angular.copy(u.search.selectedMedium),s.filters.medium=u.search.appliedMedium),(u.search.selectedContentType&&u.search.selectedContentType.length>0||u.search.appliedContentType&&u.search.appliedContentType.length>0)&&(u.search.appliedContentType=angular.copy(u.search.selectedContentType),s.filters.contentType=u.search.appliedContentType),(u.search.selectedBoard&&u.search.selectedBoard.length>0||u.search.appliedBoard&&u.search.appliedBoard.length>0)&&(u.search.appliedBoard=angular.copy(u.search.selectedBoard),s.filters.board=u.search.appliedBoard),(u.search.selectedSubject&&u.search.selectedSubject.length>0||u.search.appliedSubject&&u.search.appliedSubject.length>0)&&(u.search.appliedSubject=angular.copy(u.search.selectedSubject),s.filters.subject=u.search.appliedSubject),(u.search.selectedGrades&&u.search.selectedGrades.length>0||u.search.appliedGrades&&u.search.appliedGrades.length>0)&&(u.search.appliedGrades=angular.copy(u.search.selectedGrades),s.filters.gradeLevel=u.search.appliedGrades)):u.isShowAppliedFilter=!0,u.search.sortBy&&(s.sort_by=u.search.sortBy),-1===_.indexOf(d.getCurrentUserRoles(),"BOOK_REVIEWER")&&(s.filters.contentType=_.without(s.filters.contentType,"TextBook")),-1===_.indexOf(d.getCurrentUserRoles(),"CONTENT_REVIEWER")&&-1!==_.indexOf(d.getCurrentUserRoles(),"BOOK_REVIEWER")&&(s.filters.contentType=["TextBook"]),-1!==_.indexOf(d.getCurrentUserRoles(),"FLAG_REVIEWER")&&(s.filters.status=["FlagReview"],s.filters.contentType.push("TextBook")),-1===_.indexOf(d.getCurrentUserRoles(),"FLAG_REVIEWER")||-1===_.indexOf(d.getCurrentUserRoles(),"BOOK_REVIEWER")&&-1===_.indexOf(d.getCurrentUserRoles(),"CONTENT_REVIEWER")||(s.filters.status=["FlagReview","Review"]),s},u.showSelectedChips=function(){return!(!(u.search.appliedMedium.length>0||u.search.appliedContentType.length>0||u.search.appliedBoard.length>0||u.search.appliedSubject.length>0||u.search.appliedGrades.length>0)||!u.appliedFilter)&&(console.log(u.search),!0)},u.getUpForReviewContent=function(e){e=e||1,u.loader=c.loader("",s.messages.stmsg.m0032),u.error={};var t=u.getRequestObject(e);u.hideFilter(),r.search(t).then(function(r){r&&"OK"===r.responseCode?(u.loader.showLoader=!1,u.error.showError=!1,u.upForReviewContentData=[],u.version=r.ver,r.result.content&&(u.upForReviewContentData=r.result.content),u.totalCount=r.result.count,u.pager=i.GetPager(r.result.count,e,u.pageLimit),0===u.upForReviewContentData.length&&(u.error=u.showErrorMessage(!0,s.messages.stmsg.m0033,s.messages.stmsg.m0008))):(u.loader.showLoader=!1,u.error.showError=!1,c.error(s.messages.fmsg.m0021))}).catch(function(){u.loader.showLoader=!1,u.error.showError=!1,c.error(s.messages.fmsg.m0021)})},u.openContentPlayer=function(e){p.openContentPlayer(e,o.current.name)},u.setPage=function(e){e<1||e>u.pager.totalPages||u.getUpForReviewContent(e)},u.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})},u.generateInteractEvent=function(e,r){h.interactTelemetryData("workspace",r,e,u.version,e,"workspace-content-upforreview")},u.search.getSelectedContentTypeValue=function(e,r){var t=_.filter(e,function(e){return e.key===r});return t?t[0].value:""},u.showFilterPopup=function(){u.search.selectedMedium=angular.copy(u.search.appliedMedium),u.search.selectedContentType=angular.copy(u.search.appliedContentType),u.search.selectedBoard=angular.copy(u.search.appliedBoard),u.search.selectedSubject=angular.copy(u.search.appliedSubject),u.search.selectedGrades=angular.copy(u.search.appliedGrades),u.hideFilterPopup=!0,$("#showFilterButton").popup({popup:$("#showFilterPopup"),on:"click",position:"bottom right",color:"#4183c4"})},u.hideFilter=function(){u.hideFilterPopup=!1};var g=[];u.lineInView=function(e,r,t,s){var a=_.filter(g,function(e){return e.objid===t.identifier});!0===r&&0===a.length&&g.push({objid:t.identifier,objtype:t.contentType||"workspace",section:s,index:e}),console.log("------",g),h.setVisitData(g)}}]);