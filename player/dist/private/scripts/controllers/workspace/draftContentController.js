"use strict";angular.module("playerApp").controller("DraftContentController",["contentService","searchService","config","$rootScope","$state","toasterService","$scope","workSpaceUtilsService","$timeout","PaginationService","telemetryService",function(e,t,o,r,n,s,a,i,c,m,l){function d(e,t,o,r){var n={};return n.showError=!0,n.isClose=e,n.message=t,n.messageType=o,r&&(n.messageText=r),n}var g=this;g.userId=r.userId,g.status=["Draft","FlagDraft"],g.mimeType=["application/vnd.ekstep.ecml-archive","application/vnd.ekstep.content-collection"],g.sortBy="desc",a.isSelected=!1,g.selectedContentItem=[],g.pageLimit=9,g.pager={},g.error={},g.getDraftContent=function(e){e=e||1,g.loader=s.loader("",r.messages.stmsg.m0011);var n={filters:{status:g.status,createdBy:g.userId,mimeType:g.mimeType,contentType:o.contributeContentType},sort_by:{lastUpdatedOn:g.sortBy},offset:(e-1)*g.pageLimit,limit:g.pageLimit};t.search(n).then(function(t){t&&"OK"===t.responseCode?(g.loader.showLoader=!1,g.error.showError=!1,g.totalCount=t.result.count,g.pageNumber=e,g.version=t.ver,g.draftContentData=t.result.content||[],g.pager=m.GetPager(t.result.count,e,g.pageLimit),0===g.draftContentData.length&&(g.error=d(!0,r.messages.stmsg.m0012,r.messages.stmsg.m0008))):(g.loader.showLoader=!1,g.error.showError=!1,s.error(r.messages.fmsg.m0006))}).catch(function(){g.loader.showLoader=!1,g.error.showError=!1,s.error(r.messages.fmsg.m0006)})},g.openContentEditor=function(e){i.openContentEditor(e,n.current.name)},g.openRemoveContentModel=function(e){g.removeContentId=e,g.showRemoveContentModel=!0,c(function(){$("#removeContentModel").modal({}).modal("show")},10)},g.hideRemoveContentModel=function(){i.hideRemoveModel("#removeContentModel"),g.removeContentId="",g.showRemoveContentModel=!1},g.deleteContent=function(t){var o=[t];g.hideRemoveContentModel(),g.loader=s.loader("",r.messages.stmsg.m0034);var n={contentIds:o};e.retire(n).then(function(e){e&&"OK"===e.responseCode?(g.loader.showLoader=!1,g.selectedContentItem=[],s.success(r.messages.smsg.m0006),g.draftContentData=i.removeContentLocal(g.draftContentData,o),g.pager=m.GetPager(g.totalCount-o.length,g.pageNumber,g.pageLimit),0===g.draftContentData.length&&g.getDraftContent(g.pager.currentPage)):(g.loader.showLoader=!1,s.error(r.messages.fmsg.m0022))}).catch(function(){g.loader.showLoader=!1,s.error(r.messages.fmsg.m0022)})},g.setPage=function(e){e<1||e>g.pager.totalPages||g.getDraftContent(e)},g.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})};var p=[];g.lineInView=function(e,t,o,r){var n=_.filter(p,function(e){return e.objid===o.identifier});!0===t&&0===n.length&&p.push({objid:o.identifier,objtype:o.contentType||"course",section:r,index:e}),console.log("------",p),l.setVisitData(p)}}]);