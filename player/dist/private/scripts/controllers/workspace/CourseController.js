"use strict";angular.module("playerApp").controller("CourseController",["contentService","$timeout","$state","config","$rootScope","toasterService","$scope",function(e,o,r,t,a,n,s){var d=this;d.showCreateCourseModal=!1,d.isCourseCreated=!1,d.userId=a.userId,d.defaultName="Untitled Course",d.mimeType="application/vnd.ekstep.content-collection",d.contentType="Course",d.resourceType="Course",d.hideCreateCourseModal=function(){$("#createCourseModal").modal("hide"),$("#createCourseModal").modal("hide others"),$("#createCourseModal").modal("hide dimmer")},d.initializeModal=function(){d.showCreateCourseModal=!0,o(function(){$("#createCourseModal").modal({observeChanges:!0,onHide:function(){d.data={},d.isCourseCreated||r.go("WorkSpace.ContentCreation")}}).modal("show")},10)},d.createContent=function(o){d.loader=n.loader("",a.messages.stmsg.m0015),e.create(o).then(function(e){e&&"OK"===e.responseCode?(d.isCourseCreated=!0,d.showCreateCourseModal=!1,d.loader.showLoader=!1,d.hideCreateCourseModal(),d.initEKStepCE(e.result.content_id)):(d.loader.showLoader=!1,n.error(a.messages.fmsg.m0009))}).catch(function(){d.loader.showLoader=!1,n.error(a.messages.fmsg.m0009)})},d.saveMetaData=function(e,o){d.framework=o;var r=angular.copy(e);r.name=r.name?r.name:d.defaultName,r.mimeType=d.mimeType,r.createdBy=d.userId,r.contentType=d.contentType,r.resourceType=d.resourceType,r.framework=d.framework;var t={content:r};d.createContent(t)},d.initEKStepCE=function(e){var o={contentId:e,type:"Course",framework:d.framework};r.go("CollectionEditor",o)};var i=a.$on("CreateCourse",function(e,o){d.saveMetaData(o.Data,o.framework)});s.$on("$destroy",function(){i()})}]);