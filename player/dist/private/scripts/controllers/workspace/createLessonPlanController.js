"use strict";angular.module("playerApp").controller("LessonPlanController",["contentService","$timeout","$state","config","$rootScope","toasterService","configService","$scope",function(e,o,n,a,r,t,s,d){var l=this;l.formDropdown=s.getWorkspaceFormDropdown(),l.boards=l.formDropdown.boards,l.mediums=l.formDropdown.medium,l.subjects=l.formDropdown.subjects,l.grades=l.formDropdown.grades,l.showCreateLessonPlanModal=!1,l.isLessonPlanCreated=!1,l.userId=r.userId,l.mimeType="application/vnd.ekstep.content-collection",l.defaultName="Untitled lesson plan",l.contentType="LessonPlan",l.resourceType="Lesson Plan",l.hideCreateLessonPlanModal=function(){$("#createLessonPlanModal").modal("hide"),$("#createLessonPlanModal").modal("hide others"),$("#createLessonPlanModal").modal("hide dimmer")},l.initializeModal=function(){l.showCreateLessonPlanModal=!0,o(function(){$("#boardDropDown").dropdown(),$("#mediumDropDown").dropdown(),$("#subjectDropDown").dropdown(),$("#gradeDropDown").dropdown(),$("#createLessonPlanModal").modal({observeChanges:!0,onHide:function(){l.data={},l.isLessonPlanCreated||n.go("WorkSpace.ContentCreation")}}).modal("show")},10)},l.createContent=function(o){l.loader=t.loader("",r.messages.stmsg.m0050),e.create(o).then(function(e){e&&"OK"===e.responseCode?(l.isLessonPlanCreated=!0,l.showCreateLessonPlanModal=!1,l.loader.showLoader=!1,l.hideCreateLessonPlanModal(),l.initEKStepCE(e.result.content_id)):(l.loader.showLoader=!1,t.error(r.messages.fmsg.m0026))}).catch(function(){l.loader.showLoader=!1,t.error(r.messages.fmsg.m0026)})},l.saveMetaData=function(e,o){l.framework=o;var n=angular.copy(e);n.name=n.name?n.name:l.defaultName,n.mimeType=l.mimeType,n.createdBy=l.userId,n.contentType=l.contentType,n.resourceType=l.resourceType,n.framework=l.framework,n.language&&(n.language=[n.language]);var a={content:n};l.createContent(a)},l.initEKStepCE=function(e){var o={contentId:e,type:l.contentType,framework:l.framework};n.go("CollectionEditor",o)};var c=r.$on("CreateLessonPlan",function(e,o){l.saveMetaData(o.Data,o.framework)});d.$on("$destroy",function(){c()})}]);