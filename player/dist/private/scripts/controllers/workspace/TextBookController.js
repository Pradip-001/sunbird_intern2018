"use strict";angular.module("playerApp").controller("TextBookController",["contentService","$timeout","$state","config","$rootScope","toasterService","searchService","configService","telemetryService","$scope",function(e,o,t,a,r,n,c,s,i,d){var l=this;l.categoryListofFramework={},l.categoryModelList={},l.formDropdown=s.getWorkspaceFormDropdown(),l.years=l.formDropdown.years,l.showCreateTextBookModal=!1,l.isTextBookCreated=!1,l.userId=r.userId,l.mimeType="application/vnd.ekstep.content-collection",l.defaultName="Untitled textbook",l.contentType="TextBook",l.resourceType="Book",l.hideCreateTextBookModal=function(){$("#createTextBookModal").modal("hide"),$("#createTextBookModal").modal("hide others"),$("#createTextBookModal").modal("hide dimmer")},l.initializeModal=function(){l.showCreateTextBookModal=!0,i.impressionTelemetryData("workspace","","textbook","1.0","scroll","workspace-create-textbook","/create/textbook"),o(function(){$("#createTextBookModal").modal({observeChanges:!0,onHide:function(){l.data={},l.isTextBookCreated||t.go("WorkSpace.ContentCreation")}}).modal("show")})},l.createContent=function(o){l.loader=n.loader("",r.messages.stmsg.m0014),e.create(o).then(function(e){e&&"OK"===e.responseCode?(l.isTextBookCreated=!0,l.showCreateTextBookModal=!1,l.loader.showLoader=!1,l.hideCreateTextBookModal(),i.interactTelemetryData("workspace",e.result.content_id,"create-textbook",l.version,"create-textbook","workspace-create-textbook"),l.initEKStepCE(e.result.content_id)):(l.loader.showLoader=!1,n.error(r.messages.fmsg.m0008))}).catch(function(){l.loader.showLoader=!1,n.error(r.messages.fmsg.m0008)})},l.saveMetaData=function(e,o){l.framework=o;var t=angular.copy(e);t.name=t.name?t.name:l.defaultName,t.mimeType=l.mimeType,t.createdBy=l.userId,t.contentType=l.contentType,t.framework=l.framework,t.resourceType=l.resourceType,t.gradeLevel&&""===t.gradeLevel[0]&&delete t.gradeLevel,t.language&&(t.language=[t.language]);var a={content:t};l.createContent(a)},l.initEKStepCE=function(e){var o={contentId:e,type:"TextBook",state:"",framework:l.framework};t.go("CollectionEditor",o)};var m=r.$on("CreateTextbook",function(e,o){l.saveMetaData(o.Data,o.framework)});d.$on("$destroy",function(){m()})}]);