"use strict";angular.module("playerApp").controller("contentFlagController",["contentService","$timeout","$state","config","$rootScope","toasterService","$scope","telemetryService",function(e,o,t,n,a,r,i,s){var l=this;l.showContentFlagModal=!1,l.userId=a.userId,l.userFullName=a.firstName+" "+a.lastName,l.contentId=i.contentid,l.contentName=i.contentname,l.contentVersionKey=i.versionkey,l.reasons=[{name:"Inappropriate content",value:"Inappropriate Content",description:"Hateful, harmful or explicit lesson that is inappropriate for young learners"},{name:"Copyright violation",value:"Copyright Violation",description:"Uses copyrighted work without permission"},{name:"Privacy violation",value:"Privacy Violation",description:"Collects sensitive data or personal information about users, such as name\n address, photo or other personally identifiable information"},{name:"Other",value:"Other"}],l.reasonDescription={},l.flagMessage="course"===i.type?a.frmelmnts.instn.t0018:a.frmelmnts.instn.t0019,l.hideContentFlagModal=function(){$("#contentFlagModal").modal("hide"),$("#contentFlagModal").modal("hide others"),$("#contentFlagModal").modal("hide dimmer")},l.initializeModal=function(){l.showContentFlagModal=!0,s.interactTelemetryData(i.type,i.contentid,i.type,a.version,i.type+"-flag",i.type+"-read"),o(function(){$("#contentFlagModal").modal({onShow:function(){$(".helpPopup").popup({inline:!0})},onHide:function(){l.showContentFlagModal=!1,l.data={}}}).modal("show")},10)},l.createFlag=function(t){l.loader=r.loader("",a.messages.stmsg.m0077),e.flag(t,l.contentId).then(function(e){e&&"OK"===e.responseCode?o(function(){l.loader.showLoader=!1,l.showContentFlagModal=!1,l.hideContentFlagModal(),l.close()},2e3):(l.loader.showLoader=!1,r.error(a.messages.fmsg.m0050))}).catch(function(){l.loader.showLoader=!1,r.error(a.messages.fmsg.m0050)})},l.saveMetaData=function(e){var o={flaggedBy:l.userFullName,versionKey:l.contentVersionKey};e.flagReasons&&(o.flagReasons=[e.flagReasons]),e.comment&&(o.flags=[e.comment]),l.createFlag(o)},l.close=function(){l.hideContentFlagModal(),""!==a.search.searchKeyword?o(function(){a.$emit("initSearch",{})},0):t.go(i.redirect)}}]);