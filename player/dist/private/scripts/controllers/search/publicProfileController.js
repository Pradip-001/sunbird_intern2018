"use strict";angular.module("playerApp").controller("PublicProfileController",["$scope","$rootScope","$stateParams","searchService","toasterService","$timeout","$state","userService",function(e,s,r,o,i,t,n,l){var d=this,a=window.atob(r.userId),u=s.userId;d.profile=function(e){d.loader=i.loader("",s.messages.stmsg.m0005),o.getPublicUserProfile(a,e).then(function(e){if(d.loader.showLoader=!1,"OK"===e.responseCode){d.user=e.result.response,d.user.dob=d.user.dob?new Date(d.user.dob):d.user.dob;var r=void 0!==d.user.skills?d.user.skills:[];r.length&&(r.forEach(function(e){if(e.endorsersUserId=[],e.endorsersList){_.map(e.endorsersList,"userId").forEach(function(s){e.endorsersUserId.push(s)})}}),r.forEach(function(e){e.isEndorsable=!e.endorsersUserId.includes(u)})),d.userSkills=r}else i.error(s.messages.fmsg.m0005)}).catch(function(){d.loader.showLoader=!1,i.error(s.messages.fmsg.m0005)})},d.close=function(){""!==s.search.searchKeyword?t(function(){s.$broadcast("initSearch",{})},500):n.go("Profile")},d.defaultLimit=4,d.limit=d.defaultLimit,d.resetLimit=0,d.setLimit=function(e){d.limit=e<=0?d.userSkills.length:e},d.endorsement=function(e){l.addSkills({request:{skillName:[e],endorsedUserId:a}}).then(function(e){e&&"OK"===e.responseCode?d.profile("endorsement"):i.error(s.messages.fmsg.m0063)})},d.profile()}]);