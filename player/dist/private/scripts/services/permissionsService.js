"use strict";angular.module("playerApp").service("permissionsService",["restfulLearnerService","config","$rootScope",function(e,n,t){var r=this,i=[],o={},s=[],c=[],a=[];this.setRolesAndPermissions=function(e){var n=_.cloneDeep(e.roles);_.forEach(n,function(e,n){var t={role:e.id,actions:[],roleName:e.name};a.push(t),_.forEach(e.actionGroups,function(e){var n={role:e.id,actions:e.actions,roleName:e.name};t.actions=_.concat(t.actions,e.actions),i.push(n)}),i.push(t)}),i=_.uniqBy(i,"role")},this.setCurrentUserRoleMap=function(e){o=e},this.setCurrentUserRoles=function(e){s=e,this.setCurrentRoleActions(e)},this.setCurrentRoleActions=function(e){_.forEach(e,function(e){var n=_.filter(i,{role:e});_.isArray(n)&&n.length>0&&(c=_.concat(c,_.map(n[0].actions,"id")))})},this.checkRolesPermissions=function(e,n){if(s&&s.length>0){if(this.checkActionsPermissions(e,n))return!0;if(_.isArray(e))return 0===_.intersection(e,s).length&&!n||_.intersection(e,s).length>0&&n}return!1},this.checkActionsPermissions=function(e,n){return!!_.isArray(e)&&(!(0===_.intersection(e,c).length&&!n)&&(_.intersection(e,c).length>0&&n))},this.getPermissionsData=function(){return e.get(n.URL.ROLES.READ)},this.allRoles=function(){return i},this.getCurrentUserRoleMap=function(){return o},this.getCurrentUserRoles=function(){return s},this.getCurrentUserProfile=function(){var r=n.URL.USER.GET_PROFILE+"/"+t.userId;return e.get(r)},this.getMainRoles=function(){return a},this.setRoleOrgMap=function(e){var n=[];_.forEach(e.organisations,function(e){n=n.concat(e.roles)}),n=_.uniq(n),this.roleOrgMap={},_.forEach(n,function(n){_.forEach(e.organisations,function(e){r.roleOrgMap[n]=r.roleOrgMap[n]||[],_.indexOf(e.roles,n),r.roleOrgMap[n].push(e.organisationId)})})},this.getRoleOrgMap=function(){return _.cloneDeep(this.roleOrgMap)}}]);