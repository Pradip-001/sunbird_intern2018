"use strict";angular.module("playerApp").factory("sessionService",["$window",function(e){var s=s||JSON.parse(e.sessionStorage.getItem("sbConfig")||"{}");return{getSessionData:function(e){return s[e]},setSessionData:function(t,n){s[t]=n,e.sessionStorage.setItem("sbConfig",JSON.stringify(s))}}}]);
"use strict";angular.module("playerApp").factory("AnnouncementModel",function(){function t(t){this.sourceId=t.sourceid||"",this.attachments=t.attachments||[],this.createdDate=new Date(t.createdDate)||null,this.createdBy=t.userid||null,this.description=this.description||t.description||"",this.from=this.from||t.from||"",this.title=this.title||t.title||"",this.type=this.type||t.type||"",this.links=t.links||[],this.id=t.id||"",this.target=t.target||{},this.target.geo=this.target.geo||{},this.target.geo.ids=this.target.geo.ids||[],this.status=t.status||null}return{Announcement:t}});
"use strict";angular.module("playerApp").service("httpAdapter",["$http","$q","toasterService",function(t,e,r){var n=this;n.httpHeader=function(){var t={"Content-Type":"application/json"};return _.get(org,"sunbird.portal.channel")&&(t["X-Channel-Id"]=org.sunbird.portal.channel),t},this.httpCall=function(r,a,o,i){var p=i||n.httpHeader(),d=e.defer();return t({method:o,url:r,headers:p,data:a}).then(function(t){d.resolve(t.data)},function(t){d.reject(t.data)}),d.promise}}]);
"use strict";angular.module("playerApp").service("announcementAdapter",["$rootScope","$http","httpAdapter","config","$q","toasterService",function(e,n,t,r,s,i){function o(n,r,o,u){var a=s.defer();return t.httpCall(n,r,o,"").then(function(e){e&&"OK"===e.responseCode?a.resolve(e):(i.error(u),a.reject(e))},function(n){i.error(e.messages.emsg.m0005),a.reject(n)}),a.promise}var u={"application/png":"PNG","application/pdf":"PDF","application/jpeg":"JPEG","application/jpg":"JPEG","image/png":"PNG","image/jpeg":"JPEG","image/jpg":"JPEG"};this.getOutBoxAnnouncementList=function(n,t){var s={request:{limit:n,offset:(t-1)*n}};return o(r.URL.ANNOUNCEMENT.OUTBOX_LIST,s,"POST",e.messages.fmsg.m0070)},this.getAnnouncementById=function(n){return o(r.URL.ANNOUNCEMENT.GET_BY_ID+n,"","GET",e.messages.fmsg.m0074)},this.getInboxAnnouncementList=function(n,t){var s={request:{limit:n,offset:(t-1)*n}};return o(r.URL.ANNOUNCEMENT.INBOX_LIST,s,"POST",e.messages.fmsg.m0072)},this.getFileExtension=function(e){return u[e]},this.createAnnouncement=function(e,n){var t={request:{title:e.title,from:e.from,type:e.type,description:e.description,links:e.links,sourceId:e.sourceId,target:e.target,attachments:e.attachments}};return o(n?r.URL.ANNOUNCEMENT.RESEND:r.URL.ANNOUNCEMENT.CREATE,t,"POST")},this.getDefinitions=function(e){var n={request:{rootOrgId:e,definitions:["announcementTypes"]}};return o(r.URL.ANNOUNCEMENT.DEFINITIONS,n,"POST")},this.readAnnouncement=function(n){var t={request:{announcementId:n,channel:"web"}};return o(r.URL.ANNOUNCEMENT.READ,t,"POST",e.messages.fmsg.m0073)},this.receivedAnnouncement=function(e){var n={request:{announcementId:e,channel:"web"}};return o(r.URL.ANNOUNCEMENT.RECEIVED,n,"POST")},this.deleteAnnouncement=function(n){var t={request:{announcementId:n}};return o(r.URL.ANNOUNCEMENT.CANCEL,t,"DELETE",e.messages.fmsg.m0071)},this.getResend=function(e){return o(r.URL.ANNOUNCEMENT.RESEND+e,{},"GET")}}]);
"use strict";angular.module("playerApp").service("restfulContentService",["$http","config","telemetryService","$rootScope",function(t,n,e,a){function o(){var t={"Content-Type":"application/json",cid:"sunbird"};return t.Accept="text/html,application/xhtml+xml,application/xml,application/json;q=0.9,image/webp,*/*;q=0.8",org.sunbird.portal.channel&&(t["X-Channel-Id"]=org.sunbird.portal.channel),t}function r(r,i,l,c,u){var p=c||o(),s=n.URL.BASE_PREFIX+n.URL.CONTENT_PREFIX+r,g={env:e.getConfigData("env"),rollup:e.getRollUpData(a.organisationIds)},d=e.getConfigData("message")||"api call to content service",h={edata:e.logEventData("api_call","INFO",d,""),context:e.getContextData(g),tags:_.concat([],org.sunbird.portal.channel)};return e.log(h),t({method:l,url:s,headers:p,params:u,data:{request:i}})}function i(t){return t.data}function l(t){return t.data&&440===t.status&&(alert("Session expired, please login again..."),window.document.location.replace("/logout")),t.data}this.post=function(t,n,e){return r(t,n,"POST",e).then(i,l)},this.get=function(t,n,e,a){return r(t,n,"GET",e,a).then(i,l)},this.remove=function(t,n,e){return r(t,n,"DELETE",e).then(i,l)}}]);
"use strict";angular.module("playerApp").service("restfulLearnerService",["$http","$rootScope","$filter","config","uuid4",function(e,t,n,r,a){function o(){t.userId=t.userId||$("#userId").attr("value");var e={"Content-Type":"application/json",Accept:"application/json","X-Consumer-ID":"X-Consumer-ID","X-Device-ID":"X-Device-ID","X-msgid":a.generate(),ts:n("date")(new Date,"yyyy-MM-dd HH:mm:ss:sssZ"),"X-Source":"web","X-Org-code":"AP"};return org.sunbird.portal.channel&&(e["X-Channel-Id"]=org.sunbird.portal.channel),e.Accept="text/html,application/xhtml+xml,application/xml,application/json;q=0.9,image/webp,*/*;q=0.8",e}function i(t,n,a,i){var s=i||o(),u=r.URL.BASE_PREFIX+r.URL.LEARNER_PREFIX+t;return e({method:a,url:u,headers:s,data:n})}function s(e){return e.data}function u(e){return e.data&&440===e.status&&(alert("Session expired, please login again..."),window.document.location.replace("/logout")),e.data}this.post=function(e,t,n){return i(e,t,"POST",n).then(s,u)},this.get=function(e,t,n){return i(e,t,"GET",n).then(s,u)},this.remove=function(e,t,n){return i(e,t,"DELETE",n).then(s,u)},this.patch=function(e,t,n){return i(e,t,"PATCH",n).then(s,u)},this.upload=function(t,o){var i=r.URL.BASE_PREFIX+r.URL.LEARNER_PREFIX+t,c={"Content-Type":void 0,"X-Consumer-ID":"X-Consumer-ID","X-Device-ID":"X-Device-ID","X-msgid":a.generate(),ts:n("date")(new Date,"yyyy-MM-dd HH:mm:ss:sssZ"),"X-Source":"web","X-Org-code":"AP"};return e({method:"POST",url:i,headers:c,data:o}).then(s,u)}}]);
"use strict";angular.module("playerApp").service("contentService",["restfulContentService","config","$rootScope","restfulLearnerService",function(t,n,r,e){this.create=function(e){return e.content.organization=r.organisationNames,e.content.createdFor=r.organisationIds,e.content.creator=r.firstName+" "+r.lastName,t.post(n.URL.CONTENT.CREATE,e)},this.copy=function(e,i){e.content.createdFor=r.organisationIds,e.content.creator=r.firstName+" "+r.lastName,e.content.organization=r.organisationNames;var o=n.URL.CONTENT.COPY+"/"+i;return t.post(o,e)},this.publish=function(r,e){var i=n.URL.CONTENT.PUBLISH+"/"+e;return t.post(i,r)},this.retire=function(r){var e=n.URL.CONTENT.RETIRE;return t.remove(e,r)},this.reject=function(r,e){var i=n.URL.CONTENT.REJECT+"/"+e;return t.post(i,r)},this.uploadMedia=function(t){return e.upload(n.URL.CONTENT.UPLOAD_MEDIA,t)},this.getById=function(r,e){var i=n.URL.CONTENT.GET+"/"+r.contentId;return t.get(i,r,null,e)},this.flag=function(r,e){var i=n.URL.CONTENT.FLAG+"/"+e;return t.post(i,r)},this.acceptContentFlag=function(r,e){var i=n.URL.CONTENT.ACCEPT_FLAG+"/"+e;return t.post(i,r)},this.discardContentFlag=function(r,e){var i=n.URL.CONTENT.DISCARD_FLAG+"/"+e;return t.post(i,r)},this.validateContent=function(t){if(_.isString(t)){var n=[t];return _.isArray(n)?_.compact(n).join(", "):""}return _.isArray(t)?_.compact(t).join(", "):""},this.getConceptsNames=function(t){var n=_.map(t,"name");if(t&&_.isArray(t)&&n.length<t.length){var e=_.filter(r.concepts,function(n){return _.includes(t,n.identifier)});n=_.map(e,"name")}return n.join(", ")}}]);
"use strict";angular.module("playerApp").service("noteService",["restfulLearnerService","config",function(e,t){this.search=function(r){return e.post(t.URL.NOTES.SEARCH,r)},this.create=function(r){return e.post(t.URL.NOTES.CREATE,r)},this.update=function(r){var n=t.URL.NOTES.UPDATE+"/"+r.noteId;return e.patch(n,r)},this.remove=function(r){var n=t.URL.NOTES.DELETE+"/"+r.noteId;return e.remove(n,r)}}]);
"use strict";angular.module("playerApp").service("courseService",["restfulLearnerService","config","$sessionStorage","restfulContentService",function(e,r,t,n){this.search=function(e){return n.post(r.URL.COURSE.SEARCH,e)},this.courseSchedule=function(n){var o=r.URL.USER_BASE+r.URL.COURSE.USER_COURSE_SCHEDULE+"/"+t.token;return e.get(o,n)},this.courseContentState=function(t){return e.post(r.URL.COURSE.USER_CONTENT_STATE,t)},this.courseHierarchy=function(e){var t=r.URL.COURSE.HIERARCHY+"/"+e;return n.get(t)},this.enrollUserToCourse=function(t){return e.post(r.URL.COURSE.ENROLL_USER_COURSE,t)}}]);
"use strict";angular.module("playerApp").service("learnService",["restfulLearnerService","config",function(e,r){this.enrolledCourses=function(n){var t=r.URL.COURSE.GET_ENROLLED_COURSES+"/"+n;return e.get(t)},this.otherSections=function(){return e.get(r.URL.COURSE.GET_LEARN_OTHER_SECTION)},this.recommendedCourses=function(){return e.get(r.URL.COURSE.RECOMMENDED_COURSE)}}]);
"use strict";angular.module("playerApp").service("userService",["config","restfulContentService","restfulLearnerService",function(r,t,e){function n(r){return Math.floor(Math.random()*parseInt("8"+"9".repeat(r-1))+parseInt("1"+"0".repeat(r-1)))}this.currentUserProfile={},this.resourceBundle=function(e,n){var i=r.URL.CONFIG_BASE+r.URL.USER.RESOURCE_BUNDLE+"/"+n+"/"+e;return t.get(i)},this.getUserProfile=function(t,n){var i=r.URL.USER.GET_PROFILE+"/"+t;return n&&_.isString(n)&&(i=i+"?fields="+n),e.get(i)},this.updateUserProfile=function(t,n,i){var s=r.URL.USER.UPDATE_USER_PROFILE;return e.patch(s,t)},this.getTenantLogo=function(){return t.get(r.URL.USER.TENANT_LOGO)},this.setCurrentUserProfile=function(r){this.currentUserProfile=r},this.getCurrentUserProfile=function(){return this.currentUserProfile},this.getSkills=function(){var t=r.URL.USER.SKILLS;return e.get(t)},this.getUserSkills=function(t){var n=r.URL.USER.USER_SKILLS;return e.post(n,t)},this.addSkills=function(t){var n=r.URL.USER.ADD_SKILLS;return e.post(n,t)},this.updateProfileFieldVisibility=function(t){var n=r.URL.USER.UPDATE_PROF_VIS_FIELDS;return e.post(n,t)},this.getUserHash=function(r){var t=r+(new Date).getTime()+n(5);return md5(t)},this.searchUsers=function(t){var n=[];return this.searchOrgs(t).then(function(i){n=_.map(i.result.response.content,function(r){return _.get(r,"identifier")}),n.push(t),n=_.uniq(n);var s={request:{filters:{"organisations.organisationId":n}}};return e.post(r.URL.ADMIN.USER_SEARCH,s)}).catch(function(i){console.log(i),n.push(t);var s={request:{filters:{"organisations.organisationId":n}}};return e.post(r.URL.ADMIN.USER_SEARCH,s)})},this.searchOrgs=function(t){var n={request:{filters:{rootOrgId:t}}};return e.post(r.URL.ADMIN.ORG_SEARCH,n)}}]);
"use strict";angular.module("playerApp").service("pageSectionService",["restfulLearnerService","searchService",function(e,r){this.getPageData=function(t,a){return a.request=r.updateReqForChannelFilter(a.request),e.post(t,a)}}]);
"use strict";angular.module("playerApp").service("searchService",["restfulContentService","config","$q","restfulLearnerService","$rootScope",function(e,t,r,n,s){this.contentSearch=function(r){return r.filters.contentType||(r.filters.contentType=["Collection","TextBook","LessonPlan","Resource","Story","Worksheet","Game"]),r=this.updateReqForChannelFilter(r),e.post(t.URL.CONTENT.SEARCH,r)},this.courseSearch=function(r){return r=this.updateReqForChannelFilter(r),e.post(t.URL.COURSE.SEARCH,r)},this.search=function(r){var n=r&&r.filters&&r.filters.objectType;return n&&"Content"!==n&&!n.includes("Content")||(r=this.updateReqForChannelFilter(r)),e.post(t.URL.COMPOSITE.SEARCH,r)},this.setPublicUserProfile=function(e){return this.publicUser={responseCode:"OK",result:{response:e}},!0},this.getPublicUserProfile=function(n,s){if(void 0!==s)return e.get(t.URL.USER.GET_PROFILE+"/"+n);if(this.publicUser){var i=r.defer();return i.resolve(this.publicUser),i.promise}return e.get(t.URL.USER.GET_PROFILE+"/"+n)},this.getOrgTypes=function(){var e=t.URL.ORG_TYPE.GET;return n.get(e)},this.setOrgTypes=function(e){this.orgTypes=e},this.getOrgTypeS=function(){if(this.orgTypes){var e=r.defer();return e.resolve(this.orgTypes),e.promise}return this.getOrgTypes().then(function(e){if("OK"===e.responseCode)return e.result.response})},this.getChannel=function(r){return r=r||org.sunbird.portal.channel,e.get(t.URL.CHANNEL.READ+"/"+r)},this.getFramework=function(r){return e.get(t.URL.FRAMEWORK.READ+"/"+r)},this.getDataDrivenFormsConfig=function(r){return r.rootOrgId=org.sunbird.portal.channel,e.post(t.URL.dataDrivenForms.READ,r)},this.updateReqForChannelFilter=function(e){return s.content_channel_filter_type&&"self"===s.content_channel_filter_type.toLowerCase()&&(e=e||{},e.filters=e.filters||{},e.filters.channel=_.concat([],org.sunbird.portal.channel)),e}}]);
"use strict";angular.module("playerApp").service("permissionsService",["restfulLearnerService","config","$rootScope",function(e,n,t){var r=this,i=[],o={},s=[],c=[],a=[];this.setRolesAndPermissions=function(e){var n=_.cloneDeep(e.roles);_.forEach(n,function(e,n){var t={role:e.id,actions:[],roleName:e.name};a.push(t),_.forEach(e.actionGroups,function(e){var n={role:e.id,actions:e.actions,roleName:e.name};t.actions=_.concat(t.actions,e.actions),i.push(n)}),i.push(t)}),i=_.uniqBy(i,"role")},this.setCurrentUserRoleMap=function(e){o=e},this.setCurrentUserRoles=function(e){s=e,this.setCurrentRoleActions(e)},this.setCurrentRoleActions=function(e){_.forEach(e,function(e){var n=_.filter(i,{role:e});_.isArray(n)&&n.length>0&&(c=_.concat(c,_.map(n[0].actions,"id")))})},this.checkRolesPermissions=function(e,n){if(s&&s.length>0){if(this.checkActionsPermissions(e,n))return!0;if(_.isArray(e))return 0===_.intersection(e,s).length&&!n||_.intersection(e,s).length>0&&n}return!1},this.checkActionsPermissions=function(e,n){return!!_.isArray(e)&&(!(0===_.intersection(e,c).length&&!n)&&(_.intersection(e,c).length>0&&n))},this.getPermissionsData=function(){return e.get(n.URL.ROLES.READ)},this.allRoles=function(){return i},this.getCurrentUserRoleMap=function(){return o},this.getCurrentUserRoles=function(){return s},this.getCurrentUserProfile=function(){var r=n.URL.USER.GET_PROFILE+"/"+t.userId;return e.get(r)},this.getMainRoles=function(){return a},this.setRoleOrgMap=function(e){var n=[];_.forEach(e.organisations,function(e){n=n.concat(e.roles)}),n=_.uniq(n),this.roleOrgMap={},_.forEach(n,function(n){_.forEach(e.organisations,function(e){r.roleOrgMap[n]=r.roleOrgMap[n]||[],_.indexOf(e.roles,n),r.roleOrgMap[n].push(e.organisationId)})})},this.getRoleOrgMap=function(){return _.cloneDeep(this.roleOrgMap)}}]);
"use strict";angular.module("playerApp").service("contentStateService",["$filter","$rootScope","restfulLearnerService","config","uuid4","dataService",function(t,e,s,n,r,o){var c=c||{},a=this;this.init=function(){org.sunbird.portal.eventManager.addEventListener("sunbird:telemetry:flush",a.updateContentState),org.sunbird.portal.eventManager.addEventListener("sunbird:player:telemetry",a.updateContentState)},this.getContentsStateFromAPI=function(t){return s.post(n.URL.COURSE.USER_CONTENT_STATE_READ,t)},this.updateContentStateInServer=function(t){return s.patch(n.URL.COURSE.USER_CONTENT_STATE_UPDATE,t)},this.prepareContentObject=function(s){var n={contentId:e.contentId,status:1,lastAccessTime:t("date")(new Date(s.ets),"yyyy-MM-dd HH:mm:ss:sssZ"),courseId:_.find(s.cdata,{type:"course"}).id,batchId:e.enrolledCourseIds[_.find(s.cdata,{type:"course"}).id].batchId},r=_.find(c[n.courseId].contents,{contentId:n.contentId});return r&&r.status>n.status&&(n.status=r.status),"OE_END"===s.eid&&s.edata&&s.edata.eks&&s.edata.eks.progress&&(n.progress=parseInt(s.edata.eks.progress),100===s.edata.eks.progress&&(n.status=2)),n},this.getContentsState=function(t,e){if(_.isEmpty(c)||!c[t.request.courseIds[0]]){var s=t.request.courseIds[0];c[s]={},c[s].contents=[],this.getContentsStateFromAPI(t).then(function(t){t&&"OK"===t.responseCode&&(c[s].contents=t.result.contentList),e(c[s].contents)},function(){e(c[s].contents)})}else e(c[t.request.courseIds[0]].contents)},a.updateContentState=function(s,n){if(n&&("OE_START"===n.eid||"OE_END"===n.eid)&&!0===o.getData("isTrackingEnabled")){var d=a.prepareContentObject(n),u=-1;if(c[d.courseId]&&c[d.courseId].contents){var i=_.find(c[d.courseId].contents,{contentId:d.contentId,courseId:d.courseId}),I=_.findIndex(c[d.courseId].contents,{contentId:d.contentId,courseId:d.courseId});i?(c[d.courseId].contents[I].progress=d.progress&&i.progress&&parseInt(i.progress)<d.progress?d.progress:c[d.courseId].contents[I].progress,c[d.courseId].contents[I].lastAccessTime=d.lastAccessTime,u=c[d.courseId].contents[I].status,c[d.courseId].contents[I].status=d.status):-1===I&&c[d.courseId].contents.push(d)}c[d.courseId].currentContent=d.contentId;var p={id:r.generate(),ts:t("date")(new Date,"yyyy-MM-dd HH:mm:ss:sssZ"),params:{},request:{userId:e.userId,contents:[d]}};console.log("called flush"),u<d.status&&a.updateContentStateInServer(p).then(function(t){})}}}]);
"use strict";angular.module("playerApp").service("toasterService",[function(){iziToast.settings({position:"topCenter",titleSize:"18"}),this.success=function(i){iziToast.success({title:i})},this.info=function(i){iziToast.info({title:i})},this.error=function(i){iziToast.error({progressBar:!1,timeout:!1,title:i})},this.warning=function(i){iziToast.warning({title:i})},this.loader=function(i,t){var e={};return e.showLoader=!0,e.headerMessage=i,e.loaderMessage=t,e}}]);
"use strict";angular.module("playerApp").service("routeHelperService",["$rootScope","$stateParams","$timeout","sessionService","permissionsService","toasterService","$state","$window",function(e,a,r,n,s,o,t,i){this.loadRouteConfig=function(r,n){a=n;var s=["Home","Courses","Resources","CourseNote","ContentNote","CourseContentNote","Toc","Player","Search","TocPlayer","PreviewCollection","Profile","PublicProfile"],o=["Courses","Resources","Search"],t={Home:"All",Courses:"Courses",Resources:"Library",CourseNote:"Courses",ContentNote:"Library",CourseContentNote:"Courses",Toc:"Courses",Player:"Library",Search:a?a.type:"All",TocPlayer:"Courses",PreviewCollection:"Library",Profile:"Users",PublicProfile:"Users"};s.indexOf(r)>=0?(e.isSearchPage=!0,e.searchKey=t[r]):e.isSearchPage=!1,o.indexOf(r)>=0?e.showFilter=!0:e.showFilter=!1,this.clearSearchSettings(),this.setBreaCrumbs(r)},this.setBreaCrumbs=function(r){switch(r){case"Home":e.breadCrumbsData=null;break;case"Courses":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Courses",link:"learn"}];break;case"Resources":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Library",link:"resources"}];break;case"CourseNote":var s=n.getSessionData("COURSE_PARAMS");e.breadCrumbsData=[{name:"Courses",link:"learn"},{name:s.courseName,link:"/course/"+s.courseId+"/"+s.lectureView},{name:"Notes",link:""}];break;case"ContentNote":e.breadCrumbsData=[{name:"Library",link:"resources"},{name:a.contentName,link:"content/"+a.contentId+"/"+a.contentName},{name:"Notes",link:""}];break;case"CourseContentNote":s=n.getSessionData("COURSE_PARAMS");var o="/course/"+s.courseId+"/"+s.lectureView,t=o+"/"+s.contentId+"/"+s.contentIndex;e.breadCrumbsData=[{name:s.courseName,link:o},{name:s.contentName,link:t},{name:"Notes",link:""}];break;case"Toc":s=n.getSessionData("COURSE_PARAMS"),s&&(e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Courses",link:"learn"},{name:s?s.courseName:"",link:""}]);break;case"announcementOutbox":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Profile",link:"profile"},{name:"My Announcements",link:""}];break;case"announcementInbox":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Announcements",link:""}];break;case"Profile":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Profile",link:""}];break;case"Player":a.contentName&&(e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Library",link:"resources"},{name:a.contentName,link:""}]);break;case"Search":"Users"===e.searchKey||"Organisations"===e.searchKey?e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Profile",link:"profile"},{name:"Search",link:""}]:e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Search",link:""}];break;case"TocPlayer":s=n.getSessionData("COURSE_PARAMS"),e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Courses",link:"learn"},{name:s.courseName,link:""}];break;case"WorkSpace":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Profile",link:"profile"},{name:e.frmelmnts.scttl.myworkspace,link:"workspace/content/create"}];break;case"EditContent":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Profile",link:"profile"},{name:e.frmelmnts.scttl.myworkspace,link:"workspace/content/create"},{name:"Edit Content",link:""}];break;case"PreviewCollection":a.name&&(e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Library",link:"resources"},{name:a.name,link:""}]);break;case"orgDashboard":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Profile",link:"profile"},{name:"Organization Admin Dashboard",link:""}];break;case"PublicProfile":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Profile",link:"profile"},{name:a.userName,link:""}];break;case"MyActivity":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Profile",link:"profile"},{name:"Course Creator Dashboard",link:""}];break;case"Setup":e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Setup",link:"setup"}];break;default:e.breadCrumbsData=null}},this.checkStateAccess=function(a,r,n){if(s.checkRolesPermissions(a,r)){o.warning(e.messages.imsg.m0004),n.preventDefault();var m=JSON.parse(i.localStorage.getItem("previousURl"));t.go(m.name,m.params)}},this.clearSearchSettings=function(){e.search&&(e.search.selectedLanguage=[],e.search.selectedContentType=[],e.search.selectedSubject=[],e.search.selectedLocation="",e.search.selectedRoles=[],e.search.selectedBoard=[],e.search.selectedConcepts=[],e.search.broadCastConcepts(),e.search.filters={},e.search.sortBy={},e.search.sortByOption={},e.search.selectedGrades=[],e.search.selectedOrgType=[],r(function(){$("#multi-select-sort").dropdown("clear"),$("#content-search-filter-accordion").accordion("close",0)},0))},this.verifyAnnouncementData=function(a,r){var n=!0;return void 0===r?n=1===a:2===a?r&&r.title&&r.type&&r.from&&(r.description||r.links||r.attachments)||(n=!1):3!==a&&4!==a||(e.$emit("get:selected:items"),r.selTar&&0===r.selTar.length&&(n=!1)),n}}]);
"use strict";angular.module("playerApp").service("formValidation",["$rootScope",function(e){var t=[{fieldName:"addressType",type:"checked",prompt:e.messages.stmsg.m0096},{fieldName:"addLine1",optional:!1,type:"regExp[.*?]",prompt:e.messages.stmsg.m0063},{fieldName:"addLine2",optional:!0,type:"regExp[.*?]",prompt:e.messages.stmsg.m0100},{fieldName:"city",optional:!1,type:"regExp[.*?]",prompt:e.messages.stmsg.m0097},{fieldName:"state",optional:!0,type:"regExp[.*?]",prompt:e.messages.stmsg.m0098},{fieldName:"country",optional:!0,type:"regExp[^[A-z ]{1,35}$]",prompt:e.messages.stmsg.m0099},{fieldName:"pinCode",optional:!0,type:"regExp[^[1-9][0-9]{5}$]",prompt:e.messages.stmsg.m0065}],m=[{fieldName:"degree",type:"regExp[.*?]",prompt:e.messages.stmsg.m0062},{fieldName:"institute",type:"regExp[.*?]",prompt:e.messages.stmsg.m0070},{fieldName:"yearop",optional:!0,type:"empty"},{fieldName:"prcntg",optional:!0,type:"regExp[^(100([\\.][0]{1,})?$|[0-9]{1,2}([\\.][0-9]{1,})?)$]",prompt:e.messages.stmsg.m0094},{fieldName:"grade",optional:!0,type:"regExp[.*?]",prompt:e.messages.stmsg.m0104},{fieldName:"board",optional:!0,type:"regExp[.*?]"}],p=[{fieldName:"jobName",type:"regExp[.*?]",prompt:e.messages.stmsg.m0072},{fieldName:"org",type:"regExp[.*?]",prompt:e.messages.stmsg.m0073},{fieldName:"designation",optional:!0,type:"regExp[.*?]",prompt:e.messages.stmsg.m0103},{fieldName:"subjectstaught",optional:!0,type:"empty"},{fieldName:"radio",optional:!0,type:"empty"},{fieldName:"joiningDate",optional:!0,type:"empty"},{fieldName:"endDate",optional:!0,type:"empty"}],s=[{fieldName:"firstName",type:"regExp[.*?]",prompt:e.messages.stmsg.m0066},{fieldName:"lastName",optional:!0,type:"regExp[.*?]",prompt:e.messages.stmsg.m0066},{fieldName:"gender",optional:!0,type:"empty",prompt:e.messages.stmsg.m0069},{fieldName:"location",optional:!0,type:"maxLength[100]",prompt:e.messages.stmsg.m0102},{fieldName:"grades",optional:!0,type:"empty"},{fieldName:"phone",type:"regExp[^\\d{10}$]",prompt:e.messages.stmsg.m0067},{fieldName:"email",type:"email",prompt:e.messages.stmsg.m0068},{fieldName:"language",type:"empty",prompt:e.messages.stmsg.m0069},{fieldName:"subjects",optional:!0,type:"empty"},{fieldName:"birthdate",optional:!0,type:"empty"},{fieldName:"fb",optional:!0,type:"url",prompt:e.messages.stmsg.m0101},{fieldName:"twitter",optional:!0,type:"url",prompt:e.messages.stmsg.m0101},{fieldName:"in",optional:!0,type:"url",prompt:e.messages.stmsg.m0101},{fieldName:"blog",optional:!0,type:"url",prompt:e.messages.stmsg.m0101}];this.getFields=function(e){return"#basicInfoForm"===e?s:".educationForm"===e?m:"#addressForm"===e||".addressForm"===e?t:".jobProfileForm"===e?p:void 0},this.validate=function(e,t){var m={},p=[];m=this.getFields(e),_.forEach(t,function(e){var t=_.filter(m,{fieldName:e});p.push(t[0])});var s=angular.copy(p),a=s.reduce(function(e,t,m){return t.fieldName={identifier:t.fieldName,optional:t.optional,rules:[{type:t.type,prompt:t.prompt}]},e[m]=t.fieldName,e},{});return $(e).form({fields:a,onSuccess:function(){return!0},onFailure:function(){return!1}}),$(e).form("validate form")}}]);
"use strict";angular.module("playerApp").service("adminService",["config","restfulLearnerService",function(t,e){this.userSearch=function(r){var s=t.URL.ADMIN.USER_SEARCH;return e.post(s,r)},this.orgSearch=function(r){var s=t.URL.ADMIN.ORG_SEARCH;return e.post(s,r)},this.deleteUser=function(r){var s=t.URL.ADMIN.DELETE_USER;return e.post(s,r)},this.updateRoles=function(r){var s=t.URL.ADMIN.UPDATE_USER_ORG_ROLES;return e.post(s,r)},this.bulkUserUpload=function(r){var s=t.URL.ADMIN.BULK.USERS_UPLOAD;return e.upload(s,r)},this.bulkOrgrUpload=function(r){var s=t.URL.ADMIN.BULK.ORGANIZATIONS_UPLOAD;return e.upload(s,r)},this.bulkUploadStatus=function(r){var s=t.URL.ADMIN.BULK.STATUS+"/"+r;return e.get(s)},this.addBadges=function(r){var s=t.URL.BADGE.ASSIGN;return e.post(s,r)},this.getBadges=function(){var r=t.URL.BADGE.GET;return e.get(r)},this.setBadges=function(t){this.badges=t.result.response},this.getBadgesList=function(){return this.badges?this.badges:this.getBadges().then(function(t){return t.result.response})}}]);
"use strict";angular.module("playerApp").service("batchService",["restfulLearnerService","config","permissionsService","userService","$rootScope",function(e,t,r,i,n){this.batchDetails="",this.create=function(r){return e.post(t.URL.BATCH.CREATE,r)},this.update=function(r){return e.patch(t.URL.BATCH.UPDATE,r)},this.addUsers=function(r,i){return e.post(t.URL.BATCH.ADD_USERS+"/"+i,r)},this.removeUsers=function(r){return e.remove(t.URL.BATCH.DELETE+"/"+r.batchId,r)},this.getBatchDetails=function(r){return e.get(t.URL.BATCH.GET_DETAILS+"/"+r.batchId,r)},this.getAllBatchs=function(r){return e.post(t.URL.BATCH.GET_BATCHS,r)},this.getUserList=function(r){return e.post(t.URL.ADMIN.USER_SEARCH,r)},this.setBatchData=function(e){this.batchDetails=e},this.getBatchData=function(){return this.batchDetails},this.getUserOtherDetail=function(e){return e.email&&e.phone?" ("+e.email+", "+e.phone+")":e.email&&!e.phone?" ("+e.email+")":!e.email&&e.phone?" ("+e.phone+")":void 0},this.getRequestBodyForUserSearch=function(e,t){var n={filters:{}};e&&(n.query=e),t&&(n.filters.identifier=t);var s=r.getRoleOrgMap()&&r.getRoleOrgMap().COURSE_MENTOR,o=i.getCurrentUserProfile();if(s&&s.includes(o.rootOrgId))n.filters.rootOrgId=o.rootOrgId;else{try{var a=r.getRoleOrgMap().COURSE_MENTOR;_.remove(a,function(e){return e===o.rootOrgId})}catch(e){console.error(e)}n.filters["organisations.organisationId"]=a}return{request:n}},this.filterUserSearchResult=function(e,t){if(t){var r=null!==e.firstName&&e.firstName.includes(t),i=null!==e.lastName&&e.lastName.includes(t),n=null!==e.email&&e.email.includes(t),s=null!==e.phone&&e.phone.includes(t);return r||i||n||s}return!0}}]);
"use strict";angular.module("playerApp").service("workSpaceUtilsService",["$state","$window","$location","config",function(e,t,i,n){this.baseUrl=new t.URL(i.absUrl()).origin+"/",this.removeContentLocal=function(e,t){return e.filter(function(e){return-1===t.indexOf(e.identifier)})},this.collectionEditor=function(t,i){var n={contentId:t.identifier,type:t.contentType,state:i};t.framework&&(n.framework=t.framework),e.go("CollectionEditor",n)},this.contentEditor=function(t,i){var n={contentId:t.identifier,state:i};t.framework&&(n.framework=t.framework),e.go("ContentEditor",n)},this.genericEditor=function(t,i){var n={contentId:t.identifier,state:i};t.framework&&(n.framework=t.framework),e.go("GenericEditor",n)},this.previewContent=function(t,i){var n={contentId:t.identifier,backState:i};e.go("PreviewContent",n)},this.previewCollection=function(t,i){e.go("PreviewCollection",{Id:t.identifier,name:t.name,backState:i})},this.openContentEditor=function(e,t){"application/vnd.ekstep.content-collection"===e.mimeType?this.collectionEditor(e,t):"application/vnd.ekstep.ecml-archive"===e.mimeType?this.contentEditor(e,t):this.genericEditor(e,t)},this.openContentPlayer=function(e,t){"application/vnd.ekstep.content-collection"===e.mimeType?this.collectionEditor(e,t):this.previewContent(e,t)},this.getPublicShareUrl=function(e,t){return this.baseUrl+t+"/"+e},this.getBase64Url=function(e,t){return btoa(e+"/"+t)},this.getUnlistedShareUrl=function(e){return"Course"===e.contentType?this.baseUrl+"unlisted/"+this.getBase64Url("course",e.identifier):"application/vnd.ekstep.content-collection"===e.mimeType?this.baseUrl+"unlisted/"+this.getBase64Url("collection",e.identifier):this.baseUrl+"unlisted/"+this.getBase64Url("content",e.identifier)},this.hideRemoveModel=function(e){$(e).modal("hide"),$(e).modal("hide all"),$(e).modal("hide other"),$(e).modal("hide dimmer")}}]);
"use strict";angular.module("playerApp").service("configService",["restfulContentService","config","$q","permissionsService",function(e,s,O,r){this.getProfileAddInfformElmnt=function(){return{languages:s.PROFILE.languages,subjects:s.DROPDOWN.COMMON.subjects,grades:s.DROPDOWN.COMMON.grades}},this.getWorkspaceStdMtrlDrpdown=function(){return{boards:s.DROPDOWN.COMMON.boards,medium:s.DROPDOWN.COMMON.medium,subjects:s.DROPDOWN.COMMON.subjects,grades:s.DROPDOWN.COMMON.grades,resourceType:s.WORKSPACE.CREATE.RESOURCE.RESOURCE_TYPES}},this.getWorkspaceFormDropdown=function(){return{boards:s.DROPDOWN.COMMON.boards,medium:s.DROPDOWN.COMMON.medium,subjects:s.DROPDOWN.COMMON.subjects,grades:s.DROPDOWN.COMMON.grades,years:this.getYearsForCreateTextBook()}},this.getWorkspaceUpforReviewdrpdwn=function(){var e={boards:s.DROPDOWN.COMMON.boards,medium:s.DROPDOWN.COMMON.medium,languages:s.DROPDOWN.COMMON.languages,subjects:s.DROPDOWN.COMMON.subjects,grades:s.DROPDOWN.COMMON.grades,contentTypes:s.WORKSPACE.UP_FOR_REVIEW.contentTypes};return-1!==_.indexOf(r.getCurrentUserRoles(),"BOOK_REVIEWER")&&e.contentTypes.unshift({key:"TextBook",value:"Text Book"}),e},this.getFilterSearchdrpdwn=function(){return{boards:s.DROPDOWN.COMMON.boards,medium:s.DROPDOWN.COMMON.medium,subjects:s.DROPDOWN.COMMON.subjects,languages:s.DROPDOWN.COMMON.languages,contentTypes:s.FILTER.RESOURCES.contentTypes,grades:s.DROPDOWN.COMMON.grades,searchTypeKeys:s.searchTypeKeys,sortingOptions:s.sortingOptions,searchSelectionKeys:s.searchSelectionKeys}},this.getYearOfPassingValues=function(){for(var e=[],s=(new Date).getUTCFullYear(),O=1950;O<=s;O++)e.push(O);return e.reverse()},this.getYearsForCreateTextBook=function(){for(var e=[],s=(new Date).getUTCFullYear(),O=s-15;O<=s+5;O++)e.push(O);return e.reverse()}}]);
"use strict";angular.module("playerApp").service("dashboardService",["restfulLearnerService","config",function(e,r){this.getAdminDashboardData=function(o,i){switch(i){case"creation":return e.get(r.URL.DASHBOARD.ORG_CREATION+"/"+o.org_id+"?period="+o.period);case"consumption":return e.get(r.URL.DASHBOARD.ORG_CONSUMPTION+"/"+o.org_id+"?period="+o.period);default:return e.get(r.URL.DASHBOARD.ORG_CREATION+"/"+o.org_id+"?period="+o.period)}},this.getChartColors=function(e){return"creation"===e?[{backgroundColor:"#f93131",borderColor:"#f93131",fill:!1},{backgroundColor:"#0062ff",borderColor:"#0062ff",fill:!1},{backgroundColor:"#006400",borderColor:"#006400",fill:!1}]:"consumption"===e?[{backgroundColor:"#0062ff",borderColor:"#0062ff",fill:!1}]:void 0},this.getChartOptions=function(e){return{legend:{display:!0},scales:{xAxes:[{gridLines:{display:!1}}],yAxes:[{scaleLabel:{display:!0,labelString:e},ticks:{beginAtZero:!0}}]}}},this.secondsToMin=function(e){var r="",o="";if(e.value<60)e.value+=" second(s)";else if(e.value>=60&&e.value<=3600)r=e.value/60,o=r.toFixed(2),e.value=o+" min(s)";else{if(!(e.value>=3600))return e;r=e.value/3600,o=r.toFixed(2),e.value=o+" hour(s)"}return e},this.getCourseDashboardData=function(o,i){switch(i){case"progress":return e.get(r.URL.DASHBOARD.COURSE_PROGRESS+"/"+o.courseId+"?period="+o.timePeriod);case"consumption":return e.get(r.URL.DASHBOARD.COURSE_CONSUMPTION+"/"+o.courseId+"?period="+o.timePeriod);default:return e.get(r.URL.DASHBOARD.COURSE_PROGRESS+"/"+o.courseId+"?period="+o.timePeriod)}}}]);
"use strict";angular.module("playerApp").service("dataService",function(){var t={};this.setData=function(a,e){t[a]=e},this.getData=function(a){return t[a]}});
"use strict";angular.module("playerApp").service("PaginationService",[function(){this.GetPager=function(e,a,t){a=a||1,t=t||10;var n,r,i=Math.ceil(e/t);i<=5?(n=1,r=i):a<=1?(n=1,r=5):a+4>=i?(n=i-4,r=i):(n=a,r=a+4);var g=(a-1)*t;return{totalItems:e,currentPage:a,pageSize:t,totalPages:i,startPage:n,endPage:r,startIndex:g,endIndex:Math.min(g+t-1,e-1),pages:_.range(n,r+1)}}}]);
"use strict";angular.module("playerApp").controller("SearchCtrl",["$timeout","$rootScope",function(t,a){this.initSearch=function(){a.search&&(a.search.searchResult={},a.search.autosuggest_data=[]),t(function(){a.$broadcast("initSearch",{})},500)}}]);
"use strict";angular.module("playerApp").controller("SearchResultController",["$scope","$rootScope","config","$timeout","$state","$stateParams","searchService","toasterService","$location","sessionService","adminService","permissionsService","PaginationService","telemetryService",function(e,s,r,a,c,t,o,h,n,i,l,d,g,u){function y(e,s,r,a){var c={};return c.showError=!0,c.isClose=e,c.message=s,c.messageType=r,a&&(c.messageText=a),c}e.search={},s.search={},s.search.searchKeyword="",s.search.filters={},s.search.typingTimer=-1,s.search.doneTypingInterval=1e3,s.search.languages=r.FILTER.RESOURCES.languages,s.search.contentTypes=r.FILTER.RESOURCES.contentTypes,s.search.subjects=r.FILTER.RESOURCES.subjects,s.search.grades=r.DROPDOWN.COMMON.grades,s.search.boards=r.FILTER.RESOURCES.boards,e.search.searchTypeKeys=r.searchTypeKeys,s.search.sortingOptions=r.sortingOptions,s.search.sortBy={createdOn:"asc"},e.search.searchSelectionKeys=r.searchSelectionKeys,s.search.sortIcon=!0,s.search.selectedLanguage=[],s.search.selectedContentType=[],s.search.selectedSubject=[],s.search.selectedBoard=[],s.search.selectedConcepts=[],s.search.selectedLocation="",s.search.selectedRoles=[],s.search.sortByOption={},e.search.autoSuggest=!0,s.search.selectedOrgType=[],s.search.pageLimit=20,s.search.pager={},s.userDownloadButtonVisibility=r.USER_SEARCH.DOWNLOAD_BUTTON_VISIBILITY,s.$watch("searchKey",function(){a(function(){s.search.selectedSearchKey=s.searchKey,s.$emit("DynSearchKey",{key:s.searchKey}),e.search.isSearchTypeKey=e.search.searchTypeKeys.includes(s.search.selectedSearchKey),$("#headerSearch").dropdown("set selected",!0===e.search.isSearchTypeKey?s.search.selectedSearchKey:"All"),s.search.searchKeyword=""},0)});var f=s.$on("initSearch",function(s,r){e.search.initSearch()}),p=s.$on("setSearchKey",function(r,a){s.search.selectedSearchKey=a.key,e.search.searchRequest(!1)});s.search.selectFilter=function(e,r,c){a(function(){var a=s.search[e].indexOf(r);-1===a?(s.search[e].push(r),$(c.target).addClass("active")):(s.search[e].splice(a,1),$(c.target).removeClass("active"))},0)},s.search.removeFilterSelection=function(e,r){if("selectedConcepts"===e)s.search[e]=_.filter(s.search[e],function(e){return e.identifier!==r}),s.search.broadCastConcepts();else{var a=s.search[e].indexOf(r);-1!==a&&s.search[e].splice(a,1)}},s.getRoleName=function(e){return _.find(s.search.userRoles,{role:e}).roleName},s.getOrgName=function(e){return _.find(s.search.orgTypes,{id:e}).name},s.expandFilters=function(){$("#filterIcon").parents(".active").length<=0&&$("#filterIcon").trigger("click")},e.search.initSearch=function(){var r=t;s.search.selectedSearchKey=s.searchKey||r.type,s.search.searchKeyword=s.search.searchKeyword||r.query,s.search.filters=JSON.parse(atob(r.filters||btoa("{}"))),s.search.sortBy=JSON.parse(atob(r.sort||btoa("{}"))),s.search.selectedLanguage=s.search.filters.language||[],s.search.selectedContentType=s.search.filters.contentType||[],s.search.selectedBoard=s.search.filters.board||[],s.search.selectedSubject=s.search.filters.subject||[],s.search.selectedGrades=s.search.filters.grade||[],s.search.selectedConcepts=s.search.filters.concepts||[],s.search.selectedLocation=s.search.filters.location||"",s.search.selectedRoles=s.search.filters["organisations.roles"]||[],s.search.broadCastConcepts(),s.search.sortByOption=Object.keys(s.search.sortBy).length>0?Object.keys(s.search.sortBy)[0]:"",s.search.searchFromSuggestion=t.autoSuggestSearch,s.search.selectedOrgType=s.search.filters.orgType||[],e.search.searchRequest()},s.search.openCourseView=function(e,r){var a="no";a=s.enrolledCourseIds[e.courseId||e.identifier]?"no":"yes";var t={courseType:r,courseId:e.courseId||e.identifier,lectureView:a,progress:e.progress,total:e.total,courseName:e.courseName||e.name,lastReadContentId:e.lastReadContentId};i.setSessionData("COURSE_PARAMS",t),c.go("Toc",t)},s.search.playContent=function(e){"application/vnd.ekstep.content-collection"===e.mimeType?c.go("PreviewCollection",{Id:e.identifier,name:e.name}):c.go("Player",{content:e,contentName:e.name,contentId:e.identifier})},s.search.setSearchText=function(r){s.search.searchKeyword=r,s.search.searchFromSuggestion=!0,e.search.searchRequest(!1)},e.search.autoSuggestSearch=function(){e.search.autoSuggest&&s.isSearchPage&&s.search.searchKeyword.length>2&&e.search.handleSearch()},e.search.keyUp=function(){clearTimeout(s.search.typingTimer),s.search.typingTimer=setTimeout(e.search.autoSuggestSearch,s.search.doneTypingInterval)},e.search.keyDown=function(){clearTimeout(s.search.typingTimer)},e.search.searchRequest=function(r){if(clearTimeout(s.search.typingTimer),!r||13===r.charCode)if(e.search.autoSuggest=!1,s.search.searchKeyword&&""!==s.search.searchKeyword||!s.isLearnPage&&!s.isResourcesPage||r){if(s.isSearchPage)if(s.isSearchResultsPage&&s.search.searchKeyword===t.query&&s.search.selectedSearchKey===t.type)s.search.error={},s.search.loader=h.loader("",s.messages.stmsg.m0005),e.search.handleSearch();else{e.search.autoSuggest=!1,s.search.filters.concepts=s.search.selectedConcepts;var a={type:s.search.selectedSearchKey,query:s.search.searchKeyword,filters:btoa(JSON.stringify(s.search.filters)),sort:btoa(JSON.stringify(s.search.sortBy)),autoSuggestSearch:s.search.searchFromSuggestion||!1};s.searchTelemetryId="search-"+s.search.selectedSearchKey.toLowerCase(),s.searchTelemetryPageid=s.search.selectedSearchKey.toLowerCase()+"-search",s.inviewLogs=[],c.go("Search",a,{reload:!0})}}else s.$broadcast("initPageSearch",{})},e.search.handleSearch=function(r){r=r||1;var a={query:s.search.searchKeyword,filters:s.search.filters,offset:(r-1)*s.search.pageLimit,limit:s.search.pageLimit};if("null"!==_.keys(s.search.sortBy)[0]&&(a.sort_by=s.search.sortBy),e.search.autoSuggest&&!1!==e.search.autoSuggest||(s.search.loader||(s.search.loader=h.loader("",s.messages.stmsg.m0005)),s.search.loader.showLoader=!0),a.filters.concepts&&a.filters.concepts.length>0&&(a.filters.concepts=_.map(s.search.selectedConcepts,"identifier")),"true"===s.search.searchFromSuggestion?(a.filters.name=a.query,a.query="",s.search.searchFromSuggestion="false"):delete a.filters.name,"Courses"===s.search.selectedSearchKey)e.search.searchFn=o.courseSearch(a),e.search.resultType="course";else if("Library"===s.search.selectedSearchKey){var c=JSON.parse(JSON.stringify(a));(!a.filters.contentType||_.isArray(a.filters.contentType)&&0===a.filters.contentType.length)&&(c.filters.contentType=["Collection","TextBook","LessonPlan","Resource","Story","Worksheet","Game"]),c.softConstraints={badgeAssertions:1},e.search.searchFn=o.contentSearch(c),e.search.resultType="content",a.filters.objectType=["Content"]}else if("All"===s.search.selectedSearchKey){var n=JSON.parse(JSON.stringify(a));n.filters.contentType=["Collection","TextBook","LessonPlan","Resource","Course"],e.search.searchFn=o.search(n),e.search.resultType="content",a.filters.objectType=["Content"]}else if("Users"===s.search.selectedSearchKey){var i=/\S+@\S+\.\S+/,u=i.test(a.query);!0===u&&(a.filters.email=a.query),!1===u&&a.filters.email&&delete a.filters.email,a.sort_by&&delete a.sort_by,s.search.filters.orgType&&(s.search.filters.orgType=void 0,s.search.selectedOrgType=void 0),a.filters.objectType=["user"],a.softConstraints={badgeAssertions:1},e.search.currentUserRoles=d.getCurrentUserRoles();var f=e.search.currentUserRoles.includes("SYSTEM_ADMINISTRATION");!1===f&&(a.filters.rootOrgId=s.rootOrgId),e.search.searchFn=l.userSearch({request:a}),e.search.resultType="users"}else"Organisations"===s.search.selectedSearchKey&&(a.sort_by&&delete a.sort_by,e.search.searchFn=l.orgSearch({request:a}),e.search.resultType="organisations");e.search.searchFn.then(function(a){if(null===a||"OK"!==a.responseCode)throw s.search.loader.showLoader=!1,s.search.error=y(!0,s.messages.fmsg.m0004,s.messages.emsg.m0002),e.search.autoSuggest=!0,clearTimeout(s.search.typingTimer),new Error("");s.search.autosuggest_data=[];var c={};c="Organisations"===s.search.selectedSearchKey||"Users"===s.search.selectedSearchKey?a.result.response:a.result,e.search.autoSuggest&&s.search.searchKeyword!==t.query?(s.search.autosuggest_data=c[e.search.resultType]||[],s.search.autosuggest_data.length>0&&$("#search-suggestions").addClass("visible").removeClass("hidden")):(s.search.searchResultKeyword=s.search.searchKeyword,$("#search-suggestions").addClass("hidden").removeClass("visible"),s.search.loader.showLoader=!1,0===c.count?s.search.error=y(!0,s.messages.stmsg.m0006,s.messages.stmsg.m0008,s.messages.stmsg.m0007):(s.search.error={},s.search.searchResult=c,s.search.pager=g.GetPager(c.count,r,s.search.pageLimit))),e.search.autoSuggest=!0,clearTimeout(s.search.typingTimer)}).catch(function(e){s.search.loader.showLoader=!1,s.search.error=y(!0,s.messages.fmsg.m0004,s.messages.emsg.m0002)})};var S=e.$on("selectedConcepts",function(r,a){s.search.selectedConcepts=a.selectedConcepts,_.defer(function(){e.$apply()})});s.search.broadCastConcepts=function(){s.$broadcast("selectedConceptsFromSearch",{selectedConcepts:s.search.selectedConcepts})},s.search.getUserRoles=function(){s.search.userRoles||(s.search.userRoles=d.getMainRoles(),s.search.userRoles=_.sortBy(s.search.userRoles,"roleName"))},s.search.applyFilter=function(){s.search.filters.language=s.search.selectedLanguage,s.search.filters.subject=s.search.selectedSubject,"Users"===s.search.selectedSearchKey?(s.search.filters.board=void 0,s.search.filters.concepts=void 0,s.search.filters.contentType=void 0,s.search.filters.orgType=void 0,s.search.filters.grade=s.search.selectedGrades,s.search.filters.location=""!==s.search.selectedLocation.trim()?s.search.selectedLocation.trim():void 0,s.search.filters["organisations.roles"]=s.search.selectedRoles):"Organisations"===s.search.selectedSearchKey?(s.search.filters={},s.search.filters.orgTypeId=s.search.selectedOrgType):(s.search.filters.board=s.search.selectedBoard,s.search.filters.concepts=s.search.selectedConcepts,s.search.filters.contentType=s.search.selectedContentType),s.isSearchResultsPage=!1,e.search.searchRequest()},s.search.resetFilter=function(){s.isSearchPage=!1,s.search.selectedLanguage=[],s.search.selectedContentType=[],s.search.selectedSubject=[],s.search.selectedBoard=[],s.search.selectedConcepts=[],s.search.selectedLocation="",s.search.selectedRoles=[],s.search.broadCastConcepts(),s.search.filters={},s.isSearchResultsPage=!1,s.isSearchPage=!0,s.search.selectedGrades=[],s.search.selectedOrgType=[],e.search.searchRequest()},s.search.applySorting=function(){var r=s.search.sortByOption;s.search.sortBy={},s.search.sortBy[r]=!0===s.search.sortIcon?"asc":"desc",e.search.searchRequest()},s.search.close=function(){"Users"!==s.search.selectedSearchKey&&"Organisations"!==s.search.selectedSearchKey||c.go("Profile"),"All"===s.search.selectedSearchKey?c.go("Home"):"Library"===s.search.selectedSearchKey?c.go("Resources"):c.go(s.search.selectedSearchKey)},s.search.setSearchKey=function(e){s.$emit("setSearchKey",{key:e}),s.$emit("DynsetSearchKey",{key:e})},e.$on("$destroy",function(){S(),f(),p()}),s.search.setPage=function(r){e.search.autoSuggest=!1,r<1||r>s.search.pager.totalPages||e.search.handleSearch(r)},s.search.getOrgTypes=function(){o.getOrgTypeS().then(function(e){s.search.orgTypes=e})},s.search.getOrgTypes(),s.search.getSelectedContentTypeValue=function(e,s){var r=_.filter(e,function(e){return e.key===s});return r?r[0].value:""},s.lineInView=function(e,r,a,c){var t=_.filter(s.inviewLogs,function(e){return e.objid===a.identifier});!0===r&&0===t.length&&s.inviewLogs.push({objid:a.identifier,objtype:c,index:e}),u.setVisitData(s.inviewLogs)}}]);
"use strict";angular.module("playerApp").controller("ConceptPickerController",["$scope","$rootScope","$timeout","searchService","toasterService",function(e,t,n,c,o){e.loadConceptTree=function(){e.conceptLoader=o.loader("",t.messages.stmsg.m0049),t.concepts?e.loadDomains(!1,t.concepts):t.getConcept(0,200,e.loadDomains)},e.loadDomains=function(n,s){if(n&&!0===n)o.error(t.messages.fmsg.m0015);else{t.concepts=s;var i=[],r={filters:{objectType:["Dimension","Domain"]}};c.search(r).then(function(n){n.result&&_.isArray(n.result.domains)&&(_.forEach(n.result.domains,function(c){var o={};o.id=c.identifier,o.name=c.name;var s=[];_.forEach(e.getChild(c.identifier,n.result.dimensions),function(n){var c={};c.id=n.id,c.name=n.name,c.nodes=e.getChild(n.id,t.concepts),s.push(c)}),o.nodes=s,i.push(o)}),t.conceptData=i,e.conceptLoader.showLoader=!1,e.initConceptBrowser())})}},e.initConceptBrowser=function(){e.selectedConcepts=e.selectedConcepts||[],e.contentConcepts=_.map(e.selectedConcepts,"identifier"),e.pickerMessage=e.contentConcepts.length+" concepts selected",$(".tree-picker-selector").val(e.pickerMessage),n(function(){$(".tree-picker-selector").treePicker({data:t.conceptData,name:"Concepts",picked:e.contentConcepts,onSubmit:function(n){$(".tree-picker-selector").val(n.length+" concepts selected"),_.defer(function(){e.$apply()}),e.contentConcepts=[],_.forEach(n,function(t){e.contentConcepts.push({identifier:t.id,name:t.name})}),e.selectedConcepts=e.contentConcepts,t.$broadcast("selectedConcepts",{selectedConcepts:e.selectedConcepts})},nodeName:"conceptSelector_treePicker",minSearchQueryLength:1})},500)},e.getChild=function(t,n){var c=[];return _.forEach(n,function(o){if(void 0!==o.parent&&o.parent[0]===t){var s={};s.id=o.identifier,s.name=o.name,s.selectable="selectable",s.nodes=e.getChild(o.identifier,n),c.push(s)}}),_.uniqBy(c,"id")},t.conceptData?e.initConceptBrowser():e.loadConceptTree(),e.isSearchPage&&t.$on("selectedConceptsFromSearch",function(t,n){e.selectedConcepts=n.selectedConcepts,e.initConceptBrowser()})}]);
"use strict";angular.module("playerApp").controller("AppCtrl",["$scope","permissionsService","$rootScope","userService","$q","config","$location","$timeout","telemetryService","messages","frmelmnts","sessionService","learnService","$http","searchService","toasterService","adminService","$state","$window",function(e,o,t,r,n,s,a,i,l,c,u,d,g,f,p,m,v,h,O){t.userId=$("#userId").attr("value"),t.sessionId=$("#sessionId").attr("value"),t.logSession=$("#logSession").attr("value"),t.cdnUrl=$("#cdnUrl").attr("value")||"",t.language=$("#defaultPortalLanguage").attr("value")||"en",t.content_channel_filter_type=$("#contentChannelFilterType").attr("value"),t.messages=c[t.language],t.frmelmnts=u[t.language],t.searchKey="",t.enrolledCourseIds={},l.setConfigData("env","home"),l.setConfigData("message","Content read"),org.sunbird.portal.appid=$("#producerId").attr("value"),t.contentModelSetBackLink=function(){t.contentModelBackLinkName=h.current.name},window.localStorage.redirectUrl&&(a.path(window.localStorage.redirectUrl),delete window.localStorage.redirectUrl),t.openLink=function(e){a.path(e)},e.$watch("$root.language",function(e,o){o!==e&&(window.localStorage.language=t.language,O.location.reload())}),t.mergeObjects=function(e,o){var t="";return Object.keys(e).length>0?(t=JSON.stringify(e)+JSON.stringify(o),t=t.replace(/\}\{/,","),t=JSON.parse(t)):t=o,t},$("body").click(function(e){if("search-suggestions"===$(e.target).closest("div.dropdown-menu-list").prop("id"))return!1;$("body").find(".dropdown-menu-list").removeClass("visible").addClass("hidden")}),e.logout=function(){window.document.location.replace("/logout")},e.userProfile=function(r){t.avatar=r.avatar,t.firstName=r.firstName,t.lastName=r.lastName;var n=[];t.organisations=r.organisations,t.profileCompleteness=r.completeness,t.profileMissingFields=r.missingFields||[];var s=[],a={};org.sunbird.portal.channel=_.get(r,"rootOrg.hashTagId"),t.rootOrgId=r.rootOrgId,t.rootOrgAdmin=!1;var i=[];_.forEach(r.organisations,function(e){e.roles&&_.isArray(e.roles)&&(n=_.union(n,e.roles),e.organisationId===r.rootOrgId&&(_.indexOf(e.roles,"ORG_ADMIN")>-1||_.indexOf(e.roles,"SYSTEM_ADMINISTRATION")>-1)&&(t.rootOrgAdmin=!0),a[e.organisationId]=e.roles),e.organisationId&&i.push(e.organisationId),e.orgName&&s.push(e.orgName)}),t.rootOrgId&&i.push(t.rootOrgId),_.get(r,"rootOrg.orgName")&&s.push(r.rootOrg.orgName),o.setRoleOrgMap(r),i=_.uniq(i),t.organisationNames=_.uniq(s),t.organisationIds=angular.copy(i),org.sunbird.portal.dims=_.concat(i,org.sunbird.portal.channel),o.setCurrentUserRoleMap(a),o.setCurrentUserRoles(n),t.initializePermissionDirective=!0,l.init(),e.logSessionStartEvent(),e.setRootOrgInfo(r)},e.logSessionStartEvent=function(){"false"===t.logSession&&f.get("/v1/user/session/start/"+IITBtelemetry.fingerPrintId,{headers:{"X-Channel-Id":org.sunbird.portal.channel}}).then(function(e){}).catch(function(){})},e.getTelemetryConfigData=function(){org.sunbird.portal.sid=t.sessionId,org.sunbird.portal.uid=t.userId,f.get("/get/envData").then(function(o){org.sunbird.portal.appid=o.data.appId,org.sunbird.portal.ekstep_env=o.data.ekstep_env,org.sunbird.portal.init(),l.init(),e.logSessionStartEvent()}).catch(function(){})},e.getTelemetryConfigData(),e.setRootOrgInfo=function(e){e.rootOrg&&(document.title=_.isUndefined(e.rootOrg.orgName)?"Sunbird":e.rootOrg.orgName,f.get("/v1/tenant/info/"+e.rootOrg.slug,{headers:{"X-Channel-Id":org.sunbird.portal.channel}}).then(function(e){if(e&&"OK"===e.statusText){t.orgLogo=e.data.result.logo;var o=document.createElement("link"),r=document.getElementById("dynamic-favicon");o.id="dynamic-favicon",o.rel="icon",o.href=e.data.result.favicon,r&&document.head.removeChild(r),document.head.appendChild(o)}}).catch(function(e){console.log("app controller",e),m.error(t.messages.fmsg.m0057)}))},e.getProfile=function(o){var n=r.getCurrentUserProfile();_.isEmpty(n)?r.getUserProfile(t.userId,o).then(function(o){if(o&&"OK"===o.responseCode){var t=o.result.response;r.setCurrentUserProfile(t),e.userProfile(t)}}).catch(function(e){console.log("err",e)}):e.userProfile(n)},e.getProfile("completeness,missingFields"),t.closeRoleAccessError=function(){t.accessDenied=""},e.getMyCourses=function(){d.setSessionData("ENROLLED_COURSES",void 0),g.enrolledCourses(t.userId).then(function(e){e&&"OK"===e.responseCode?(t.enrolledCourses=e.result.courses,t.enrolledCourseIds=t.arrObjsToObject(t.enrolledCourses,"courseId"),d.setSessionData("ENROLLED_COURSES",{uid:t.userId,courseArr:t.enrolledCourses,courseObj:t.enrolledCourseIds})):(t.enrolledCourses=void 0,d.setSessionData("ENROLLED_COURSES",void 0))})},t.arrObjsToObject=function(e,o){var t={};return e.forEach(function(e){t[e[o]]=e}),t},t.enrolledCourses||e.getMyCourses(),t.loadProgress=function(){$(".course-progress").progress("reset"),i(function(){$(".course-progress").progress()},100)},t.getConcept=function(o,r,n){var s={filters:{objectType:["Concept"]},offset:o,limit:r};p.search(s).then(function(s){s.result&&s.result&&_.isArray(s.result.concepts)&&(_.forEach(s.result.concepts,function(o){e.concepts.push(o)}),s.result.count>o&&s.result.count>o+r?(o+=r,r=s.result.count-r,t.getConcept(o,r,n)):n(null,e.concepts))}).catch(function(e){n(e,null)})},t.concepts||(e.concepts=[],t.getConcept(0,200,function(e,o){e?m.error(t.messages.fmsg.m0015):t.concepts=o})),e.getOrgTypes=function(){p.getOrgTypes().then(function(e){"OK"===e.responseCode&&p.setOrgTypes(e.result.response)})},e.openProfileView=function(){h.go("Profile")},t.generateInteractEvent=function(e,o,t,r,n,s,a){l.interactTelemetryData(e,o,t,r,n,s,a)},t.generateStartEvent=function(e,o,t,r,n,s,a){l.startTelemetryData(e,o,t,r,n,s,a)},t.generateEndEvent=function(e,o,t,r,n,s,a){l.endTelemetryData(e,o,t,r,n,s,a)},e.getOrgTypes(),O.onbeforeunload=function(){document.dispatchEvent(new CustomEvent("TelemetryEvent",{detail:{name:"window:unload"}}))}}]);
"use strict";angular.module("playerApp").controller("NoteListCtrl",["$rootScope","noteService","$state","$stateParams","$timeout","$q","toasterService",function(e,o,t,s,d,a,r){function n(t){var s="searchApi";i[s]={},i[s].loader=r.loader("",e.messages.stmsg.m0057),o.search(t).then(function(o){o&&o.responseCode===i.successResponseCode?(i[s].loader.showLoader=!1,i.notesList=o.result.response.note||[],i.selectedNoteData=i.notesList[0],i.showNoteList(i.notesList[0])):(i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0033))}).catch(function(){i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0033)})}var i=this;i.userId=e.userId,i.userName=e.firstName+" "+e.lastName,i.courseId=s.courseId,i.contentId=s.contentId,i.contentName=s.contentName,i.add={},i.update={},i.update.showUpdateNote=!1,i.add.showCreateNote=!1,i.sortBy="desc",i.successResponseCode="OK",i.getAllNotes=function(){n({request:{filters:{userId:i.userId,courseId:i.courseId,contentId:i.contentId},sort_by:{updatedDate:i.sortBy}}})},i.createNote=function(t){var s="createApi";i[s]={},i[s].loader=r.loader("",e.messages.stmsg.m0054);var d={request:{note:t.note,userId:i.userId,title:t.title,courseId:i.courseId,contentId:i.contentId,createdBy:i.userName,updatedBy:i.userId}};o.create(d).then(function(o){if(o&&o.responseCode===i.successResponseCode){i.add.showCreateNote=!1,i[s].loader.showLoader=!1;var t=angular.copy(d.request);t.createdDate=(new Date).toISOString(),t.updatedDate=(new Date).toISOString(),t.id=o.result.id,i.add={},i.notesList.push(t),i.showNoteList(t)}else i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0030)}).catch(function(){i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0030)})},i.removeNote=function(t){var s="removeApi";i[s]={},i[s].loader=r.loader("",e.messages.stmsg.m0056);var d={noteId:t};o.remove(d).then(function(o){o&&o.responseCode===i.successResponseCode?(i.hideRemoveNoteModel(),i.notesList=i.notesList.filter(function(e){return e.id!==t}),i[s].loader.showLoader=!1,i.showNoteList(i.notesList[i.notesList.length-1],i.notesList.length-1)):(i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0032))}).catch(function(){i[s].loader.showLoader=!1,r.error(e.messages.fmsg.m0032)})},i.openRemoveNoteModel=function(e){i.removeNoteId=e,i.showRemoveNoteModel=!0,d(function(){$("#removeNoteModal").modal({}).modal("show")},10)},i.hideRemoveNoteModel=function(){$("#removeNoteModal").modal("hide"),$("#removeNoteModal").modal("hide all"),$("#removeNoteModal").modal("hide other"),$("#removeNoteModal").modal("hide dimmer"),i.removeNoteId="",i.showRemoveNoteModel=!1},i.updateNote=function(t){var s={noteId:t.id,request:{note:t.note,title:t.title,tags:t.tags,updatedBy:i.userId}},d="updateApi";i[d]={},i[d].loader=r.loader("",e.messages.stmsg.m0059),o.update(s).then(function(o){if(o&&o.responseCode===i.successResponseCode){i.notesList=i.notesList.filter(function(e){return e.id!==t.id});var s=angular.copy(t);s.updatedDate=(new Date).toISOString(),i.notesList.push(s),i[d].loader.showLoader=!1,i.update={},i.showNoteList(s)}else i[d].loader.showLoader=!1,r.error(e.messages.fmsg.m0034)}).catch(function(){i[d].loader.showLoader=!1,r.error(e.messages.fmsg.m0034)})},i.closeNoteList=function(){var e={};i.courseId&&i.contentId?(e={courseId:i.courseId,contentId:i.contentId,lectureView:"no"},t.go("Toc",e)):i.courseId?(e={courseId:i.courseId,lectureView:"yes"},t.go("Toc",e)):i.contentId&&(e={contentId:i.contentId,contentName:i.contentName},t.go("Player",e))},i.updateNoteData=function(e){i.update.metaData=angular.copy(e)},i.showNoteList=function(e,o){i.selectedIndex=o,"0"!==i.selectedIndex?$("#notelistcontent0").removeClass("notelistborder"):$("#notelistcontent0").addClass("notelistborder"),i.selectedNoteData=e},i.insertImage=function(){var e=a.defer();return i.openAddImageModal(function(o){o?e.resolve(o):e.reject()}),e.promise},i.openAddImageModal=function(e){i.showAddImageModal=!0,$(".wmd-prompt-background").css("z-index",0),$(".wmd-prompt-background").css("position","initial"),d(function(){$("#showAddImageModal").modal({onShow:function(){i.imageLink="http://"},onHide:function(){return i.showAddImageModal=!1,e(i.imageLink)}}).modal("show")},10)},i.closeAddImageModal=function(e){e&&(i.imageLink=""),$("#showAddImageModal").modal("hide"),$("#showAddImageModal").modal("hide others"),$("#showAddImageModal").modal("hide all"),$("#showAddImageModal").modal("hide dimmer")}}]);
"use strict";angular.module("playerApp").controller("courseScheduleCtrl",["$rootScope","$stateParams","courseService","toasterService","$timeout","contentStateService","$scope","$location","batchService","dataService","sessionService","$anchorScroll","permissionsService","$state","telemetryService","$window",function(e,t,n,o,s,r,a,c,i,u,d,l,m,p,C,h){var g=this;g.isTelemtryStarted=!1,g.getCourseToc=function(){g.loader=o.loader("",e.messages.stmsg.m0003),n.courseHierarchy(g.courseId).then(function(t){if(t&&"OK"===t.responseCode){if("Live"!==t.result.content.status&&"Unlisted"!==t.result.content.status&&"Flagged"!==t.result.content.status){g.loader.showLoader=!1,o.warning(e.messages.imsg.m0026);var n=JSON.parse(h.localStorage.getItem("previousURl"));return void p.go(n.name,n.params)}t.result.content.children=_.sortBy(t.result.content.children,["index"]),g.courseContents=g.getCourseContents(t.result.content,[]),g.courseTotal=g.courseContents.length,g.version=t.ver,g.contentCountByType=_.countBy(g.courseContents,"mimeType"),"ENROLLED_COURSE"===g.courseType?g.getContentState(function(){g.courseHierarchy=t.result.content,g.showBatchCardList()}):g.courseHierarchy=t.result.content}else o.error(e.messages.fmsg.m0003);g.loader.showLoader=!1}).catch(function(){g.loader.showLoader=!1,o.error(e.messages.fmsg.m0003)})},g.getContentState=function(e){var t={request:{userId:g.userId,courseIds:[g.courseId],contentIds:_.map(g.courseContents,"identifier")}};g.courseProgress=0,r.getContentsState(t,function(t){_.forEach(t,function(e){g.contentStatusList[e.contentId]=g.contentStatusClass[e.status]||g.contentStatusClass[0],2===e.status&&(g.courseProgress+=1)}),e()})},g.getCourseContents=function(e,t){return"application/vnd.ekstep.content-collection"!==e.mimeType?t.push(e):angular.forEach(e.children,function(n,o){g.getCourseContents(e.children[o],t)}),t},g.scrollToPlayer=function(){c.hash(g.hashId),s(function(){l("tocPlayer")},500)},g.initTocView=function(){s(function(){$(".toc-tree-item").fancytree({click:function(e,t){"title"===t.targetType&&(t.targetType="expander",g.openContent(t.node.key))}}),$(".ui.accordion").accordion({exclusive:!1}),$(".fancytree-container").addClass("fancytree-connectors"),g.openRecentCollection()},100)},g.openRecentCollection=function(){s(function(){g.itemIndex>=0&&$(".fancy-tree-container").each(function(){var t=this.id;$(this).fancytree("getTree").visit(function(n){n.key===e.contentId?(s(function(){$("#"+t).closest(".accordion").find(".title").hasClass("active")||$("#"+t).closest(".accordion").find(".title").trigger("click"),n.setActive(!1)},10),n.setExpanded(!0),n.setActive(!0),n.setFocus(!1),$("#resume-button-"+g.itemIndex).removeClass("contentVisibility-hidden")):(n.setActive(!1),n.setFocus(!1))})})},100)},g.getContentIcon=function(e,t){return t=t||"",{"application/pdf":"/common/images/pdf"+t+".png","video/mp4":"/common/images/video"+t+".png","video/webm":"/common/images/video"+t+".png","video/x-youtube":"/common/images/video"+t+".png","video/youtube":"/common/images/video"+t+".png","application/vnd.ekstep.html-archive":"/common/images/app"+t+".png","application/vnd.ekstep.ecml-archive":"/common/images/app"+t+".png","application/epub":"/common/images/app"+t+".png","application/vnd.ekstep.h5p-archive":"/common/images/video"+t+".png","application/vnd.ekstep.content-collection":"/common/images/folder.png"}[e]},g.expandAccordion=function(e){var t=$(e.target).closest(".title").find("i");g.updateAccordionIcon(t,!$(t).hasClass("plus"))},g.updateAccordionIcon=function(e,t){t?$(e).addClass("plus").removeClass("minus"):$(e).addClass("minus").removeClass("plus")},g.updateCourseProgress=function(){s(function(){var e=parseInt(100*g.courseProgress/g.courseTotal,10);$("#tocProgress").progress({percent:e})},500);var t=_.find(e.enrolledCourses,{courseId:g.courseId});t&&g.itemIndex>=0&&(t.lastReadContentId=g.courseContents[g.itemIndex].identifier,e.enrolledCourseIds[g.courseId].lastReadContentId=t.lastReadContentId,t.progress=g.courseProgress,e.enrolledCourseIds[g.courseId].progress=t.progress)},a.$watch("contentPlayer.isContentPlayerEnabled",function(e,t){$(".toc-resume-button").addClass("contentVisibility-hidden"),!0===t&&!1===e&&(g.hashId="",c.hash(g.hashId),g.getContentState(function(){g.updateCourseProgress()}),g.updateBreadCrumbs())}),g.batchCardShow=!0,g.batchDetailsShow=!1,g.showBatchCardList=function(){var n=_.find(e.enrolledCourses,function(e){return e.courseId===g.courseId});_.isUndefined(n)||(g.batchCardShow=!1,i.getBatchDetails({batchId:n.batchId}).then(function(n){n&&"OK"===n.responseCode&&!_.isEmpty(n.result.response)&&(g.batchDetailsShow=!0,g.selectedBatchInfo=n.result.response,e.batchHashTagId=n.result.response.hashtagid,g.selectedParticipants=_.isUndefined(g.selectedBatchInfo.participant)?0:_.keys(g.selectedBatchInfo.participant).length,g.batchStatus=g.selectedBatchInfo.status,g.batchStatus&&g.batchStatus>0&&"Flagged"!==g.courseHierarchy.status&&(g.playContent=!0,g.batchStatus<2&&!u.getData("contentStateInit")&&e.isTocPage&&(r.init(),u.setData("contentStateInit",!0),u.setData("isTrackingEnabled",!0)),e.isTocPage&&"no"===t.lectureView&&g.resumeCourse()))}).catch(function(){o.error(e.messages.fmsg.m0054)}))},g.openContent=function(t,n){if(!0===g.playContent){g.itemIndex=_.findIndex(g.courseContents,{identifier:t});var o=g.courseContents[g.itemIndex];o&&"application/vnd.ekstep.content-collection"!==o.mimeType&&(g.prevPlaylistItem=g.itemIndex-1>-1?g.courseContents[g.itemIndex-1].identifier:-1,g.nextPlaylistItem=g.itemIndex+1<g.courseContents.length?g.courseContents[g.itemIndex+1].identifier:-1,g.previousPlayListName=g.itemIndex-1>-1?g.courseContents[g.itemIndex-1].name:"No content to play",g.nextPlayListName=g.itemIndex+1<g.courseContents.length?g.courseContents[g.itemIndex+1].name:"No content to play",e.contentId=t,a.contentPlayer.contentData=o,a.contentPlayer.isContentPlayerEnabled=!0,g.hashId="tocPlayer/"+t+"/"+g.itemIndex,g.objRollup=[t],g.scrollToPlayer(),g.updateBreadCrumbs())}},g.updateBreadCrumbs=function(){if(e.breadCrumbsData=[{name:"Home",link:"home"},{name:"Courses",link:"learn"},{name:g.courseHierarchy.name,link:"/course//"+g.courseId+"/"+g.lectureView}],a.contentPlayer.isContentPlayerEnabled){var n=g.courseContents[g.itemIndex].name;g.courseParams={},g.courseParams.contentName=n,g.courseParams.contentId=e.contentId,g.courseParams.contentIndex=g.itemIndex,g.courseParams.courseId=g.courseId,g.courseParams.lectureView=t.lectureView;var o={name:n,link:""};d.setSessionData("COURSE_PARAMS",g.courseParams),e.breadCrumbsData[3]?e.breadCrumbsData[3]=o:e.breadCrumbsData.push(o)}},g.resumeCourse=function(){if(g.showCourseDashboard=!1,!1===g.isTelemtryStarted&&(C.startTelemetryData("course",g.courseId,"course","1.0","player","course-read","play"),g.isTelemtryStarted=!0,u.setData("isTelemtryStarted",!0)),g.courseContents.length>0)if(e.isTocPage)if(c.hash().indexOf("tocPlayer")<0){var n=t.lastReadContentId||g.courseContents[0].identifier;g.openContent(n),g.objRollup=[n]}else{var o=c.hash().toString().split("/");g.openContent(o[1])}else{var s=d.getSessionData("COURSE_PARAMS");d.setSessionData("COURSE_PARAMS",s),p.go("Toc",s)}},g.init=function(){g.courseId=t.courseId,g.courseType=e.enrolledCourseIds[g.courseId]?"ENROLLED_COURSE":"OTHER_COURSE",g.playContent=!1,g.contentStatusList={},g.contentStatusClass={0:"grey",1:"blue",2:"green"},g.userId=e.userId,a.contentPlayer={isContentPlayerEnabled:!1},g.showNoteInLecture=!0,g.itemIndex=-1,g.showCourseDashboard=!1,g.isCourseMentor=!1,-1!==m.getCurrentUserRoles().indexOf("COURSE_MENTOR")&&(g.isCourseMentor=!0),g.getCourseToc()},g.initDropdownValues=function(){$("#courseDropdownValues").dropdown()},$("#courseDropdownValues").dropdown("restore defaults"),g.generateInteractEvent=function(e,t,n,o,s,r,a){C.interactTelemetryData(e,t,n,o,s,r,a)}}]);
"use strict";angular.module("playerApp").controller("LearnCtrl",["learnService","$scope","$state","$rootScope","sessionService","toasterService","telemetryService",function(e,r,s,o,n,t,a){var i=this,l=o.userId;r.contentPlayer={isContentPlayerEnabled:!1},i.openCourseView=function(e,r){o.search.searchKeyword="";var t="no";t=o.enrolledCourseIds[e.courseId||e.identifier]?"no":"yes";var i={courseType:r,courseId:e.courseId||e.identifier,lectureView:t,progress:e.progress,total:o.enrolledCourseIds[e.courseId].leafNodesCount,courseName:e.courseName||e.name,lastReadContentId:e.lastReadContentId};n.setSessionData("COURSE_PARAMS",i),o.isPlayerOpen=!0,s.go("Toc",i),a.interactTelemetryData("course",e.courseId,"course",o.version,"course-read","course")},i.courses=function(){var r="enrollCourseApi";i[r]={},i[r].loader=t.loader("",o.messages.stmsg.m0001),e.enrolledCourses(l).then(function(e){e&&"OK"===e.responseCode?(i[r].loader.showLoader=!1,o.enrolledCourses=e.result.courses,o.enrolledCourseIds=o.arrObjsToObject(o.enrolledCourses,"courseId"),i.enrolledCourses=o.enrolledCourses):(i[r].loader.showLoader=!1,t.error(o.messages.fmsg.m0001))}).catch(function(){i[r].loader.showLoader=!1,t.error(o.messages.fmsg.m0001)})},o.enrolledCourseIds&&!_.isEmpty(o.enrolledCourseIds)?i.enrolledCourses=o.enrolledCourses:i.courses();var d=[];i.lineInView=function(e,r,s,n,t){var i=_.filter(d,function(e){return e.objid===s.identifier}),l=angular.element("#"+t+"_"+s.identifier).attr("aria-hidden");!0===r&&0===i.length&&"false"===l&&d.push({objid:s.identifier,objtype:s.contentType||"course",section:n,index:e}),o.$broadcast("mycoursesVisit",d),a.setVisitData(d)},o.$on("mycoursesVisit",function(e,r){o.visitData=r})}]);
"use strict";angular.module("playerApp").controller("resourceCtrl",["$state","sessionService",function(e,o){var t=this;t.contentPlayer={isContentPlayerEnabled:!1},t.playContent=function(o){var t={content:o,contentName:o.name,contentId:o.identifier};e.go("Player",t)},t.openCourseView=function(t,r){var n={courseType:r,courseId:t.courseId||t.identifier,lectureView:"no",progress:t.progress,total:t.total,courseRecordId:t.id,courseName:t.courseName};o.setSessionData("COURSE_PARAMS",n),e.go("Toc",n)}}]);
"use strict";angular.module("playerApp").controller("CommunityController",["$rootScope","telemetryService",function(e,o){this.showDetail=!1,o.impressionTelemetryData("groups","","community","1.0","scroll","group-read","/community")}]);
"use strict";angular.module("playerApp").controller("HomeController",["$state","learnService","$rootScope","sessionService","toasterService","telemetryService",function(e,o,r,s,t,n){var i=this;i.showBrowserMsg=!1,i.loadCarousel=function(){$(".ui .progress .course-progress").progress(),$(".ui.rating").rating({maxRating:5}).rating("disable",!0)},i.loadFeaturedCarousel=function(){$(".ui.rating").rating({maxRating:5}).rating("disable",!0)},i.getToDoList=function(){r.toDoList=[],r.profileCompleteness<100&&(r.toDoList=[{title:r.messages.stmsg.m0060,missingFields:r.profileMissingFields,value:r.profileCompleteness,userId:r.userId,type:"profile"}]),Array.prototype.push.apply(r.toDoList,r.enrolledCourses)},i.otherSection=function(){var e={request:{recommendType:"course"}},s="pageApi";i[s]={},i[s].loader=t.loader("",r.messages.stmsg.m0002),o.recommendedCourses(e).then(function(e){e&&"OK"===e.responseCode?(i.recommendedCourse=e.result.response,i[s].loader.showLoader=!1):(i[s].loader.showLoader=!1,t.error(r.messages.fmsg.m0002))}).catch(function(){i[s].loader.showLoader=!1,t.error(r.messages.fmsg.m0002)})},i.openCourseView=function(o,t){var n="no";n=r.enrolledCourseIds[o.courseId||o.identifier]?"no":"yes";var i={courseType:t,courseId:o.courseId||o.identifier,lectureView:n,progress:o.progress,total:o.total,courseRecordId:o.id,courseName:o.courseName||o.name,lastReadContentId:o.lastReadContentId};s.setSessionData("COURSE_PARAMS",i),e.go("Toc",i)},i.generateInteractEvent=function(e,o,r,s,t,i,a){n.interactTelemetryData(e,o,r,s,t,i,a)};var a=[];i.lineInView=function(e,o,s,t){var i=_.filter(a,function(e){return e.objid===(s.courseId||r.userId)}),l=angular.element("#"+e).attr("aria-hidden");!0===o&&0===i.length&&"false"===l&&a.push({objid:s.courseId||r.userId,objtype:"home",section:t,index:e}),n.setVisitData(a)},!1==(!!window.chrome&&!!window.chrome.webstore)&&(i.showBrowserMsg=!0,"shown"!==localStorage.getItem("#BrowserIncompatibleModel")&&setTimeout(function(){$("#BrowserIncompatibleModel").modal({onHide:function(){}}).modal("show")},0)),i.showBrowserIncompatibleModel=function(){$("#BrowserIncompatibleModel").modal({onHide:function(){}}).modal("show")},i.hideModel=function(){localStorage.setItem("#BrowserIncompatibleModel","shown"),$("#BrowserIncompatibleModel").modal("hide"),$("#BrowserIncompatibleModel").modal("hide others"),$("#BrowserIncompatibleModel").modal("hide dimmer")}}]);
"use strict";angular.module("playerApp").controller("ProfileController",["$scope","$rootScope","contentService","userService","toasterService","config","$timeout","$filter","uuid4","formValidation","searchService","$state","learnService","adminService","workSpaceUtilsService","configService","$q","$anchorScroll","telemetryService",function(e,s,r,a,t,n,o,i,d,l,c,u,f,m,g,p,b,y,h){var v=this;v.defaultLimit=4,v.limit=v.defaultLimit,v.resetLimit=0,v.userId=s.userId,v.formElmnt=p.getProfileAddInfformElmnt(),v.languages=v.formElmnt.languages,v.subjects=v.formElmnt.subjects,v.yearOfPassing=p.getYearOfPassingValues(),v.grades=v.formElmnt.grades,v.experienceForm=!1,v.isCurrentJobExist=!1,v.profileSummary="",v.isError=!1,v.contentSortBy="desc",v.quantityOfContent=4,v.isViewMore=!0,v.isSameAddressTypeExist=!1,v.fieldsToBeValidate=[];var P=new Date,w=[];_.forEach(s.organisations,function(e){e.organisationId&&w.push(e.organisationId)}),v.generateInteractEvent=function(e){var r=h.ProfileSectionConfig[e];h.interactTelemetryData("profile",s.userId,e,"1.0",r,"profile-read")},v.formateDate=function(e){e.length&&e.forEach(function(e){e.updatedDate&&(e.updatedDate=new Date(e.updatedDate))},this)},v.processProfileData=function(e){if(v.loader.showLoader=!1,e&&"OK"===e.responseCode){var r=angular.copy(e.result.response);if(v.user=r,v.user.profileVisibility=r.profileVisibility,v.fullName=r.firstName+" "+r.lastName,v.email=r.email,r.dob=r.dob?new Date(r.dob):r.dob,v.formateDate(r.jobProfile),v.formateDate(r.address),v.formateDate(r.education),v.isAvatarUpdate&&(s.avatar=r.avatar),v.address=angular.copy(r.address),v.education=angular.copy(r.education),v.experience=angular.copy(r.jobProfile),v.user.lastLoginTime>0&&(v.lastLoginTime=angular.copy(v.user.lastLoginTime)),v.badgeAssertions=r.badgeAssertions,r.completeness&&(s.profileCompleteness=r.completeness,$(".profile-progress").progress({percent:s.profileCompleteness})),r.missingFields&&(s.profileMissingFields=r.missingFields),v.user.profileVisibility?s.privateProfileFields=Object.keys(v.user.profileVisibility):s.privateProfileFields=[],v.user.webPages){var a={};a.fb=v.user.webPages.find(function(e){return"fb"===e.type})||{type:"fb",url:""},a.twitter=v.user.webPages.find(function(e){return"twitter"===e.type})||{type:"twitter",url:""},a.in=v.user.webPages.find(function(e){return"in"===e.type})||{type:"in",url:""},a.blog=v.user.webPages.find(function(e){return"blog"===e.type})||{type:"blog",url:""},v.user.socialMedia=a}v.userSkills=void 0!==v.user.skills?v.user.skills:[],v.basicProfile=angular.copy(v.user)}else v.loader.showLoader=!1,v.isError=!0,t.error(s.messages.fmsg.m0005)},v.getProfile=function(e){v.loader=t.loader("",s.messages.stmsg.m0074),a.getUserProfile(v.userId,e).then(function(e){v.processProfileData(e)}).catch(function(){v.loader.showLoader=!1,v.isError=!0,t.error(s.messages.fmsg.m0005)}),h.impressionTelemetryData("profile",v.userId,"user","1.0","scroll","profile-read","/profile")},v.updateProfile=function(e){return e.userId=s.userId,v.updateProfileRequest={id:d.generate(),ts:i("date")(new Date,"yyyy-MM-dd HH:mm:ss:sssZ"),params:{},request:e},v.disableSave=!0,v.loader=t.loader("",s.messages.stmsg.m0075),a.updateUserProfile(v.updateProfileRequest,v.fullName,v.email).then(function(e){if(v.disableSave=!1,e&&"OK"===e.responseCode)return!0;throw"CLIENT_ERROR"===e.responseCode?new Error(e.params.errmsg):new Error("")}).catch(function(e){throw e.message?new Error(e.message):new Error(s.messages.fmsg.m0048)})},v.updateUserInfo=function(e,s,r,a){v.updateProfile(e).then(function(){v[s]=!1,t.success(r),v.getProfile("completeness,missingFields")}).catch(function(e){v.loader.showLoader=!1,e.message?t.error(e.message):t.error(a)})},v.openImageBrowser=function(){$("#iconImageInput").click()},v.validateAvatar=function(e){var r=b.defer(),a=new FormData,o=new FileReader,i=n.ERROR.PROFILE_IMAGE_UPLOAD.err,d=n.ERROR.PROFILE_IMAGE_UPLOAD.errorType;if(e[0]&&e[0].name.match(/.(jpg|jpeg|png)$/i)&&e[0].size<4e6)return a.append("file",e[0]),o.readAsDataURL(e[0]),v.icon=a,v.iconUpdate=!0,r.resolve(!0),r.promise;throw t.warning(s.messages.imsg.m0005),h.errorTelemetryData("profile",v.userId,"profile-image","1.0",i,d,s.messages.imsg.m0005,"profile-read"),new Error("")},v.updateAvatar=function(e){try{v.validateAvatar(e).then(function(){v.icon.append("container","user/"+v.userId),r.uploadMedia(v.icon).then(function(e){if(e&&"OK"===e.responseCode){v.isAvatarUpdate=!0,v.updateProfile({avatar:e.result.url});var r={avatar:e.result.url};v.updateUserInfo(r,"basicProfileForm",s.messages.smsg.m0018,s.messages.fmsg.m0035)}else v.error=t.error(s.messages.fmsg.m0048)}).catch(function(){v.loader.showLoader=!1,v.error=t.error(s.messages.fmsg.m0048)})})}catch(e){}},v.webLink=function(){if(v.user.webPages){var e=[];return Object.keys(v.user.socialMedia).forEach(function(s){v.user.socialMedia[s].url.length&&e.push({type:s,url:v.user.socialMedia[s].url})}),e}return[]},v.EditBasicProfile=function(){v.fieldsToBeValidate=v.getFieldsToValidate("#basicInfoForm");var e=$("#editDob").calendar("get date"),r={firstName:v.user.firstName,lastName:v.user.lastName,gender:v.user.gender,dob:e instanceof Date?i("date")(e,"yyyy-MM-dd"):null,language:v.user.language,subject:v.user.subject,grade:v.user.grade,location:v.user.location};if(v.fieldsToBeValidate.length){if(!0!==l.validate("#basicInfoForm",v.fieldsToBeValidate))return!1;var a=v.webLink();v.webPages=a,r.webPages=v.webPages,v.updateUserInfo(r,"basicProfileForm",s.messages.smsg.m0022,s.messages.fmsg.m0039)}else v.user.firstName&&v.user.language.length?v.updateUserInfo(r,"basicProfileForm",s.messages.smsg.m0022,s.messages.fmsg.m0039):t.error(s.messages.fmsg.m0076)},v.addAddress=function(e){v.fieldsToBeValidate=v.getFieldsToValidate("#addressForm");var r;if(e.addressLine1&&e.city)if(v.fieldsToBeValidate.length){if(!0!==l.validate("#addressForm",v.fieldsToBeValidate))return!1;v.address.push(e),r={address:v.address},v.updateUserInfo(r,"addressForm",s.messages.smsg.m0026,s.messages.fmsg.m0046)}else r={address:v.address},v.updateUserInfo(r,"addressForm",s.messages.smsg.m0026,s.messages.fmsg.m0046);else t.error(s.messages.fmsg.m0076)},v.editAddress=function(e){v.fieldsToBeValidate=v.getFieldsToValidate("#addressForm");var r=l.validate(".addressForm",v.fieldsToBeValidate);if(!0!==r&&r.includes(!1))return!1;var a={address:e};v.updateUserInfo(a,"addressForm",s.messages.smsg.m0023,s.messages.fmsg.m0040)},v.deleteAddress=function(e){e.isDeleted=!0;var r={address:[e]};v.updateUserInfo(r,"addressForm",s.messages.smsg.m0016,s.messages.fmsg.m0043)},v.addEducation=function(e){v.fieldsToBeValidate=v.getFieldsToValidate(".educationForm");var r,a=angular.copy(e);if(e.degree&&e.name)if(v.fieldsToBeValidate.length){if(!0!==l.validate(".educationForm",v.fieldsToBeValidate))return!1;a.percentage=a.percentage?parseFloat(a.percentage):0,a.yearOfPassing=a.yearOfPassing?parseInt(a.yearOfPassing):0;var n=angular.copy(v.education);n.push(a),n.forEach(function(e){e.percentage=e.percentage?parseFloat(e.percentage):0,e.yearOfPassing=e.yearOfPassing?parseInt(e.yearOfPassing):0}),r={education:n},v.updateUserInfo(r,"educationForm",s.messages.smsg.m0024,s.messages.fmsg.m0044)}else r={education:v.education},v.updateUserInfo(r,"educationForm",s.messages.smsg.m0024,s.messages.fmsg.m0044);else t.error(s.messages.fmsg.m0076)},v.editEducation=function(e){v.fieldsToBeValidate=v.getFieldsToValidate(".educationForm");var r=l.validate(".educationForm",v.fieldsToBeValidate);if(!0!==r&&r.includes(!1))return!1;e.forEach(function(e){e.percentage=e.percentage?parseFloat(e.percentage):0,e.yearOfPassing=e.yearOfPassing?parseInt(e.yearOfPassing):0});var a={education:e};v.updateUserInfo(a,"educationForm",s.messages.smsg.m0020,s.messages.fmsg.m0037)},v.deleteEducation=function(e){e.forEach(function(e){e.percentage=e.percentage?parseFloat(e.percentage):0,e.yearOfPassing=e.yearOfPassing?parseInt(e.yearOfPassing):0});var r={education:e};r.userId=s.userId,v.updateUserInfo(r,"educationForm",s.messages.smsg.m0014,s.messages.fmsg.m0041)},v.addExperience=function(e){v.fieldsToBeValidate=v.getFieldsToValidate(".jobProfileForm");var r;if(e.jobName&&e.orgName)if(v.fieldsToBeValidate.length){if(!0!==l.validate(".jobProfileForm",v.fieldsToBeValidate))return!1;var a=$("#rangestartAdd").calendar("get date"),n=$("#rangeendAdd").calendar("get date");e.isCurrentJob=e.isCurrentJob?"true"===e.isCurrentJob:null,n=e.isCurrentJob?null:n,e.joiningDate=a instanceof Date?i("date")(a,"yyyy-MM-dd"):null,e.endDate=n instanceof Date?i("date")(n,"yyyy-MM-dd"):null,e.userId=s.userId,v.experience.push(e),r={jobProfile:v.experience},v.updateUserInfo(r,"experienceForm",s.messages.smsg.m0025,s.messages.fmsg.m0045)}else r={jobProfile:v.experience},v.updateUserInfo(r,"experienceForm",s.messages.smsg.m0025,s.messages.fmsg.m0045);else t.error(s.messages.fmsg.m0076)},v.editExperience=function(e){v.fieldsToBeValidate=v.getFieldsToValidate(".jobProfileForm");var r=l.validate(".jobProfileForm",v.fieldsToBeValidate);if(!0!==r&&r.includes(!1))return!1;e.length&&e.forEach(function(e,s){var r=$(".rangeStart").calendar("get date"),a=$(".rangeEnd").calendar("get date");r instanceof Array&&a instanceof Array?(e.joiningDate=r?i("date")(r[s],"yyyy-MM-dd"):e.joiningDate,e.endDate=a?i("date")(a[s],"yyyy-MM-dd"):e.endDate):(e.joiningDate=r?i("date")(r,"yyyy-MM-dd"):e.joiningDate,e.endDate=a?i("date")(a,"yyyy-MM-dd"):e.endDate)},this);var a={jobProfile:e};v.updateUserInfo(a,"experienceForm",s.messages.smsg.m0021,s.messages.fmsg.m0038)},v.deleteExperience=function(e){var r={jobProfile:[e]};r.userId=s.userId,v.updateUserInfo(r,"experienceForm",s.messages.smsg.m0015,s.messages.fmsg.m0042)},v.EditDetails=function(e){var r={profileSummary:e};v.updateUserInfo(r,"openDiscriptionEdit",s.messages.smsg.m0019,s.messages.fmsg.m0061)},v.setEditStart=function(e,s,r){o(function(){$("#"+e+s).calendar("set date",r)},500)},v.setEditEnd=function(e,s,r){o(function(){$("#"+e+s).calendar("set date",r)},500)},v.setDob=function(){$("#editDob").calendar("set date",v.user.dob),$("#editDob").calendar({maxDate:new Date(P.getFullYear(),P.getMonth(),P.getDate()),type:"date"}),o(function(){e.dobVis=!0},100)},o(function(){$(".ui.radio.checkbox").checkbox("attach events",".toggle.button").checkbox({onChange:function(){}})},1e3),v.setDropdownValue=function(){o(function(){$("#languageSelect").dropdown(),$("#languageSelect").dropdown("refresh"),$("#languageSelect").dropdown("set selected",v.user.languages)},100)},v.setSubject=function(){o(function(){$("#setSubjects").dropdown(),$("#setSubjects").dropdown("refresh"),$("#setSubjects").dropdown("set selected",v.user.subjects)},100)},v.setPassingYears=function(){o(function(){$("#passingYears").dropdown(),$("#passingYears").dropdown("refresh"),$("#passingYears").dropdown("set selected",v.yearOfPassing)},100)},v.setEditSubject=function(e,s,r){o(function(){var a="#"+e+s;$(a).dropdown(),$(a).dropdown("refresh"),$(a).dropdown("set selected",r)},100)},v.checkCurrentJob=function(e,s){var r=v.experience.find(function(e){return!0===e.isCurrentJob});r&&r.id!==e.id&&!0===s?v.isCurrentJobExist=!0:(v.isCurrentJobExist=!1,e.isCurrentJob=s)},v.setJobProfileCheckbox=function(e,s){e.isCurrentJob=s},v.getContentLogo=function(e){var s=e.appIcon,r=e.mimeType;if(s)return e.appIcon;switch(r){case n.MIME_TYPE.pdf:return"/common/images/pdf.png";case n.MIME_TYPE.mp4:case n.MIME_TYPE.webm:return"/common/images/mp4.png";case n.MIME_TYPE.pYoutube:case n.MIME_TYPE.youtube:return"/common/images/youtubeFileIcon.jpg";case n.MIME_TYPE.h5p||n.MIME_TYPE.ePub:default:return"/common/images/zipFileIcon.png"}},v.getProfile("lastLoginTime"),v.getCreatedContentList=function(){var e={filters:{createdBy:v.userId,status:["Live"],contentType:n.contributeContentType},sort_by:{lastUpdatedOn:v.contentSortBy}};c.search(e).then(function(e){e&&"OK"===e.responseCode&&(v.contentList=e.result.content||[])}).catch(function(){})},v.openContentPlayer=function(e){"application/vnd.ekstep.content-collection"===e.mimeType?g.previewCollection(e,u.current.name):g.previewContent(e,u.current.name)},v.setSelectedGrades=function(){o(function(){$("#selectGrades").dropdown(),$("#selectGrades").dropdown("refresh"),$("#selectGrades").dropdown("set selected",v.user.grade)},100)},v.cancelEditExperience=function(){v.experienceForm=!1,v.isCurrentJobExist=!1,v.experience=v.getProfileObject(v.user.jobProfile)},v.getProfileObject=function(e){return angular.copy(e)},v.updateAction=function(e){switch(e){case"education":v.educationForm=!0,v.isNewEducation=!0,v.newEducation={},o(function(){y("educationForm")},100);break;case"jobProfile":v.experienceForm=!0,v.isNewExperience=!0,v.newExperience={},o(function(){y("jobProfileForm")},100);break;case"address":v.addressForm=!0,v.isNewAddress=!0,v.newAddress={},o(function(){y("addressForm")},100);break;case"avatar":v.openImageBrowser();break;case"profileSummary":v.openDiscriptionEdit=!0;break;case"lastName":case"email":case"phone":case"dob":case"gender":case"grade":case"language":case"location":case"subject":v.basicProfileForm=!0,o(function(){y("basicInfoForm")},100)}},v.getSkills=function(){a.getSkills().then(function(e){"OK"===e.responseCode&&(v.skills=e.result.skills)})},v.getSkills(),v.openAddSkillModal=function(){o(function(){$("#addSkillModal").modal({onShow:function(){$("#addSkill").dropdown("clear");var e=!1;$.fn.dropdown.settings.templates.addition=function(s){var r="Add ";return e||(r="Add "),r+='" <strong>'+s+'</strong> "'},$("#addSkill").dropdown({allowAdditions:!0,hideAdditions:!1,minCharacters:2,showNoResults:!0,onChange:function(e){},message:{addResult:"{term}"},onAdd:function(e,s,r){$(this).dropdown("remove selected",e)},onLabelCreate:function(e,s){return $(this)},onNoResults:function(s){return e=!1,!0}})},onHide:function(){}}).modal("show")},50),$("#addSkillModal").modal("refresh")},v.addSkills=function(){var e=!1,r=$("#addSkill").dropdown("get value"),n=r.split(",");v.userSkills.length&&v.userSkills.forEach(function(e){n=n.filter(function(s){return s!==e.skillName})});var o={request:{endorsedUserId:v.userId,skillName:n}};1===n.length&&0===n[0].length&&(e=!0),e||a.addSkills(o).then(function(e){e&&"OK"===e.responseCode?(t.success(s.messages.smsg.m0038),v.getProfile()):t.error(s.messages.fmsg.m0062)})},v.setLimit=function(e){v.limit=e<=0?v.userSkills.length:e},v.disableAddressOption=function(e){return console.log,v.address.filter(function(s){return s.addType===e}).length>0},v.getFieldsToValidate=function(e){var s=$(e+" .ng-dirty"),r={},a=[];if(s.length>0)for(var t=0;t<s.length;t++)r[s[t].name]=s[t].value,a=Object.keys(r);return a},v.checkAddress=function(e){v.address.length>1&&v.address[0].addType===v.address[1].addType?v.isSameAddressTypeExist=!0:v.isSameAddressTypeExist=!1}}]);
"use strict";angular.module("playerApp").controller("playerCtrl",["$stateParams","$log","$scope","$rootScope","$sessionStorage","$timeout","$location","$anchorScroll",function(n,t,e,o,a,c,l,r){var s=this;s.contentPlayer={isContentPlayerEnabled:!1},s.ngInit=function(){n.content?(s.contentPlayer.isContentPlayerEnabled=!0,s.contentPlayer.contentData=n.content,s.hashId="content/"+n.content.identifier):""!==l.hash()?(s.contentPlayer.isContentPlayerEnabled=!0,s.hashId=l.hash(),s.contentPlayer.contentId=s.hashId.replace("content/","")):n.contentId&&(s.contentPlayer.isContentPlayerEnabled=!0,s.contentPlayer.contentId=n.contentId,s.hashId="content/"+n.contentId),s.scrollToPlayer()},s.scrollToPlayer=function(){l.hash(s.hashId),c(function(){r()},500)}}]);
"use strict";angular.module("playerApp").controller("NoteCardCtrl",["$rootScope","$scope","noteService","$timeout","$state","$stateParams","$q","toasterService",function(e,o,t,a,d,n,s,r){function i(o){var a="searchApi";l[a]={},l[a].loader=r.loader("",e.messages.stmsg.m0057),t.search(o).then(function(o){o&&"OK"===o.responseCode?(l[a].loader.showLoader=!1,l.notesList=o.result.response.note||[]):(l[a].loader.showLoader=!1,r.error(e.messages.fmsg.m0033))}).catch(function(){l[a].loader.showLoader=!1,r.error(e.messages.fmsg.m0033)})}var l=this;l.userId=e.userId,l.userName=e.firstName+" "+e.lastName,l.showNoteCard=o.shownotecard,l.showModalInLectureView=o.shownoteinlecture,l.showModalInCourseView=o.shownoteincourse,l.quantityOfNotes=2,l.courseId=n.courseId,l.contentId=n.contentId,l.contentName=n.contentName,l.add={},l.update={},l.showCreateNote=!1,l.showUpdateNote=!1,l.visibility=o.visibility,l.sortBy="desc",o.updateContentId=function(e){l.contentId=e},o.updateNoteMetaData=function(e){l.contentId=e,i({request:{filters:{userId:l.userId,courseId:l.courseId,contentId:l.contentId},sort_by:{updatedDate:l.sortBy}}})},l.hideAddNoteModal=function(){a(function(){$("#addNoteModal").modal("hide"),$("#addNoteModal").modal("hide dimmer"),$("#addNoteModal").modal("hide others")},0)},l.insertImage=function(){var e=s.defer();return l.openAddImageModal(function(o){o?e.resolve(o):e.reject()}),e.promise},l.openAddImageModal=function(e){l.showAddImageModal=!0,$(".wmd-prompt-background").css("z-index",0),$(".wmd-prompt-background").css("position","initial"),a(function(){$("#showAddImageModal").modal({allowMultiple:!0,onShow:function(){l.imageLink="http://"},onHide:function(){return l.showAddImageModal=!1,e(l.imageLink)}}).modal("show")},10)},l.closeAddImageModal=function(e){l.isCancel=!1,l.showUpdateModal=!1,e&&(l.imageLink="",l.isCancel=!0),l.showCreateNote?l.showAddNoteModal():l.showUpdateNote&&(l.showUpdateModal=!0,l.showUpdateNoteModal(l.update.metaData)),$("#showAddImageModal").modal("hide"),$("#showAddImageModal").modal("hide others"),$("#showAddImageModal").modal("hide all"),$("#showAddImageModal").modal("hide dimmer"),$(".ui.coupled.modal.transition.hidden").remove()},l.createNote=function(o){var a={request:{note:o.note,userId:l.userId,title:o.title,courseId:l.courseId,contentId:l.contentId,createdBy:l.userName,updatedBy:l.userId}},d="createApi";l[d]={},l[d].loader=r.loader("",e.messages.stmsg.m0054),t.create(a).then(function(o){if(o&&"OK"===o.responseCode){l[d].loader.showLoader=!1;var t=angular.copy(a.request);t.createdDate=(new Date).toISOString(),t.updatedDate=(new Date).toISOString(),t.id=o.result.id,l.hideAddNoteModal(),e.$emit("updateNotesListData",t)}else l[d].loader.showLoader=!1,r.error(e.messages.fmsg.m0030)}).catch(function(){l[d].loader.showLoader=!1,r.error(e.messages.fmsg.m0030)})},l.hideUpdateNoteModal=function(){$("#updateNoteModal").modal("hide"),$("#updateNoteModal").modal("hide others"),$("#updateNoteModal").modal("hide dimmer")},l.updateNote=function(o){var a={noteId:o.id,request:{note:o.note,title:o.title,tags:o.tags,updatedBy:l.userId}},d="updateApi";l[d]={},l[d].loader=r.loader("",e.messages.stmsg.m0059),t.update(a).then(function(t){if(t&&"OK"===t.responseCode){l[d].loader.showLoader=!1;var a=angular.copy(o);a.updatedDate=(new Date).toISOString(),l.hideUpdateNoteModal(),e.$emit("updateNotesListData",a,!0)}else l[d].loader.showLoader=!1,r.error(e.messages.fmsg.m0034)}).catch(function(){l[d].loader.showLoader=!1,r.error(e.messages.fmsg.m0034)})},l.clearUpdateNoteData=function(){l.update.metaData.title="",l.update.metaData.note=""},l.closeUpdateNoteModal=function(){a(function(){l.showUpdateNote=!1},0)},l.showUpdateNoteModal=function(e){l.showUpdateNote=!0,a(function(){$("#updateNoteModal").modal({allowMultiple:!0,onShow:function(){l.update.metaData=angular.copy(e),l.isCancel&&(l.imageLink="",l.isCancel=!1)},onHide:function(){return l.imageLink||l.isCancel||l.showUpdateModal||(l.clearUpdateNoteData(),l.closeUpdateNoteModal()),!0}}).modal("show")},10)},l.clearAddNoteData=function(){l.add.title="",l.add.note=""},l.closeAddNoteModal=function(){a(function(){l.showCreateNote=!1},0)},l.showAddNoteModal=function(){l.showCreateNote=!0,a(function(){$("#addNoteModal").modal({allowMultiple:!0,onShow:function(){l.imageLink||l.isCancel?(l.imageLink="",l.isCancel=!1):($(".ui.coupled.modal.transition.hidden").remove(),l.clearAddNoteData())},onHide:function(){return l.imageLink||l.isCancel||(l.clearAddNoteData(),l.closeAddNoteModal()),!0}}).modal("show")},10)},e.$on("updateNotesListData",function(e,o,t){t&&l.notesList?(l.notesList=l.notesList.filter(function(e){return e.id!==o.id}),l.notesList.push(o)):(l.notesList=l.notesList?l.notesList:[],l.notesList.push(o))}),l.viewAllNotes=function(){var e={};l.courseId&&l.contentId?(e={courseId:l.courseId,contentId:l.contentId},d.go("CourseContentNote",e)):l.courseId?(e={courseId:l.courseId},d.go("CourseNote",e)):l.contentId&&(e={contentId:l.contentId,contentName:l.contentName},d.go("ContentNote",e))}}]);
"use strict";angular.module("playerApp").controller("contentPlayerCtrl",["$state","$scope","contentService","$timeout","$stateParams","config","$rootScope","$location","$anchorScroll","toasterService","$window","workSpaceUtilsService",function(e,t,n,o,a,r,i,s,c,d,l,u){function p(e){t.contentData=e,t.contentData.language=n.validateContent(t.contentData.language),t.contentData.gradeLevel=n.validateContent(t.contentData.gradeLevel),t.contentData.subject=n.validateContent(t.contentData.subject),t._instance={id:t.contentData.identifier,ver:t.contentData.pkgVersion},t.showMetaData=t.isshowmetaview,i.contentId=t.contentData.identifier,t.showIFrameContent=!0;var a=r.ekstep_CP_config.baseURL;o(function(){var n=$("#contentViewerIframe")[0];n.src=a,n.onload=function(){t.adjustPlayerHeight();var o=t.getContentEditorConfig(e);n.contentWindow.initializePreview(o),t.gotoBottom()}},0),document.getElementById("contentPlayer").addEventListener("renderer:telemetry:event",function(e,t){org.sunbird.portal.eventManager.dispatchEvent("sunbird:player:telemetry",e.detail.telemetryData)})}function g(e,n,o,a){var r={};r.showError=!0,r.showMetaLoader=e,r.messageClass="red",r.message=n,r.showCloseButton=o,r.showTryAgainButton=a,t.errorObject=r}function m(e){var o={contentId:e},a={fields:"body,editorState,templateId,languageCode,template,gradeLevel,status,concepts,versionKey,name,appIcon,contentType,owner,domain,code,visibility,createdBy,description,language,mediaType,osId,languageCode,createdOn,lastUpdatedOn,audience,ageGroup,attributions,artifactUrl,mimeType,medium,year,publisher,creator"};t.contenteditmode&&(a.mode="edit"),n.getById(o,a).then(function(e){if(e&&"OK"===e.responseCode)"Live"===e.result.content.status||"Unlisted"===e.result.content.status||t.isworkspace?(t.errorObject={},p(e.result.content)):f||(f+=1,d.warning(i.messages.imsg.m0027),l.history.back());else{g(!1,i.messages.stmsg.m0009,!0,!0)}}).catch(function(){g(!1,i.messages.stmsg.m0009,!0,!0)})}t.isClose=t.isclose,t.isHeader=t.isheader,t.showModalInLectureView=!0,t.contentProgress=0,t.telemetryEnv="Toc"===e.current.name?"course":"library";var f=0;t.getContentEditorConfig=function(e){var n={};if(n.context=r.ekstep_CP_config.context,n.context.contentId=t.contentData.identifier,n.context.sid=i.sessionId,n.context.uid=i.userId,n.context.channel=org.sunbird.portal.channel,_.isUndefined(a.courseId))n.context.dims=org.sunbird.portal.dims;else{var o=_.cloneDeep(org.sunbird.portal.dims)||[];o.push(a.courseId),i.batchHashTagId&&o.push(i.batchHashTagId),n.context.dims=o}return n.context.tags=_.concat([],org.sunbird.portal.channel),n.context.app=[org.sunbird.portal.appid],n.context.partner=[],i.isTocPage&&(n.context.cdata=[{id:a.courseId,type:"course"}]),n.context.pdata={id:org.sunbird.portal.appid,ver:"1.0",pid:"sunbird-portal"},n.config=r.ekstep_CP_config.config,n.config.plugins=r.ekstep_CP_config.config.plugins,n.config.repos=r.ekstep_CP_config.config.repos,n.metadata=t.contentData,n.data=t.contentData.mimeType!==r.MIME_TYPE.ecml?{}:e.body,n.config.overlay=r.ekstep_CP_config.config.overlay||{},n.config.overlay.showUser=!1,n},t.adjustPlayerHeight=function(){var e=$("#contentViewerIframe").width();if(e){var t=e*(9/16);$("#contentViewerIframe").css("height",t+"px")}},t.close=function(){if("Profile"===t.closeurl)return void e.go(t.closeurl);t.closeurl&&(""!==i.search.searchKeyword?o(function(){i.$emit("initSearch",{})},0):e.go(t.closeurl)),t.errorObject={},t.id&&(t.id=""),t.body&&(t.body={}),t.visibility=!1,document.getElementById("contentPlayer")&&document.getElementById("contentPlayer").removeEventListener("renderer:telemetry:event",function(){org.sunbird.portal.eventManager.dispatchEvent("sunbird:player:telemetry",event.detail.telemetryData)},!1)},t.updateContent=function(e){e.body?m(e.body.identifier):e.id&&m(e.id)},t.tryAgain=function(){t.errorObject={},m(t.id)},t.copyContent=function(){t.showCopyLoader=!0;var e=angular.copy(t.contentData);e.code=e.code+".copy",e.name="Copy of "+e.name;var o={content:{name:e.name,description:e.description,code:e.code,createdBy:i.userId}},a="";a="application/vnd.ekstep.ecml-archive"===t.contentData.mimeType?"WorkSpace.DraftContent":"WorkSpace.AllUploadedContent",n.copy(o,e.identifier).then(function(o){if(o&&"OK"===o.responseCode){_.forEach(o.result.node_id,function(t){e.identifier=t});var r={contentId:e.identifier},s={fields:"body,editorState,templateId,languageCode,template,gradeLevel,status,concepts,versionKey,name,appIcon,contentType,owner,domain,code,visibility,createdBy,description,language,mediaType,osId,languageCode,createdOn,lastUpdatedOn,audience,ageGroup,attributions,artifactUrl,mimeType,medium,year,publisher,creator,framework"};n.getById(r,s).then(function(e){e&&"OK"===e.responseCode?(d.success(i.messages.emsg.m0012),t.showCopyLoader=!1,u.openContentEditor(e.result.content,a)):(d.error(i.messages.emsg.m0013),t.showCopyLoader=!1)}).catch(function(){d.error(i.messages.emsg.m0013),t.showCopyLoader=!1})}else d.error(i.messages.emsg.m0013),t.showCopyLoader=!1}).catch(function(){d.error(i.messages.emsg.m0013),t.showCopyLoader=!1})},t.getConceptsNames=function(e){return n.getConceptsNames(e)},$("#courseDropdownValues").dropdown("restore defaults"),t.gotoBottom=function(){$("html, body").animate({scrollTop:$("#player-auto-scroll").offset().top},500)}}]);
"use strict";angular.module("playerApp").controller("ContentLessonController",["contentService","$timeout","$state","config","$rootScope","toasterService","$scope","configService",function(e,o,r,a,t,n,d,s){var c=this;c.formDropdown=s.getWorkspaceStdMtrlDrpdown(),c.languages=c.formDropdown.languages,c.grades=c.formDropdown.grades,c.mediums=c.formDropdown.medium,c.subjects=c.formDropdown.subjects,c.boards=c.formDropdown.boards,c.resourceType=c.formDropdown.resourceType,c.showCreateSlideShowModal=!1,c.slideShowCreated=!1,c.userId=t.userId,c.accept=!1,c.hideCreateSlideShowModal=function(){$("#createSlideShowModal").modal("hide"),$("#createSlideShowModal").modal("hide others"),$("#createSlideShowModal").modal("hide dimmer")},c.initilizeView=function(){c.showCreateSlideShowModal=!0,o(function(){$(".multiSelectDropDown").dropdown(),$(".singleSelectDropDown").dropdown(),$("#createSlideShowModal").modal({allowMultiple:!0,observeChanges:!0,onHide:function(){c.clearCreateSlideShowData(),c.slideShowCreated||r.go("WorkSpace.ContentCreation")}}).modal("show")},10)},c.createContent=function(o){e.create(o).then(function(e){e&&"OK"===e.responseCode?(c.slideShowCreated=!0,c.showCreateSlideShowModal=!1,c.loader.showLoader=!1,c.hideCreateSlideShowModal(),c.initEKStepCE(e.result.content_id)):(c.loader.showLoader=!1,n.error(t.messages.fmsg.m0007))}).catch(function(){c.loader.showLoader=!1,n.error(t.messages.fmsg.m0007)})},c.saveMetaData=function(e,o){c.framework=o,c.loader=n.loader("",t.messages.stmsg.m0013);var r=angular.copy(e);r.mimeType=a.CreateLessonMimeType,r.createdBy=c.userId,r.name=r.name?r.name:"Untitled lesson",r.contentType="Resource",r.framework=c.framework,r.concepts=c.concepts,r.resourceType=r.resourceType||"Learn",r.language&&(r.language=[r.language]);var d={content:r};c.createContent(d)},c.clearCreateSlideShowData=function(){c.data={}},c.initEKStepCE=function(e){var o={contentId:e,framework:c.framework};r.go("ContentEditor",o)},d.$on("selectedConcepts",function(e,o){c.concepts=o.selectedConcepts});var i=t.$on("CreateLesson",function(e,o){c.saveMetaData(o.Data,o.framework)});d.$on("$destroy",function(){i()})}]);
"use strict";angular.module("playerApp").controller("DraftContentController",["contentService","searchService","config","$rootScope","$state","toasterService","$scope","workSpaceUtilsService","$timeout","PaginationService","telemetryService",function(e,t,o,r,n,s,a,i,c,m,l){function d(e,t,o,r){var n={};return n.showError=!0,n.isClose=e,n.message=t,n.messageType=o,r&&(n.messageText=r),n}var g=this;g.userId=r.userId,g.status=["Draft","FlagDraft"],g.mimeType=["application/vnd.ekstep.ecml-archive","application/vnd.ekstep.content-collection"],g.sortBy="desc",a.isSelected=!1,g.selectedContentItem=[],g.pageLimit=9,g.pager={},g.error={},g.getDraftContent=function(e){e=e||1,g.loader=s.loader("",r.messages.stmsg.m0011);var n={filters:{status:g.status,createdBy:g.userId,mimeType:g.mimeType,contentType:o.contributeContentType},sort_by:{lastUpdatedOn:g.sortBy},offset:(e-1)*g.pageLimit,limit:g.pageLimit};t.search(n).then(function(t){t&&"OK"===t.responseCode?(g.loader.showLoader=!1,g.error.showError=!1,g.totalCount=t.result.count,g.pageNumber=e,g.version=t.ver,g.draftContentData=t.result.content||[],g.pager=m.GetPager(t.result.count,e,g.pageLimit),0===g.draftContentData.length&&(g.error=d(!0,r.messages.stmsg.m0012,r.messages.stmsg.m0008))):(g.loader.showLoader=!1,g.error.showError=!1,s.error(r.messages.fmsg.m0006))}).catch(function(){g.loader.showLoader=!1,g.error.showError=!1,s.error(r.messages.fmsg.m0006)})},g.openContentEditor=function(e){i.openContentEditor(e,n.current.name)},g.openRemoveContentModel=function(e){g.removeContentId=e,g.showRemoveContentModel=!0,c(function(){$("#removeContentModel").modal({}).modal("show")},10)},g.hideRemoveContentModel=function(){i.hideRemoveModel("#removeContentModel"),g.removeContentId="",g.showRemoveContentModel=!1},g.deleteContent=function(t){var o=[t];g.hideRemoveContentModel(),g.loader=s.loader("",r.messages.stmsg.m0034);var n={contentIds:o};e.retire(n).then(function(e){e&&"OK"===e.responseCode?(g.loader.showLoader=!1,g.selectedContentItem=[],s.success(r.messages.smsg.m0006),g.draftContentData=i.removeContentLocal(g.draftContentData,o),g.pager=m.GetPager(g.totalCount-o.length,g.pageNumber,g.pageLimit),0===g.draftContentData.length&&g.getDraftContent(g.pager.currentPage)):(g.loader.showLoader=!1,s.error(r.messages.fmsg.m0022))}).catch(function(){g.loader.showLoader=!1,s.error(r.messages.fmsg.m0022)})},g.setPage=function(e){e<1||e>g.pager.totalPages||g.getDraftContent(e)},g.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})};var p=[];g.lineInView=function(e,t,o,r){var n=_.filter(p,function(e){return e.objid===o.identifier});!0===t&&0===n.length&&p.push({objid:o.identifier,objtype:o.contentType||"course",section:r,index:e}),console.log("------",p),l.setVisitData(p)}}]);
"use strict";angular.module("playerApp").controller("ReviewContentController",["contentService","searchService","config","$rootScope","$scope","$state","toasterService","PaginationService","workSpaceUtilsService","telemetryService",function(e,t,r,o,n,s,a,i,c,l){function g(e,t,r,o){var n={};return n.showError=!0,n.isClose=e,n.message=t,n.messageType=r,o&&(n.messageText=o),n}var u=this;u.userId=o.userId,n.contentPlayer={isContentPlayerEnabled:!1},u.status=["Review","FlagReview"],u.sortBy="desc",u.pageLimit=9,u.pager={},u.getReviewContent=function(e){e=e||1,u.loader=a.loader("",o.messages.stmsg.m0018),u.error={};var n={filters:{status:u.status,createdBy:u.userId,objectType:"Content",contentType:r.contributeContentType},sort_by:{lastUpdatedOn:u.sortBy},offset:(e-1)*u.pageLimit,limit:u.pageLimit};t.search(n).then(function(t){t&&"OK"===t.responseCode?(u.loader.showLoader=!1,u.error.showError=!1,u.reviewContentData=t.result.content||[],u.totalCount=t.result.count,u.version=t.ver,u.pager=i.GetPager(t.result.count,e,u.pageLimit),0===u.reviewContentData.length&&(u.error=g(!0,o.messages.stmsg.m0019,o.messages.stmsg.m0008))):(u.loader.showLoader=!1,u.error.showError=!1,a.error(o.messages.fmsg.m0012))}).catch(function(){u.loader.showLoader=!1,u.error.showError=!1,a.error(o.messages.fmsg.m0012)})},u.openContentPlayer=function(e){c.openContentPlayer(e,s.current.name)},u.setPage=function(e){e<1||e>u.pager.totalPages||u.getReviewContent(e)},u.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})},u.generateInteractEvent=function(e,t,r,o){l.interactTelemetryData(o,r,e,u.version,e,t)};var p=[];u.lineInView=function(e,t,r,o){var n=_.filter(p,function(e){return e.objid===r.identifier});!0===t&&0===n.length&&p.push({objid:r.identifier,objtype:r.contentType||"workspace",section:o,index:e}),console.log("------",p),l.setVisitData(p)}}]);
"use strict";angular.module("playerApp").controller("PublishedContentController",["contentService","searchService","config","$rootScope","$state","toasterService","$scope","workSpaceUtilsService","$timeout","PaginationService","telemetryService",function(e,t,o,n,r,s,a,i,l,d,c){function m(e,t,o,n){var r={};return r.showError=!0,r.isClose=e,r.message=t,r.messageType=o,n&&(r.messageText=n),r}var u=this;u.userId=n.userId,u.status=["Live"],u.sortBy="desc",a.isSelected=!1,u.selectedContentItem=[],u.pageLimit=9,u.pager={},u.getPublishedContent=function(e){e=e||1,u.loader=s.loader("",n.messages.stmsg.m0021),u.error={};var r={filters:{status:u.status,createdBy:u.userId,objectType:"Content",contentType:o.contributeContentType},sort_by:{lastUpdatedOn:u.sortBy},offset:(e-1)*u.pageLimit,limit:u.pageLimit};t.search(r).then(function(t){t&&"OK"===t.responseCode?(u.error.showError=!1,u.loader.showLoader=!1,u.pager=d.GetPager(t.result.count,e,u.pageLimit),u.publishedContentData=t.result.content||[],u.totalCount=t.result.count,u.pageNumber=e,u.version=t.ver,0===u.publishedContentData.length&&(u.error=m(!0,n.messages.stmsg.m0022,n.messages.stmsg.m0008))):(u.error.showError=!1,u.loader.showLoader=!1,s.error(n.messages.fmsg.m0013))}).catch(function(){u.error.showError=!1,u.loader.showLoader=!1,s.error(n.messages.fmsg.m0013)})},u.openContentPlayer=function(e){i.openContentEditor(e,r.current.name)},u.initializeUIElement=function(){$("#actionDropDown").dropdown()},u.openRemoveContentModel=function(e){u.removeContentId=e,u.showRemoveContentModel=!0,l(function(){$("#removeContentModel").modal({}).modal("show")},10)},u.hideRemoveContentModel=function(){i.hideRemoveModel("#removeContentModel"),u.removeContentId="",u.showRemoveContentModel=!1},u.deleteContent=function(t){var o=[t];u.hideRemoveContentModel(),u.loader=s.loader("",n.messages.stmsg.m0034);var r={contentIds:o};e.retire(r).then(function(e){e&&"OK"===e.responseCode?(u.loader.showLoader=!1,u.selectedContentItem=[],s.success(n.messages.smsg.m0006),u.publishedContentData=i.removeContentLocal(u.publishedContentData,o),u.pager=d.GetPager(u.totalCount-o.length,u.pageNumber,u.pageLimit),0===u.publishedContentData.length&&u.getPublishedContent(u.pager.currentPage)):(u.loader.showLoader=!1,s.error(n.messages.fmsg.m0022))}).catch(function(){u.loader.showLoader=!1,s.error(n.messages.fmsg.m0022)})},u.setPage=function(e){e<1||e>u.pager.totalPages||u.getPublishedContent(e)},u.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})},u.generateInteractEvent=function(e,t,o,n){c.interactTelemetryData(n,o,e,u.version,e,t)};var g=[];u.lineInView=function(e,t,o,n){var r=_.filter(g,function(e){return e.objid===o.identifier});!0===t&&0===r.length&&g.push({objid:o.identifier,objtype:o.contentType||"workspace",section:n,index:e}),console.log("------",g),c.setVisitData(g)}}]);
"use strict";angular.module("playerApp").controller("AllUploadedContentController",["contentService","searchService","config","$rootScope","$state","toasterService","$scope","workSpaceUtilsService","$timeout","PaginationService","telemetryService",function(e,t,o,n,r,a,s,l,i,d,c){function m(e,t,o,n){var r={};return r.showError=!0,r.isClose=e,r.message=t,r.messageType=o,n&&(r.messageText=n),r}var p=this;p.userId=n.userId,p.contentStatus=["Draft","FlagDraft"];var g=o.MIME_TYPE;p.contentMimeType=[g.pdf,g.youtube,g.html,g.ePub,g.h5p,g.mp4,g.webm],p.sortBy="desc",s.isSelected=!1,p.selectedContentItem=[],p.pageLimit=9,p.pager={},p.getAllUploadedContent=function(e){e=e||1,p.loader=a.loader("",n.messages.stmsg.m0023),p.error={};var r={filters:{status:p.contentStatus,createdBy:p.userId,mimeType:p.contentMimeType,contentType:o.contributeContentType},sort_by:{lastUpdatedOn:p.sortBy},offset:(e-1)*p.pageLimit,limit:p.pageLimit};t.search(r).then(function(t){t&&"OK"===t.responseCode?(p.loader.showLoader=!1,p.error.showError=!1,p.totalCount=t.result.count,p.pageNumber=e,p.version=t.ver,p.allUploadedContentData=t.result.content||[],p.pager=d.GetPager(t.result.count,e,p.pageLimit),0===p.allUploadedContentData.length&&(p.error=m(!0,n.messages.stmsg.m0024,n.messages.stmsg.m0008))):(p.error.showError=!1,p.loader.showLoader=!1,a.error(n.messages.fmsg.m0014))}).catch(function(){p.error.showError=!1,p.loader.showLoader=!1,a.error(n.messages.fmsg.m0014)})},p.openContentEditor=function(e){l.openContentEditor(e,r.current.name)},p.initializeUIElement=function(){$("#actionDropDown").dropdown()},p.openRemoveContentModel=function(e){p.removeContentId=e,p.showRemoveContentModel=!0,i(function(){$("#removeContentModel").modal({}).modal("show")},10)},p.hideRemoveContentModel=function(){l.hideRemoveModel("#removeContentModel"),p.removeContentId="",p.showRemoveContentModel=!1},p.deleteContent=function(t){var o=[t];p.hideRemoveContentModel(),p.loader=a.loader("",n.messages.stmsg.m0034);var r={contentIds:o};e.retire(r).then(function(e){e&&"OK"===e.responseCode?(p.loader.showLoader=!1,p.selectedContentItem=[],p.version=e.ver,a.success(n.messages.smsg.m0006),p.allUploadedContentData=l.removeContentLocal(p.allUploadedContentData,o),p.pager=d.GetPager(p.totalCount-o.length,p.pageNumber,p.pageLimit),0===p.allUploadedContentData.length&&p.getAllUploadedContent(p.pager.currentPage)):(p.loader.showLoader=!1,a.error(n.messages.fmsg.m0022))}).catch(function(){p.loader.showLoader=!1,a.error(n.messages.fmsg.m0022)})},p.setPage=function(e){e<1||e>p.pager.totalPages||p.getAllUploadedContent(e)},p.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})},p.generateInteractEvent=function(e,t,o,n){c.interactTelemetryData(n,o,e,p.version,e,t)};var u=[];p.lineInView=function(e,t,o,n){var r=_.filter(u,function(e){return e.objid===o.identifier});!0===t&&0===r.length&&u.push({objid:o.identifier,objtype:o.contentType||"workspace",section:n,index:e}),console.log("------",u),c.setVisitData(u)}}]);
"use strict";angular.module("playerApp").controller("ContentEditorController",["config","$stateParams","toasterService","$state","contentService","$timeout","$rootScope","workSpaceUtilsService","$window","searchService",function(e,t,n,o,r,a,i,d,s,c){var l=this;l.contentId=t.contentId,l.framework=t.framework;var p=JSON.parse(s.localStorage.getItem("previousURl"));l.openContentEditor=function(){window.context={user:{id:i.userId,name:i.firstName+" "+i.lastName},sid:i.sessionId,contentId:l.contentId,framework:l.framework,pdata:{id:org.sunbird.portal.appid,ver:"1.0",pid:"sunbird-portal"},tags:_.concat([],org.sunbird.portal.channel),channel:org.sunbird.portal.channel},window.config={baseURL:"",modalId:"contentEditor",apislug:"/action",alertOnUnload:!0,headerLogo:_.isUndefined(i.orgLogo)?"":i.orgLogo,aws_s3_urls:["https://s3.ap-south-1.amazonaws.com/ekstep-public-"+org.sunbird.portal.ekstep_env+"/","https://ekstep-public-"+org.sunbird.portal.ekstep_env+".s3-ap-south-1.amazonaws.com/"],plugins:[{id:"org.ekstep.sunbirdcommonheader",ver:"1.4",type:"plugin"},{id:"org.ekstep.metadata",ver:"1.0",type:"plugin"},{id:"org.ekstep.sunbirdmetadata",ver:"1.0",type:"plugin"},{id:"org.ekstep.questionset",ver:"1.0",type:"plugin"}],dispatcher:"local",localDispatcherEndpoint:"/content-editor/telemetry",showHelp:!1,previewConfig:{repos:["/content-plugins/renderer"],plugins:[{id:"org.sunbird.player.endpage",ver:1,type:"plugin"}],showEndPage:!1}},c.updateReqForChannelFilter()&&(window.config.searchCriteria=c.updateReqForChannelFilter()),$("#contentEditor").iziModal({title:"",iframe:!0,iframeURL:"/thirdparty/bower_components/content-editor-iframe/index.html",navigateArrows:!1,fullscreen:!1,openFullscreen:!0,closeOnEscape:!1,overlayClose:!1,overlay:!1,overlayColor:"",history:!1,onClosed:function(){l.openModel()}}),a(function(){$("#contentEditor").iziModal("open")},100)};var u={state:["WorkSpace.UpForReviewContent","WorkSpace.ReviewContent","WorkSpace.PublishedContent","LimitedPublishedContent"],status:["Review","Draft","Live","Unlisted","FlagDraft","FlagReview"],mimeType:e.CreateLessonMimeType};l.checkContentAccess=function(e,t){var n=e.status,o=e.createdBy,r=e.state,a=e.userId,i=t.status;if(e.mimeType===t.mimeType){var d=_.indexOf(i,n)>-1,s=_.indexOf(t.state,r)>-1;return!(!d||!s||o===a)||(!(!d||!s||o!==a)||!(!d||o!==a))}return!1},l.getContentData=function(){var e={contentId:l.contentId},a={fields:"createdBy,status,mimeType",mode:"edit"};r.getById(e,a).then(function(e){if(e&&"OK"===e.responseCode){var r=e.result.content;r.state=t.state,r.userId=i.userId,l.checkContentAccess(r,u)?l.openContentEditor():(n.warning(i.messages.imsg.m0004),o.go(p.name,p.params))}else n.warning(i.messages.imsg.m0004),o.go(p.name,p.params)})},l.init=function(){org.sunbird.portal.eventManager.addEventListener("sunbird:portal:editor:close",function(){t.state?o.go(t.state):o.go("WorkSpace.DraftContent")}),org.sunbird.portal.eventManager.addEventListener("sunbird:portal:content:review",function(e,n){t.state?o.go(t.state):o.go("WorkSpace.DraftContent")}),window.addEventListener("editor:metadata:edit",function(e,t){org.sunbird.portal.eventManager.dispatchEvent("sunbird:portal:editor:editmeta")}),window.addEventListener("editor:window:close",function(e,t){org.sunbird.portal.eventManager.dispatchEvent("sunbird:portal:editor:close")}),window.addEventListener("editor:content:review",function(e,t){org.sunbird.portal.eventManager.dispatchEvent("sunbird:portal:content:review",e.detail.contentId)})},l.init(),l.getContentData(),i.$on("$stateChangeStart",function(e,t,n,o){if("ContentEditor"===o.name){"opened"===$("#contentEditor").iziModal("getState")&&document.getElementById("contentEditor").remove()}}),l.openModel=function(){l.showModal=!0,$("#modalContentEditor").modal("show"),a(function(){d.hideRemoveModel("#modalContentEditor"),document.getElementById("contentEditor")&&document.getElementById("contentEditor").remove(),document.getElementById("modalContentEditor")&&document.getElementById("modalContentEditor").remove(),l.showModal=!1,t.state?o.go(t.state):o.go("WorkSpace.DraftContent")},2e3)}}]);
"use strict";angular.module("playerApp").controller("CollectionEditorController",["config","$stateParams","toasterService","$sce","$state","$timeout","$rootScope","contentService","permissionsService","workSpaceUtilsService","$window","searchService",function(e,o,t,i,n,l,a,r,d,s,c,p){var f=this;f.contentId=o.contentId,f.framework=o.framework,f.openCollectionEditor=function(e){$("#collectionEditor").iziModal({title:"",iframe:!0,iframeURL:"/thirdparty/bower_components/collection-editor-iframe/index.html",navigateArrows:!1,fullscreen:!1,openFullscreen:!0,closeOnEscape:!1,overlayClose:!1,overlay:!1,history:!1,overlayColor:"",onClosed:function(){f.openModel()}}),window.context={user:{id:a.userId,name:a.firstName+" "+a.lastName},sid:a.sessionId,contentId:f.contentId,pdata:{id:org.sunbird.portal.appid,ver:"1.0",pid:"sunbird-portal"},tags:_.concat([],org.sunbird.portal.channel),channel:org.sunbird.portal.channel,framework:f.framework,env:e.type.toLowerCase()},window.config={corePluginsPackaged:!0,modalId:"collectionEditor",dispatcher:"local",apislug:"/action",alertOnUnload:!0,headerLogo:_.isUndefined(a.orgLogo)?"":a.orgLogo,loadingImage:"",plugins:[{id:"org.ekstep.sunbirdcommonheader",ver:"1.4",type:"plugin"},{id:"org.ekstep.lessonbrowser",ver:"1.3",type:"plugin"},{id:"org.ekstep.metadata",ver:"1.0",type:"plugin"},{id:"org.ekstep.sunbirdmetadata",ver:"1.0",type:"plugin"}],localDispatcherEndpoint:"/collection-editor/telemetry",editorConfig:{mode:"Edit",contentStatus:"draft",rules:{levels:7,objectTypes:f.getTreeNodes(e.type)},defaultTemplate:{}},previewConfig:{repos:["/content-plugins/renderer"],plugins:[{id:"org.sunbird.player.endpage",ver:1,type:"plugin"}],showEndPage:!1},editorType:e.type},p.updateReqForChannelFilter()&&(window.config.searchCriteria=p.updateReqForChannelFilter()),"textbook"===e.type.toLowerCase()?(window.config.plugins.push({id:"org.ekstep.suggestcontent",ver:"1.0",type:"plugin"}),window.config.nodeDisplayCriteria={contentType:["TextBookUnit"]}):"course"===e.type.toLowerCase()?window.config.nodeDisplayCriteria={contentType:["CourseUnit"]}:"lessonplan"===e.type.toLowerCase()?window.config.nodeDisplayCriteria={contentType:["LessonPlanUnit"]}:window.config.nodeDisplayCriteria={contentType:["Collection"]},window.config.editorConfig.publishMode=!1,window.config.editorConfig.isFlagReviewer=!1,"WorkSpace.UpForReviewContent"===o.state&&_.intersection(d.getCurrentUserRoles(),["CONTENT_REVIEWER","CONTENT_REVIEW","BOOK_REVIEWER","FLAG_REVIEWER"]).length>0?window.config.editorConfig.publishMode=!0:"WorkSpace.FlaggedContent"===o.state&&_.intersection(d.getCurrentUserRoles(),["FLAG_REVIEWER"]).length>0&&(window.config.editorConfig.isFlagReviewer=!0);var i={state:["WorkSpace.UpForReviewContent","WorkSpace.ReviewContent","WorkSpace.PublishedContent","WorkSpace.FlaggedContent","LimitedPublishedContent"],status:["Review","Draft","Live","Flagged","Unlisted","FlagDraft","FlagReview"],mimeType:"application/vnd.ekstep.content-collection"},s={contentId:f.contentId},c={fields:"createdBy,status,mimeType",mode:"edit"};"WorkSpace.FlaggedContent"===o.state&&delete c.mode,r.getById(s,c).then(function(e){if(e&&"OK"===e.responseCode){var r=e.result.content;r.state=o.state,r.userId=a.userId,f.validateRequest(r,i)?(f.updateModeAndStatus(e.result.content.status),l(function(){$("#collectionEditor").iziModal("open")},100)):(t.warning(a.messages.imsg.m0004),n.go("Home"))}})},f.validateRequest=function(e,o){var t=e.status,i=e.createdBy,n=e.state,l=e.userId,a=o.status;if(e.mimeType===o.mimeType){var r=_.indexOf(a,t)>-1,d=_.indexOf(o.state,n)>-1;return!(!r||!d||i===l)||(!(!r||!d||i!==l)||!(!r||i!==l))}return!1},f.getTreeNodes=function(e){var o=[];switch(e){case"Course":return o.push({type:"Course",label:"Course",isRoot:!0,editable:!0,childrenTypes:["CourseUnit","Collection","Resource"],addType:"Editor",iconClass:"fa fa-book"},{type:"CourseUnit",label:"Course Unit",isRoot:!1,editable:!0,childrenTypes:["CourseUnit","Collection","Resource"],addType:"Editor",iconClass:"fa fa-folder-o"},{type:"Collection",label:"Collection",isRoot:!1,editable:!1,childrenTypes:[],addType:"Browser",iconClass:"fa fa-file-o"},{type:"Resource",label:"Resource",isRoot:!1,editable:!1,childrenTypes:[],addType:"Browser",iconClass:"fa fa-file-o"}),o;case"Collection":return o.push({type:"Collection",label:"Collection",isRoot:!0,editable:!0,childrenTypes:["Collection","Resource"],addType:"Editor",iconClass:"fa fa-folder-o"},{type:"Collection",label:"Collection",isRoot:!1,editable:!1,childrenTypes:[],addType:"Browser",iconClass:"fa fa-file-o"},{type:"Resource",label:"Resource",isRoot:!1,editable:!1,childrenTypes:[],addType:"Browser",iconClass:"fa fa-file-o"}),o;case"LessonPlan":return o.push({type:"LessonPlan",label:"LessonPlan",isRoot:!0,editable:!0,childrenTypes:["LessonPlanUnit","Collection","Resource"],addType:"Editor",iconClass:"fa fa-book"},{type:"LessonPlanUnit",label:"LessonPlan Unit",isRoot:!1,editable:!0,childrenTypes:["LessonPlanUnit","Collection","Resource"],addType:"Editor",iconClass:"fa fa-folder-o"},{type:"Collection",label:"Collection",isRoot:!1,editable:!1,childrenTypes:[],addType:"Browser",iconClass:"fa fa-file-o"},{type:"Resource",label:"Resource",isRoot:!1,editable:!1,childrenTypes:[],addType:"Browser",iconClass:"fa fa-file-o"}),o;default:return o.push({type:"TextBook",label:"Textbook",isRoot:!0,editable:!0,childrenTypes:["TextBookUnit","Collection","Resource"],addType:"Editor",iconClass:"fa fa-book"},{type:"TextBookUnit",label:"Textbook Unit",isRoot:!1,editable:!0,childrenTypes:["TextBookUnit","Collection","Resource"],addType:"Editor",iconClass:"fa fa-folder-o"},{type:"Collection",label:"Collection",isRoot:!1,editable:!1,childrenTypes:[],addType:"Browser",iconClass:"fa fa-file-o"},{type:"Resource",label:"Resource",isRoot:!1,editable:!1,childrenTypes:[],addType:"Browser",iconClass:"fa fa-file-o"}),o}},f.updateModeAndStatus=function(e){"draft"===e.toLowerCase()&&(window.config.editorConfig.mode="Edit",window.config.editorConfig.contentStatus="draft"),"review"===e.toLowerCase()&&(window.config.editorConfig.mode="Read",window.config.editorConfig.contentStatus="draft"),"live"===e.toLowerCase()&&(window.config.editorConfig.mode="Edit",window.config.editorConfig.contentStatus="live"),"flagged"===e.toLowerCase()&&(window.config.editorConfig.mode="Read",window.config.editorConfig.contentStatus="flagged")},f.openCollectionEditor(o),a.$on("$stateChangeStart",function(e,o,t,i){if("CollectionEditor"===i.name){"opened"===$("#collectionEditor").iziModal("getState")&&document.getElementById("collectionEditor")&&document.getElementById("collectionEditor").remove()}}),f.openModel=function(){f.showModal=!0,$("#modalCollectionEditor").modal("show"),l(function(){s.hideRemoveModel("#modalCollectionEditor"),document.getElementById("collectionEditor")&&document.getElementById("collectionEditor").remove(),document.getElementById("modalCollectionEditor")&&document.getElementById("modalCollectionEditor").remove(),f.showModal=!1,o.state?n.go(o.state):n.go("WorkSpace.DraftContent")},2e3)}}]);
"use strict";angular.module("playerApp").controller("GenericEditorController",["config","$stateParams","toasterService","$sce","$state","$timeout","$rootScope","contentService","permissionsService","workSpaceUtilsService","searchService",function(e,o,n,t,r,i,a,d,c,l,s){var g=this;g.contentId=_.isUndefined(o.contentId)||_.isNull(o.contentId)?"":o.contentId,g.framework=o.framework,g.setContext=function(){window.context={user:{id:a.userId,name:a.firstName+" "+a.lastName,orgIds:a.organisationIds},sid:a.sessionId,contentId:g.contentId,pdata:{id:org.sunbird.portal.appid,ver:"1.0",pid:"sunbird-portal"},tags:_.concat([],org.sunbird.portal.channel),channel:org.sunbird.portal.channel,env:"genericeditor",framework:g.framework},g.openGenericEditor()},g.openGenericEditor=function(){$("#genericEditor").iziModal({title:"",iframe:!0,iframeURL:"/thirdparty/bower_components/generic-editor-iframe/index.html",navigateArrows:!1,fullscreen:!1,openFullscreen:!0,closeOnEscape:!1,overlayClose:!1,overlay:!1,history:!1,overlayColor:"",onClosed:function(){g.openModel()}}),window.config={corePluginsPackaged:!0,modalId:"genericEditor",dispatcher:"local",apislug:"/action",alertOnUnload:!0,headerLogo:_.isUndefined(a.orgLogo)?"":a.orgLogo,loadingImage:"",plugins:[{id:"org.ekstep.sunbirdcommonheader",ver:"1.4",type:"plugin"},{id:"org.ekstep.metadata",ver:"1.0",type:"plugin"},{id:"org.ekstep.sunbirdmetadata",ver:"1.0",type:"plugin"}],previewConfig:{repos:["/content-plugins/renderer"],plugins:[{id:"org.sunbird.player.endpage",ver:1,type:"plugin"}],showEndPage:!1}},s.updateReqForChannelFilter()&&(window.config.searchCriteria=s.updateReqForChannelFilter()),i(function(){$("#genericEditor").iziModal("open")},100)},a.$on("$stateChangeStart",function(e,o,n,t){if("GenericEditor"===t.name){"opened"===$("#genericEditor").iziModal("getState")&&document.getElementById("genericEditor").remove()}}),g.openModel=function(){g.showModal=!0,$("#modalGenericEditor").modal("show"),i(function(){l.hideRemoveModel("#modalGenericEditor"),document.getElementById("genericEditor")&&document.getElementById("genericEditor").remove(),document.getElementById("modalGenericEditor")&&document.getElementById("modalGenericEditor").remove(),g.showModal=!1,o.state?r.go(o.state):a.contentModelBackLinkName?r.go(a.contentModelBackLinkName):r.go("WorkSpace.AllUploadedContent")},2e3)},g.getFramework=function(){s.getChannel().then(function(e){"OK"===e.responseCode?(window.context.framework=e.result.channel.defaultFramework,g.framework=e.result.channel.defaultFramework):window.context.framework=null,g.setContext()}).catch(function(e){g.setContext(),console.log("error is ......",e)})},o.framework?g.setContext():g.getFramework()}]);
"use strict";angular.module("playerApp").controller("TextBookController",["contentService","$timeout","$state","config","$rootScope","toasterService","searchService","configService","telemetryService","$scope",function(e,o,t,a,r,n,c,s,i,d){var l=this;l.categoryListofFramework={},l.categoryModelList={},l.formDropdown=s.getWorkspaceFormDropdown(),l.years=l.formDropdown.years,l.showCreateTextBookModal=!1,l.isTextBookCreated=!1,l.userId=r.userId,l.mimeType="application/vnd.ekstep.content-collection",l.defaultName="Untitled textbook",l.contentType="TextBook",l.resourceType="Book",l.hideCreateTextBookModal=function(){$("#createTextBookModal").modal("hide"),$("#createTextBookModal").modal("hide others"),$("#createTextBookModal").modal("hide dimmer")},l.initializeModal=function(){l.showCreateTextBookModal=!0,i.impressionTelemetryData("workspace","","textbook","1.0","scroll","workspace-create-textbook","/create/textbook"),o(function(){$("#createTextBookModal").modal({observeChanges:!0,onHide:function(){l.data={},l.isTextBookCreated||t.go("WorkSpace.ContentCreation")}}).modal("show")})},l.createContent=function(o){l.loader=n.loader("",r.messages.stmsg.m0014),e.create(o).then(function(e){e&&"OK"===e.responseCode?(l.isTextBookCreated=!0,l.showCreateTextBookModal=!1,l.loader.showLoader=!1,l.hideCreateTextBookModal(),i.interactTelemetryData("workspace",e.result.content_id,"create-textbook",l.version,"create-textbook","workspace-create-textbook"),l.initEKStepCE(e.result.content_id)):(l.loader.showLoader=!1,n.error(r.messages.fmsg.m0008))}).catch(function(){l.loader.showLoader=!1,n.error(r.messages.fmsg.m0008)})},l.saveMetaData=function(e,o){l.framework=o;var t=angular.copy(e);t.name=t.name?t.name:l.defaultName,t.mimeType=l.mimeType,t.createdBy=l.userId,t.contentType=l.contentType,t.framework=l.framework,t.resourceType=l.resourceType,t.gradeLevel&&""===t.gradeLevel[0]&&delete t.gradeLevel,t.language&&(t.language=[t.language]);var a={content:t};l.createContent(a)},l.initEKStepCE=function(e){var o={contentId:e,type:"TextBook",state:"",framework:l.framework};t.go("CollectionEditor",o)};var m=r.$on("CreateTextbook",function(e,o){l.saveMetaData(o.Data,o.framework)});d.$on("$destroy",function(){m()})}]);
"use strict";angular.module("playerApp").controller("CollectionController",["contentService","$timeout","$state","config","$rootScope","toasterService","$scope",function(e,o,t,n,a,l,r){var c=this;c.showCreateCollectionModel=!1,c.isCollectionCreated=!1,c.userId=a.userId,c.mimeType="application/vnd.ekstep.content-collection",c.defaultName="Untitled collection",c.contentType="Collection",c.resourceType="Collection",c.initializeModal=function(){c.showCreateCollectionModel=!0,o(function(){$("#createCollectionModel").modal({observeChanges:!0,onHide:function(){c.data={},c.isCollectionCreated||t.go("WorkSpace.ContentCreation")}}).modal("show")},10)},c.hideCreateCollectionModel=function(){$("#createCollectionModel").modal("hide"),$("#createCollectionModel").modal("hide others"),$("#createCollectionModel").modal("hide dimmer")},c.createCollection=function(o){c.loader=l.loader("",a.messages.stmsg.m0016),e.create(o).then(function(e){e&&"OK"===e.responseCode?(c.isCollectionCreated=!0,c.showCreateCollectionModel=!1,c.loader.showLoader=!1,c.hideCreateCollectionModel(),c.initEKStepCE(e.result.content_id)):(c.loader.showLoader=!1,l.error(a.messages.fmsg.m0010))}).catch(function(){c.loader.showLoader=!1,l.error(a.messages.fmsg.m0010)})},c.saveMetaData=function(e,o){c.framework=o;var t=angular.copy(e);t.name=t.name?t.name:c.defaultName,t.mimeType=c.mimeType,t.createdBy=c.userId,t.contentType=c.contentType,t.resourceType=c.resourceType,t.framework=c.framework;var n={content:t};c.createCollection(n)},c.initEKStepCE=function(e){var o={contentId:e,type:"Collection",framework:c.framework};t.go("CollectionEditor",o)};var i=a.$on("CreateCollection",function(e,o){c.saveMetaData(o.Data,o.framework)});r.$on("$destroy",function(){i()})}]);
"use strict";angular.module("playerApp").controller("PreviewContentController",["$stateParams","$rootScope","$state","contentService","$timeout","config","toasterService","$window",function(e,t,o,s,n,a,r,c){function i(e,t){var o=e.status,s=e.createdBy,n=e.state,a=e.userId,r=t.status;if(_.indexOf(t.mimeType,e.mimeType)>-1){var c=_.indexOf(r,o)>-1,i=_.indexOf(t.state,n)>-1;return!(!c||!i||s===a)||!(!c||!i||s!==a)||!(!c||s!==a)}return!1}function l(n){var a=n;if(a.state=e.backState,a.userId=t.userId,!i(a,m)){r.warning(t.messages.imsg.m0004);var l=JSON.parse(c.localStorage.getItem("previousURl"));o.go(l.name,l.params)}d.contentData=n,d.contentData.language=s.validateContent(d.contentData.language),d.contentData.gradeLevel=s.validateContent(d.contentData.gradeLevel),d.contentData.subject=s.validateContent(d.contentData.subject),d.contentData.flagReasons=s.validateContent(d.contentData.flagReasons),d.contentData.flaggedBy=s.validateContent(d.contentData.flaggedBy),d.contentData.flags=s.validateContent(d.contentData.flags),d.contentData.keywords=s.validateContent(d.contentData.keywords),d.contentPlayer.contentData=n,d.contentPlayer.isContentPlayerEnabled=!0}var d=this;d.contentProgress=0,d.contentId=e.contentId,d.userId=t.userId,d.isShowPublishRejectButton="WorkSpace.UpForReviewContent"===e.backState,d.isShowDeleteButton="WorkSpace.PublishedContent"===e.backState,d.isShowFlagActionButton="WorkSpace.FlaggedContent"===e.backState,d.checkListConfig=a.CHECK_LIST_CONFIG,d.contenteditmode=_.indexOf(["WorkSpace.UpForReviewContent","WorkSpace.ReviewContent"],e.backState)>-1;var m={state:["WorkSpace.UpForReviewContent","WorkSpace.ReviewContent","WorkSpace.PublishedContent","WorkSpace.FlaggedContent"],status:["Review","Live","Flagged","FlagDraft","FlagReview"],mimeType:a.MimeTypeExceptCollection};d.contentPlayer={isContentPlayerEnabled:!1},d.redirectUrl=e.backState,d.checkedContents=[],d.enableCheckListSubmitBtn=!1,d.reviewComments="",d.getContent=function(o){d.loader=r.loader("",t.messages.stmsg.m0025);var n={contentId:o},a={fields:"name,description,appIcon,contentType,mimeType,artifactUrl,versionKey,audience,language,gradeLevel,ageGroup,subject,medium,author,domain,createdBy,flagReasons,flaggedBy,flags,status,createdOn,lastUpdatedOn,body,board,keywords,resourceType,creator"};"WorkSpace.UpForReviewContent"!==e.backState&&"WorkSpace.ReviewContent"!==e.backState||(a.mode="edit"),s.getById(n,a).then(function(e){e&&"OK"===e.responseCode?(d.errorObject={},d.loader.showLoader=!1,l(e.result.content)):(d.loader.showLoader=!1,r.error(t.messages.fmsg.m0015))}).catch(function(){d.loader.showLoader=!1,r.error(t.messages.fmsg.m0015)})},d.getContent(d.contentId),d.publishContent=function(e){var o={content:{publishChecklist:d.checkedContents,lastPublishedBy:d.userId}};d.loader=r.loader("",t.messages.stmsg.m0029),s.publish(o,d.contentId).then(function(o){o&&"OK"===o.responseCode?(d.loader.showLoader=!1,d.isShowPublishRejectButton=!1,d.contentData.status="Live",r.success(t.messages.smsg.m0004),d.closeChecklistModal(e)):(d.loader.showLoader=!1,r.error(t.messages.fmsg.m0019),d.closeChecklistModal(e))}).catch(function(){d.loader.showLoader=!1,r.error(t.messages.fmsg.m0019),d.closeChecklistModal(e)})},d.showChecklistModal=function(e){$("#"+e).modal({closable:!1}).modal("show")},d.closeChecklistModal=function(e){$("#"+e).modal("hide"),d.enableCheckListSubmitBtn=!1,d.checkedContents=[],$(".listItem, .listPublishItem").attr("checked",!1),d.reviewComments=""},d.createCheckListArr=function(e){e&&-1===d.checkedContents.indexOf(e)?d.checkedContents.push(e):e&&-1!==d.checkedContents.indexOf(e)&&d.checkedContents.splice(d.checkedContents.indexOf(e),1)},d.validateRequestChecklistModal=function(e){d.createCheckListArr(e),$(".listItem:checked").length>0&&d.reviewComments.length>0?d.enableCheckListSubmitBtn=!0:d.enableCheckListSubmitBtn=!1},d.validatePublishtChecklistModal=function(e){d.createCheckListArr(e),$(".listPublishItem:checked").length===$(".listPublishItem").length?d.enableCheckListSubmitBtn=!0:d.enableCheckListSubmitBtn=!1},d.rejectContent=function(e){d.loader=r.loader("",t.messages.stmsg.m0030);var o={content:{rejectReasons:d.checkedContents,rejectComment:d.reviewComments}};s.reject(o,d.contentId).then(function(o){o&&"OK"===o.responseCode?(d.loader.showLoader=!1,d.isShowPublishRejectButton=!1,r.success(t.messages.smsg.m0005),d.closeChecklistModal(e)):(d.loader.showLoader=!1,r.error(t.messages.fmsg.m0020),d.closeChecklistModal(e))}).catch(function(){d.loader.showLoader=!1,r.error(t.messages.fmsg.m0020),d.closeChecklistModal(e)})},d.deleteContent=function(){d.loader=r.loader("",t.messages.stmsg.m0034);var a={contentIds:[d.contentId]};s.retire(a).then(function(s){s&&"OK"===s.responseCode?n(function(){d.loader.showLoader=!1,d.isShowDeleteButton=!1,d.isShowFlagActionButton=!1,r.success(t.messages.smsg.m0006),o.go(e.backState)},2e3):(d.loader.showLoader=!1,r.error(t.messages.fmsg.m0022))}).catch(function(){d.loader.showLoader=!1,r.error(t.messages.fmsg.m0022)})},d.acceptContentFlag=function(e){var o={versionKey:e.versionKey};d.loader=r.loader("",t.messages.stmsg.m0040),s.acceptContentFlag(o,e.identifier).then(function(e){e&&"OK"===e.responseCode?(d.loader.showLoader=!1,d.isShowFlagActionButton=!1,d.contentData.status="FlagDraft",r.success(t.messages.smsg.m0007)):(d.loader.showLoader=!1,r.error(t.messages.fmsg.m0024))}).catch(function(){d.loader.showLoader=!1,r.error(t.messages.fmsg.m0024)})},d.discardContentFlag=function(e){var o={};d.loader=r.loader("",t.messages.stmsg.m0041),s.discardContentFlag(o,e.identifier).then(function(e){e&&"OK"===e.responseCode?(d.loader.showLoader=!1,d.isShowFlagActionButton=!1,d.contentData.status="Live",r.success(t.messages.smsg.m0008)):(d.loader.showLoader=!1,r.error(t.messages.fmsg.m0025))}).catch(function(){d.loader.showLoader=!1,r.error(t.messages.fmsg.m0025)})},d.getConceptsNames=function(e){return s.getConceptsNames(e)},d.getResourceTypes=function(e){return!!e&&(_.isString(e)?e:!!_.isArray(e)&&e.join(", "))},$("#courseDropdownValues").dropdown("restore defaults")}]);
"use strict";angular.module("playerApp").controller("UpForReviewContentController",["contentService","searchService","config","$rootScope","$scope","$state","$timeout","toasterService","PaginationService","workSpaceUtilsService","configService","permissionsService","telemetryService",function(e,r,t,s,a,o,n,c,i,p,l,d,h){var u=this;u.filterDropDown=l.getWorkspaceUpforReviewdrpdwn(),u.userId=s.userId,u.contentStatus=["Review"],u.channelId="sunbird",u.sortBy="desc",a.contentPlayer={isContentPlayerEnabled:!1},u.pageLimit=9,u.pager={},u.typingTimer=-1,u.doneTypingInterval=1e3,u.search={},u.search.mediums=u.filterDropDown.languages,u.search.contentTypes=u.filterDropDown.contentTypes,u.search.subjects=u.filterDropDown.subjects,u.search.grades=u.filterDropDown.grades,u.search.boards=u.filterDropDown.boards,u.search.medium=u.filterDropDown.medium,u.search.sortingOptions=t.upForReviewSortingOptions,u.search.sortIcon=!0,u.search.selectedMedium=[],u.search.selectedContentType=[],u.search.selectedBoard=[],u.search.selectedSubject=[],u.search.selectedGrades=[],u.search.appliedMedium=[],u.search.appliedContentType=[],u.search.appliedBoard=[],u.search.appliedSubject=[],u.search.appliedGrades=[],$("#sortByDropDown").dropdown(),u.showErrorMessage=function(e,r,t,s){var a={};return a.showError=!0,a.isClose=e,a.message=r,a.messageType=t,s&&(a.messageText=s),a},u.keyUp=function(){clearTimeout(u.typingTimer),u.typingTimer=setTimeout(u.getUpForReviewContent,u.doneTypingInterval)},u.keyDown=function(){clearTimeout(u.typingTimer)},u.search.selectFilter=function(e,r,t){n(function(){var s=u.search[e].indexOf(r);-1===s?(u.search[e].push(r),$(t.target).addClass("active")):(u.search[e].splice(s,1),$(t.target).removeClass("active"))},0)},u.search.removeFilterSelection=function(e,r,t){u.hideFilter();var s=u.search[e].indexOf(r),a=u.search[t].indexOf(r);-1!==s&&-1!==a&&(u.search[e].splice(s,1),u.search[t].splice(a,1),u.getUpForReviewContent(1),u.showSelectedChips())},u.search.applySorting=function(){var e=u.search.sortByOption;u.search.sortBy={},u.search.sortBy[e]=!0===u.search.sortIcon?"asc":"desc",u.getUpForReviewContent(1)},u.search.resetFilter=function(){u.search.selectedMedium=[],u.search.selectedContentType=[],u.search.selectedBoard=[],u.search.selectedSubject=[],u.search.selectedGrades=[],u.search.appliedMedium=[],u.search.appliedContentType=[],u.search.appliedBoard=[],u.search.appliedSubject=[],u.search.appliedGrades=[],u.getUpForReviewContent(1)},u.getRequestObject=function(e){var r=d.getRoleOrgMap(),s={filters:{status:u.contentStatus,createdFor:d.getRoleOrgMap()&&_.compact(_.union(r.CONTENT_REVIEWER,r.BOOK_REVIEWER,r.FLAG_REVIEWER)),objectType:"Content",contentType:t.contributeContentType,createdBy:{"!=":u.userId}},sort_by:{lastUpdatedOn:u.sortBy},offset:(e-1)*u.pageLimit,limit:u.pageLimit};return u.searchText&&(s.query=u.searchText),u.appliedFilter?(u.isShowAppliedFilter=!0,(u.search.selectedMedium&&u.search.selectedMedium.length>0||u.search.appliedMedium&&u.search.appliedMedium.length>0)&&(u.search.appliedMedium=angular.copy(u.search.selectedMedium),s.filters.medium=u.search.appliedMedium),(u.search.selectedContentType&&u.search.selectedContentType.length>0||u.search.appliedContentType&&u.search.appliedContentType.length>0)&&(u.search.appliedContentType=angular.copy(u.search.selectedContentType),s.filters.contentType=u.search.appliedContentType),(u.search.selectedBoard&&u.search.selectedBoard.length>0||u.search.appliedBoard&&u.search.appliedBoard.length>0)&&(u.search.appliedBoard=angular.copy(u.search.selectedBoard),s.filters.board=u.search.appliedBoard),(u.search.selectedSubject&&u.search.selectedSubject.length>0||u.search.appliedSubject&&u.search.appliedSubject.length>0)&&(u.search.appliedSubject=angular.copy(u.search.selectedSubject),s.filters.subject=u.search.appliedSubject),(u.search.selectedGrades&&u.search.selectedGrades.length>0||u.search.appliedGrades&&u.search.appliedGrades.length>0)&&(u.search.appliedGrades=angular.copy(u.search.selectedGrades),s.filters.gradeLevel=u.search.appliedGrades)):u.isShowAppliedFilter=!0,u.search.sortBy&&(s.sort_by=u.search.sortBy),-1===_.indexOf(d.getCurrentUserRoles(),"BOOK_REVIEWER")&&(s.filters.contentType=_.without(s.filters.contentType,"TextBook")),-1===_.indexOf(d.getCurrentUserRoles(),"CONTENT_REVIEWER")&&-1!==_.indexOf(d.getCurrentUserRoles(),"BOOK_REVIEWER")&&(s.filters.contentType=["TextBook"]),-1!==_.indexOf(d.getCurrentUserRoles(),"FLAG_REVIEWER")&&(s.filters.status=["FlagReview"],s.filters.contentType.push("TextBook")),-1===_.indexOf(d.getCurrentUserRoles(),"FLAG_REVIEWER")||-1===_.indexOf(d.getCurrentUserRoles(),"BOOK_REVIEWER")&&-1===_.indexOf(d.getCurrentUserRoles(),"CONTENT_REVIEWER")||(s.filters.status=["FlagReview","Review"]),s},u.showSelectedChips=function(){return!(!(u.search.appliedMedium.length>0||u.search.appliedContentType.length>0||u.search.appliedBoard.length>0||u.search.appliedSubject.length>0||u.search.appliedGrades.length>0)||!u.appliedFilter)&&(console.log(u.search),!0)},u.getUpForReviewContent=function(e){e=e||1,u.loader=c.loader("",s.messages.stmsg.m0032),u.error={};var t=u.getRequestObject(e);u.hideFilter(),r.search(t).then(function(r){r&&"OK"===r.responseCode?(u.loader.showLoader=!1,u.error.showError=!1,u.upForReviewContentData=[],u.version=r.ver,r.result.content&&(u.upForReviewContentData=r.result.content),u.totalCount=r.result.count,u.pager=i.GetPager(r.result.count,e,u.pageLimit),0===u.upForReviewContentData.length&&(u.error=u.showErrorMessage(!0,s.messages.stmsg.m0033,s.messages.stmsg.m0008))):(u.loader.showLoader=!1,u.error.showError=!1,c.error(s.messages.fmsg.m0021))}).catch(function(){u.loader.showLoader=!1,u.error.showError=!1,c.error(s.messages.fmsg.m0021)})},u.openContentPlayer=function(e){p.openContentPlayer(e,o.current.name)},u.setPage=function(e){e<1||e>u.pager.totalPages||u.getUpForReviewContent(e)},u.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})},u.generateInteractEvent=function(e,r){h.interactTelemetryData("workspace",r,e,u.version,e,"workspace-content-upforreview")},u.search.getSelectedContentTypeValue=function(e,r){var t=_.filter(e,function(e){return e.key===r});return t?t[0].value:""},u.showFilterPopup=function(){u.search.selectedMedium=angular.copy(u.search.appliedMedium),u.search.selectedContentType=angular.copy(u.search.appliedContentType),u.search.selectedBoard=angular.copy(u.search.appliedBoard),u.search.selectedSubject=angular.copy(u.search.appliedSubject),u.search.selectedGrades=angular.copy(u.search.appliedGrades),u.hideFilterPopup=!0,$("#showFilterButton").popup({popup:$("#showFilterPopup"),on:"click",position:"bottom right",color:"#4183c4"})},u.hideFilter=function(){u.hideFilterPopup=!1};var g=[];u.lineInView=function(e,r,t,s){var a=_.filter(g,function(e){return e.objid===t.identifier});!0===r&&0===a.length&&g.push({objid:t.identifier,objtype:t.contentType||"workspace",section:s,index:e}),console.log("------",g),h.setVisitData(g)}}]);
"use strict";!function(){angular.module("playerApp").controller("CollectionPlayerCtrl",["$state","$timeout","courseService","$rootScope","$stateParams","toasterService","telemetryService","$window","contentService","workSpaceUtilsService",function(e,o,t,a,n,r,c,i,s,l){var d=this;d.treeKey=0,d.loader={showLoader:!1,loaderMessage:"",enrollLoader:!1},d.error={showError:!1,message:"",messageType:"error",isClose:!1,showEnrollError:!1},d.collectionMeta={creator:"-",language:"-",gradeLevel:"-",subject:"-",medium:"-",lastUpdatedOn:"-",createdOn:"-"},d.showPlayer=!1,d.name=e.params.name,d.closeUrl=n.backState||"Resources",d.loadData=function(){d.loader.showLoader=!0,d.loader.loaderMessage=a.messages.stmsg.m0076,t.courseHierarchy(e.params.Id).then(function(o){if(o&&"OK"===o.responseCode)if(d.loader.showLoader=!1,d.version=o.ver,"Live"===o.result.content.status||"Unlisted"===o.result.content.status)o.result.content.children=_.sortBy(o.result.content.children,["index"]),d.courseHierachy=o.result.content,d.name=d.courseHierachy.name,d.collectionMeta.creator=d.courseHierachy.creator,d.collectionMeta.language=d.courseHierachy.language,d.collectionMeta.gradeLevel=d.courseHierachy.gradeLevel,d.collectionMeta.subject=d.courseHierachy.subject,d.collectionMeta.medium=d.courseHierachy.medium,d.collectionMeta.lastUpdatedOn=d.courseHierachy.lastUpdatedOn,d.collectionMeta.createdOn=d.courseHierachy.createdOn,d.applyAccordion();else{r.warning(a.messages.imsg.m0018);var t=JSON.parse(i.localStorage.getItem("previousURl"));e.go(t.name,t.params)}else d.showError(a.messages.emsg.m0004)},function(){d.showError(a.messages.emsg.m0004)})},d.constructTree=function(e,o){d.fancyTree=[],angular.forEach(o,function(e,o){d.getTreeData(e,d.fancyTree)}),d.initializeFancyTree("#FT_"+e,d.fancyTree)},d.getTreeData=function(e,o){return"application/vnd.ekstep.content-collection"!==e.mimeType?(o.push({title:"<span id='node"+d.treeKey+"' class='padded'><i class='"+d.getContentIcon(e.mimeType)+"'></i>"+e.name+"</span>",key:d.treeKey,data:e,icon:!1}),d.treeKey+=1):(o.push({title:"<span class='courseAccordianDesc'><i class='"+d.getContentIcon(e.mimeType)+"'></i>"+e.name+"</span>",key:-1,children:[],icon:!1}),angular.forEach(e.children,function(t,a){d.getTreeData(e.children[a],o[o.length-1].children)})),d.fancyTree},d.initializeFancyTree=function(e,t){o(function(){$(e).fancytree({checkbox:!1,source:t,click:function(e,o){var t=o.node;-1!==t.key&&d.expandMe(t.key,t.data),"title"===o.targetType&&(o.targetType="expander",d.expandMe(t.key,t.data))}}),$(".fancytree-container").addClass("fancytree-connectors")},0)},d.expandMe=function(e,o){if(o&&o.mimeType&&"application/vnd.ekstep.content-collection"!==o.mimeType)d.playContent(o);else{var t=$(e.target).closest(".title").find("i");d.updateIcon(t,!$(t).hasClass("plus"))}},d.getContentIcon=function(e){return{"application/pdf":"large file pdf outline icon","image/jpeg":"large file image outline icon","image/jpg":"large file image outline icon","image/png":"large file image outline icon","video/mp4":"large file video outline icon","video/webm":"large file video outline icon","video/ogg":"large file video outline icon","video/youtube":"large youtube square icon","video/x-youtube":"large youtube square icon","application/vnd.ekstep.html-archive":"large html5 icon","application/vnd.ekstep.ecml-archive":"large file archive outline icon","application/vnd.ekstep.content-collection":"large folder open outline icon grey icon"}[e]},d.updateIcon=function(e,o){o?$(e).addClass("plus").removeClass("minus"):$(e).addClass("minus").removeClass("plus")},d.applyAccordion=function(){o(function(){$(".ui.accordion").accordion({exclusive:!1})},100)},d.playContent=function(e){d.contentId=e.identifier,d.showPlayer=!0},d.closePlayer=function(t){if("Profile"===n.backState)return void e.go(n.backState);""!==a.search.searchKeyword?o(function(){a.$emit("initSearch",{})},0):e.go("Resources")},d.copyContent=function(){d.showCopyLoader=!0;var e=angular.copy(d.courseHierachy);e.code=e.code+".copy",e.name="Copy of "+e.name;var o={content:{name:e.name,description:e.description,code:e.code,createdBy:a.userId}};s.copy(o,e.identifier).then(function(o){if(o&&"OK"===o.responseCode){_.forEach(o.result.node_id,function(o){e.identifier=o});var t={contentId:e.identifier},n={fields:"body,editorState,templateId,languageCode,template,gradeLevel,status,concepts,versionKey,name,appIcon,contentType,owner,domain,code,visibility,createdBy,description,language,mediaType,osId,languageCode,createdOn,lastUpdatedOn,audience,ageGroup,attributions,artifactUrl,mimeType,medium,year,publisher,creator,framework"};s.getById(t,n).then(function(e){e&&"OK"===e.responseCode?(r.success(a.messages.emsg.m0012),d.showCopyLoader=!1,l.openContentEditor(e.result.content,"WorkSpace.DraftContent")):(r.error(a.messages.emsg.m0013),d.showCopyLoader=!1)}).catch(function(){r.error(a.messages.emsg.m0013),d.showCopyLoader=!1})}else r.error(a.messages.emsg.m0013),d.showCopyLoader=!1}).catch(function(){r.error(a.messages.emsg.m0013),d.showCopyLoader=!1})},d.isShowBadgeAssign=function(e){switch(e.contentType){case"TextBook":return!0;default:return!1}},d.loadData()}])}();
"use strict";angular.module("playerApp").controller("pageSectionCtrl",["pageSectionService","$scope","$state","config","sessionService","$rootScope","toasterService","telemetryService",function(e,r,s,t,o,a,n,i){function c(e,r,s,t){var o={};return o.showError=!0,o.isClose=e,o.message=r,o.messageType=s,t&&(o.messageText=t),o}var g=this;g.pageTypeUrls={resource:"Resource",course:"Course"},g.playContent=function(e){a.contentType=e.contentType,a.search.searchKeyword="";var t={content:e,contentName:e.name,contentId:e.identifier};s.go("Player",t),i.interactTelemetryData(r.type,e.identifier,e.contentType,a.version,r.type,r.type+"-read")},g.openCourseView=function(e){a.search.searchKeyword="";var t=e.courseId||e.identifier,n=a.enrolledCourseIds[t]>=0?"ENROLLED_COURSE":"OTHER_COURSE",c="no";c=a.enrolledCourseIds[t]?"no":"yes";var g={courseType:n,courseId:e.courseId||e.identifier,lectureView:c,progress:e.progress,total:e.total,courseRecordId:e.id,courseName:e.courseName||e.name};o.setSessionData("COURSE_PARAMS",g),s.go("Toc",g),i.interactTelemetryData(r.type,t,n,a.version,r.type,r.type+"-read")},g.sections=function(){g.error={},g.loader=n.loader("",a.messages.stmsg.m0053),void 0===a.search&&(a.search={}),a.search&&a.search.sortBy&&delete a.search.sortBy.null;var s={request:{source:"web",name:g.pageTypeUrls[r.type],filters:a.search.filters||{},sort_by:a.search.sortBy||{}}};e.getPageData(t.URL.PAGE_PREFIX,s).then(function(e){r.type;if(i.setConfigData("env","course"),i.setConfigData("message","Content read"),"resource"===r.type&&("library","/resources","library",i.setConfigData("env","library")),e&&"OK"===e.responseCode){var s=e.result.response.sections;a.version=e.ver,g.page=[];var t={};for(var o in s){var n=s[o];n.contents&&n.contents.length>0&&(t[n.group]=t[n.group]||{},t[n.group][n.index]=n)}Object.keys(t).forEach(function(e){for(var r=1;r<=Object.keys(t[e]).length;r+=1)1===r?g.page[e-1]=t[e][r]:Array.prototype.push.apply(g.page[e-1].contents,t[e][r].contents,g.page[e-1].id)}),g.loader.showLoader=!1,0===g.page.length&&(g.error=c(!0,a.messages.stmsg.m0006,a.messages.stmsg.m0008,a.messages.stmsg.m0007))}else g.loader.showLoader=!1,g.error=c(!0,a.messages.fmsg.m0004,a.messages.emsg.m0002)}).catch(function(){g.loader.showLoader=!1,g.error=c(!0,a.messages.fmsg.m0004,a.messages.emsg.m0002)})},g.sections();var u=a.$on("initPageSearch",function(e,r){g.sections()}),l=a.$on("initPageSearchFromDynamicPage",function(e,r){a.search.filters=r.FilterData,a.search.sortBy=r.sortByData,g.sections()});r.$on("$destroy",function(){u(),l()});var p=[];a.lineInView=function(e,r,s,t,o){var n=_.filter(p,function(e){return e.objid===s.identifier}),c=angular.element("#"+o+"_"+s.identifier).attr("aria-hidden");!0===r&&0===n.length&&"false"===c&&p.push({objid:s.identifier,objtype:s.contentType||"course",section:t,index:e}),void 0!==a.visitData&&"Course"===s.contentType&&(p=_.union(p,a.visitData)),i.setVisitData(p)}}]);
"use strict";angular.module("playerApp").controller("CourseController",["contentService","$timeout","$state","config","$rootScope","toasterService","$scope",function(e,o,r,t,a,n,s){var d=this;d.showCreateCourseModal=!1,d.isCourseCreated=!1,d.userId=a.userId,d.defaultName="Untitled Course",d.mimeType="application/vnd.ekstep.content-collection",d.contentType="Course",d.resourceType="Course",d.hideCreateCourseModal=function(){$("#createCourseModal").modal("hide"),$("#createCourseModal").modal("hide others"),$("#createCourseModal").modal("hide dimmer")},d.initializeModal=function(){d.showCreateCourseModal=!0,o(function(){$("#createCourseModal").modal({observeChanges:!0,onHide:function(){d.data={},d.isCourseCreated||r.go("WorkSpace.ContentCreation")}}).modal("show")},10)},d.createContent=function(o){d.loader=n.loader("",a.messages.stmsg.m0015),e.create(o).then(function(e){e&&"OK"===e.responseCode?(d.isCourseCreated=!0,d.showCreateCourseModal=!1,d.loader.showLoader=!1,d.hideCreateCourseModal(),d.initEKStepCE(e.result.content_id)):(d.loader.showLoader=!1,n.error(a.messages.fmsg.m0009))}).catch(function(){d.loader.showLoader=!1,n.error(a.messages.fmsg.m0009)})},d.saveMetaData=function(e,o){d.framework=o;var r=angular.copy(e);r.name=r.name?r.name:d.defaultName,r.mimeType=d.mimeType,r.createdBy=d.userId,r.contentType=d.contentType,r.resourceType=d.resourceType,r.framework=d.framework;var t={content:r};d.createContent(t)},d.initEKStepCE=function(e){var o={contentId:e,type:"Course",framework:d.framework};r.go("CollectionEditor",o)};var i=a.$on("CreateCourse",function(e,o){d.saveMetaData(o.Data,o.framework)});s.$on("$destroy",function(){i()})}]);
"use strict";angular.module("playerApp").controller("adminController",["adminService","$timeout","$state","config","$rootScope","$scope","contentService","toasterService","permissionsService","searchService",function(e,s,r,o,n,t,a,i,l,c){var u=this;u.searchResult=t.users,u.getOrgName=function(){var s=[];u.searchResult.forEach(function(e){if(e.organisations){var r=e.organisations.map(function(e){return e.organisationId});s=_.union(s,r)}});var r={request:{filters:{identifier:s}}};return e.orgSearch(r).then(function(e){return e.result.response.content.map(function(e){return{orgName:e.orgName,orgId:e.identifier}})})},u.addOrgNameToOrganizations=function(){u.currentUserRoles=l.getCurrentUserRoles(),u.currentUserRoleMap=l.getCurrentUserRoleMap(),"Users"===n.search.selectedSearchKey&&u.getOrgName().then(function(e){u.searchResult.forEach(function(s){if(s.roles){!0===s.roles.includes("SYSTEM_ADMINISTRATION")&&(s.isEditableProfile=u.currentUserRoles.includes("SYSTEM_ADMINISTRATION"))}s.badgeAssertions=s.badgeAssertions,s.organisations&&s.organisations.forEach(function(r){var o=u.currentUserRoleMap[r.organisationId];void 0===s.isEditableProfile&&(_.indexOf(o,"ORG_ADMIN")>-1||_.indexOf(o,"SYSTEM_ADMINISTRATION")>-1)&&(s.isEditableProfile=!0);var n=e.find(function(e){return e.orgId===r.organisationId});n&&(r.orgName=n.orgName)}),s.rootOrgId===n.rootOrgId&&!0===n.rootOrgAdmin&&(s.isEditableProfile=!0)})})},u.showModal=function(e,r){s(function(){$("#changeUserRoles_"+e).modal({onShow:function(){u.setDefaultSelected(r),u.identifier=e,u.userOrganisations=r,u.selectedOrgUserRoles=[],u.selectedOrgUserRolesNew=[],$(".roleChckbox").checkbox()},observeChanges:!0,closable:!1,onHide:function(){return u.userId="",u.userOrganisations=[],u.selectedOrgUserRoles=[],u.selectedOrgUserRolesNew=[],!0}}).modal("show")},100)},u.showdeleteModal=function(e,s,r){$("#deleteUserConfirmation").modal({onShow:function(){u.deletingIdentifier=e,u.deletingUserFullName=s+" "+r||""},onHide:function(){return u.deletingUserId="",u.deletingUserFullName="",!0}}).modal("show")},u.downloadUsers=function(e,s){if("Users"===e){s.forEach(function(e){e.organisationsName=[],e.organisations&&e.organisations.forEach(function(s){e.organisationsName.push(s.orgName)})});var r=JSON.stringify(s).replace(/null/g,'""'),o=JSON.parse(r);alasql("SELECT firstName AS [First Name],lastName AS [Last Name],  organisationsName AS Organizations ,location AS Location, grade AS Grades, language AS Language ,subject as Subjects  INTO CSV('Users.csv',{headers:true ,separator:\",\"}) FROM ?",[o])}else if("Organisations"===e){s.forEach(function(e){switch(e.status){case 0:e.status="INACTIVE";break;case 1:e.status="ACTIVE";break;case 2:e.status="BLOCKED";break;case 3:e.status="RETIRED"}});var n=JSON.stringify(s).replace(/null/g,'""'),t=JSON.parse(n);alasql("SELECT orgName AS orgName,orgType AS orgType,noOfMembers AS noOfMembers,channel AS channel, status AS Status INTO CSV('Organizations.csv',{headers:true,separator:\",\"}) FROM ?",[t])}},u.deleteUser=function(s){var r={params:{},request:{userId:s}};e.deleteUser(r).then(function(e){"SUCCESS"===e.result.response?(i.success(n.messages.smsg.m0029),u.searchResult=u.searchResult.filter(function(e){return e.identifier===s&&(e.status=0),e})):i.error(n.messages.fmsg.m0051)}).catch(function(e){i.error(n.messages.fmsg.m0051)})},u.isUserRole=function(e,s){return s.includes(e)},u.editRoles=function(e,s,r){!0===s.includes(e)?u.selectedOrgUserRoles=u.selectedOrgUserRoles.filter(function(s){return s!==e}):!0===r.target.checked?u.selectedOrgUserRolesNew.push(e):u.selectedOrgUserRolesNew.splice(u.selectedOrgUserRolesNew.indexOf(e))},u.updateRoles=function(s,r,o){u.selectedOrgUserRolesNew.forEach(function(e){o.push(e)});var t=[],a=_.clone(l.getMainRoles());_.forEach(a,function(e,s){t.push(e.role)});var c=_.clone(o),d=_.difference(c,t);_.remove(o,function(e){return-1!==_.indexOf(d,e)});var g={request:{userId:s,organisationId:r,roles:o}};e.updateRoles(g).then(function(e){"OK"===e.responseCode?(i.success(n.messages.smsg.m0028),$("#changeUserRoles_"+s).modal("hide",function(){$("#changeUserRoles_"+s).modal("hide")})):(u.selectedOrgUserRoles=_.difference(u.selectedOrgUserRoles,u.selectedOrgUserRolesNew),$("#changeUserRoles_"+s).modal("hide",function(){$("#changeUserRoles_"+s).modal("hide")}),i.error(n.messages.fmsg.m0051))}).catch(function(e){u.selectedOrgUserRoles=_.difference(u.selectedOrgUserRoles,u.selectedOrgUserRolesNew),i.error(n.messages.fmsg.m0051)})},u.getUserRoles=function(){u.userRolesList=[];var e=l.getMainRoles();u.userRoles=e.filter(function(e){return"ORG_ADMIN"!==e.role&&"SYSTEM_ADMINISTRATION"!==e.role&&"ADMIN"!==e.role})},u.openPublicProfile=function(e,s){c.setPublicUserProfile(s),r.go("PublicProfile",{userId:window.btoa(e),userName:s.firstName})},u.setDefaultSelected=function(e){e&&e.length>0&&s(function(){var s=$("#userOrgs_"+u.identifier);s.dropdown(),e[0].orgName?s.dropdown("set text",e[0].orgName):s.dropdown("set text",e[0].organisationId),s.dropdown({allowTab:!1}),u.selectedOrgUserRoles=e[0].roles,u.selectedOrgUserId=e[0].organisationId},1e3)},u.getUserRoles()}]);
"use strict";angular.module("playerApp").controller("contentFlagController",["contentService","$timeout","$state","config","$rootScope","toasterService","$scope","telemetryService",function(e,o,t,n,a,r,i,s){var l=this;l.showContentFlagModal=!1,l.userId=a.userId,l.userFullName=a.firstName+" "+a.lastName,l.contentId=i.contentid,l.contentName=i.contentname,l.contentVersionKey=i.versionkey,l.reasons=[{name:"Inappropriate content",value:"Inappropriate Content",description:"Hateful, harmful or explicit lesson that is inappropriate for young learners"},{name:"Copyright violation",value:"Copyright Violation",description:"Uses copyrighted work without permission"},{name:"Privacy violation",value:"Privacy Violation",description:"Collects sensitive data or personal information about users, such as name\n address, photo or other personally identifiable information"},{name:"Other",value:"Other"}],l.reasonDescription={},l.flagMessage="course"===i.type?a.frmelmnts.instn.t0018:a.frmelmnts.instn.t0019,l.hideContentFlagModal=function(){$("#contentFlagModal").modal("hide"),$("#contentFlagModal").modal("hide others"),$("#contentFlagModal").modal("hide dimmer")},l.initializeModal=function(){l.showContentFlagModal=!0,s.interactTelemetryData(i.type,i.contentid,i.type,a.version,i.type+"-flag",i.type+"-read"),o(function(){$("#contentFlagModal").modal({onShow:function(){$(".helpPopup").popup({inline:!0})},onHide:function(){l.showContentFlagModal=!1,l.data={}}}).modal("show")},10)},l.createFlag=function(t){l.loader=r.loader("",a.messages.stmsg.m0077),e.flag(t,l.contentId).then(function(e){e&&"OK"===e.responseCode?o(function(){l.loader.showLoader=!1,l.showContentFlagModal=!1,l.hideContentFlagModal(),l.close()},2e3):(l.loader.showLoader=!1,r.error(a.messages.fmsg.m0050))}).catch(function(){l.loader.showLoader=!1,r.error(a.messages.fmsg.m0050)})},l.saveMetaData=function(e){var o={flaggedBy:l.userFullName,versionKey:l.contentVersionKey};e.flagReasons&&(o.flagReasons=[e.flagReasons]),e.comment&&(o.flags=[e.comment]),l.createFlag(o)},l.close=function(){l.hideContentFlagModal(),""!==a.search.searchKeyword?o(function(){a.$emit("initSearch",{})},0):t.go(i.redirect)}}]);
"use strict";angular.module("playerApp").controller("FlaggedContentController",["contentService","searchService","config","$rootScope","$state","toasterService","PaginationService","workSpaceUtilsService","permissionsService","telemetryService",function(e,t,r,o,n,a,s,i,g,c){function l(e,t,r,o){var n={};return n.showError=!0,n.isClose=e,n.message=t,n.messageType=r,o&&(n.messageText=o),n}var p=this;p.userId=o.userId,p.contentStatus=["Flagged"],p.sortBy="desc",p.pageLimit=9,p.pager={},p.getAllFlaggedContent=function(e){e=e||1,p.loader=a.loader("",o.messages.stmsg.m0038),p.error={};var n={filters:{status:p.contentStatus,createdFor:g.getRoleOrgMap()&&g.getRoleOrgMap().FLAG_REVIEWER,objectType:"Content",contentType:r.contributeContentType,createdBy:{"!=":p.userId}},sort_by:{lastUpdatedOn:p.sortBy},offset:(e-1)*p.pageLimit,limit:p.pageLimit};t.search(n).then(function(t){t&&"OK"===t.responseCode?(p.loader.showLoader=!1,p.error.showError=!1,p.flaggedContentData=[],t.result.content&&(p.flaggedContentData=t.result.content),p.totalCount=t.result.count,0===p.flaggedContentData.length&&(p.error=l(!0,o.messages.stmsg.m0039,o.messages.stmsg.m0008)),p.pager=s.GetPager(t.result.count,e,p.pageLimit)):(p.loader.showLoader=!1,a.error(o.messages.fmsg.m0023),p.error.showError=!1)}).catch(function(){p.loader.showLoader=!1,a.error(o.messages.fmsg.m0023),p.error.showError=!1})},p.openContentPlayer=function(e){i.openContentPlayer(e,n.current.name)},p.setPage=function(e){e<1||e>p.pager.totalPages||p.getAllFlaggedContent(e)},p.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})},p.generateInteractEvent=function(e,t){c.interactTelemetryData("workspace",t,e,"1.0","flaggedContent","workspace-flagged-content")};var u=[];p.lineInView=function(e,t,r,o){var n=_.filter(u,function(e){return e.objid===r.identifier});!0===t&&0===n.length&&u.push({objid:r.identifier,objtype:r.contentType||"workspace",section:o,index:e}),console.log("------",u),c.setVisitData(u)}}]);
"use strict";angular.module("playerApp").controller("BatchListController",["$rootScope","toasterService","batchService","$state","userService","PaginationService","permissionsService","telemetryService",function(e,t,s,r,a,i,n,o){function c(e,t,s,r){var a={};return a.showError=!0,a.isClose=e,a.message=t,a.messageType=s,r&&(a.messageText=r),a}var u=this;u.userId=e.userId,u.list=[],u.status=1,u.statusOptions=[{name:"Ongoing Batches",value:1},{name:"Upcoming Batches",value:0},{name:"Previous Batches",value:2}],$("#batchStatusOptions").dropdown(),u.pageLimit=9,u.pager={},u.listBatches=function(r){r=r||1;var a={request:{filters:{status:u.status.toString(),createdFor:n.getRoleOrgMap()&&n.getRoleOrgMap().COURSE_MENTOR,createdBy:u.userId},sort_by:{createdDate:"desc"},offset:(r-1)*u.pageLimit,limit:u.pageLimit}};s.getAllBatchs(a).then(function(a){if(a&&"OK"===a.responseCode){u.userList=[],u.userNames=[],u.participants=[],_.forEach(a.result.response.content,function(e){u.userList.push(e.createdBy),u.participants[e.id]=_.isUndefined(e.participant)?0:_.size(e.participant)}),u.userList=_.compact(_.uniq(u.userList));var n={request:{filters:{identifier:u.userList}}};s.getUserList(n).then(function(s){s&&"OK"===s.responseCode?_.forEach(s.result.response.content,function(e){u.userNames[e.identifier]=e.firstName+" "+e.lastName}):t.error(e.messages.fmsg.m0056)}).catch(function(){t.error(e.messages.fmsg.m0056)}),u.batchList=a.result.response.content||[],u.totalCount=a.result.response.count,u.pager=i.GetPager(a.result.response.count,r,u.pageLimit),0===u.batchList.length?u.error=c(!0,e.messages.stmsg.m0020,e.messages.stmsg.m0008):u.error={}}else t.error(e.messages.fmsg.m0004)}).catch(function(){t.error(e.messages.fmsg.m0004)})},u.listBatches(),u.showUpdateBatchModal=function(e){s.setBatchData(e),r.go("updateBatch",{batchId:e.identifier})},u.setPage=function(e){e<1||e>u.pager.totalPages||u.listBatches(e)},u.generateInteractEvent=function(e,t){o.interactTelemetryData("workspace",t,e,"1.0",e,"workspace-course-batches")};var g=[];u.lineInView=function(e,t,s,r){var a=_.filter(g,function(e){return e.objid===s.identifier});!0===t&&0===a.length&&g.push({objid:s.identifier,objtype:"batch",section:r,index:e}),console.log("------",g),o.setVisitData(g)}}]);
"use strict";angular.module("playerApp").controller("BatchController",["$rootScope","$timeout","$state","$scope","$stateParams","batchService","$filter","permissionsService","toasterService","courseService","learnService","$window","userService","telemetryService",function(e,t,r,s,a,n,o,i,c,d,u,l,h,m){var f=this;f.userList=[],f.menterList=[],f.userId=e.userId,f.courseId=a.courseId,f.coursecreatedby=a.coursecreatedby,f.submitted=!1,f.showBatchCard=s.showbatchcard,f.quantityOfBatchs=3,f.isMentor=!1,f.status=1,f.batchInfo="",f.statusOptions=[{name:"Ongoing",value:1},{name:"Upcoming",value:0}],f.showEnroll=!0,f.searchUserMap={},f.userSearchTime=0,f.showCreateBatchModal=function(){f.getUserList(),t(function(){f.data={enrollmentType:"invite-only"},$('input:radio[name="enrollmentType"]').filter('[value="invite-only"]').attr("checked",!0),$("#users,#mentors").dropdown({forceSelection:!1,fullTextSearch:!0}),$(".ui.calendar").calendar({refresh:!0}),$("#createBatchModal").modal({closable:!1,onShow:function(){var e=new Date;$(".ui.calendar#rangestartAdd").calendar({type:"date",minDate:new Date(e.setDate(e.getDate())),formatter:{date:function(e,t){return o("date")(e,"yyyy-MM-dd")}},onChange:function(e,t,r){_.isUndefined(f)?f={data:{startDate:t}}:_.isUndefined(f.data)?f.data={startDate:t}:f.data.startDate=t,$(".ui.calendar#rangeendAdd").calendar({type:"date",minDate:new Date(e.getFullYear(),e.getMonth(),e.getDate()+1),formatter:{date:function(e,t){return o("date")(e,"yyyy-MM-dd")}},onChange:function(e,t,r){_.isUndefined(f)?f={data:{endDate:t}}:_.isUndefined(f.data)?f.data={endDate:t}:f.data.endDate=t}})}}),$(".ui.calendar#rangeendAdd").calendar({type:"date",minDate:new Date(e.setDate(e.getDate()+1)),formatter:{date:function(e,t){return o("date")(e,"yyyy-MM-dd")}},startCalendar:$(".ui.calendar#rangestartAdd")}),$(".ui.modal.transition.hidden").remove()},onHide:function(){var e=JSON.parse(window.localStorage.getItem("previousURl"));r.go(e.name,e.params)}}).modal("show")},10)},f.hideCreateBatchModal=function(){$("#createBatchModal").modal("hide"),$("#createBatchModal").modal("hide others"),$("#createBatchModal").modal("hide dimmer")},f.addBatch=function(r){if(s.createBatch.$valid){"open"!==r.enrollmentType?(r.users=$("#users").dropdown("get value").split(","),r.mentors=$("#mentors").dropdown("get value").split(",")):(r.users=[],r.mentors=[]);var a={request:{courseId:f.courseId,name:r.name,description:r.description,enrollmentType:r.enrollmentType,startDate:r.startDate,endDate:r.endDate,createdBy:f.userId,createdFor:e.organisationIds,mentors:_.compact(r.mentors)}};n.create(a).then(function(s){if(s&&"OK"===s.responseCode)if(r.users&&r.users.length>0){var a={request:{userIds:_.compact(r.users)}};t(function(){n.addUsers(a,s.result.batchId).then(function(t){t&&"OK"===t.responseCode?(f.getCouserBatchesList(),f.hideCreateBatchModal()):c.error(e.messages.fmsg.m0053)}).catch(function(){c.error(e.messages.fmsg.m0053)})},100)}else f.hideCreateBatchModal();else c.error(e.messages.fmsg.m0052)}).catch(function(){c.error(e.messages.fmsg.m0052)})}},f.clearBatchData=function(){$("#createBatch").form("clear"),$("#createBatch").find(".search").val("")},f.getCouserBatchesList=function(){var t={request:{filters:{courseId:f.courseId},sort_by:{createdDate:"desc"}}};t.request.filters.status=_.isUndefined(f.status)?"1":f.status.toString(),_.intersection(i.getCurrentUserRoles(),["COURSE_MENTOR"]).length>0?(f.isMentor=!0,t.request.filters.createdBy=f.userId):t.request.filters.enrollmentType="open",n.getAllBatchs(t).then(function(t){if(t&&"OK"===t.responseCode)if(f.userList=[],f.userNames={},_.forEach(t.result.response.content,function(e){f.userList.push(e.createdBy)}),f.userList=_.compact(_.uniq(f.userList)),f.userList.length>0){var r={request:{filters:{identifier:f.userList}}};n.getUserList(r).then(function(r){r&&"OK"===r.responseCode?(_.forEach(r.result.response.content,function(e){f.userNames[e.identifier]=e}),f.batchList=t.result.response.content||[]):c.error(e.messages.fmsg.m0056)}).catch(function(){c.error(e.messages.fmsg.m0056)})}else f.batchList=t.result.response.content||[];else c.error(e.messages.fmsg.m0004)}).catch(function(){c.error(e.messages.fmsg.m0004)})},f.showUpdateBatchModal=function(e,t){n.setBatchData(e),r.go("updateBatch",{batchId:e.identifier,coursecreatedby:t})},t(function(){$("#users").dropdown({forceSelection:!1,fullTextSearch:!0,onAdd:function(){$("#createBatchModal").modal("refresh"),f.isUserSearch=1,f.getUserListWithQuery("")}}),$("#mentors").dropdown({fullTextSearch:!0,forceSelection:!1,onAdd:function(){$("#createBatchModal").modal("refresh"),f.isUserSearch=2,f.getUserListWithQuery("")}}),$("#users input.search").on("keyup",function(e){f.isUserSearch=1,f.getUserListWithQuery(this.value)}),$("#mentors input.search").on("keyup",function(e){f.isUserSearch=2,f.getUserListWithQuery(this.value)})},1e3),f.getUserListWithQuery=function(e){f.userSearchTime&&clearTimeout(f.userSearchTime),f.userSearchTime=setTimeout(function(){var t=f.searchUserMap[e];t?(f.isUserSearch=0,f.userList=t.user,f.menterList=t.mentor,$("#users").dropdown("refresh"),$("#mentors").dropdown("refresh")):f.getUserList(e)},1e3)},f.getUserList=function(t){var r=n.getRequestBodyForUserSearch(t);n.getUserList(r).then(function(r){r&&"OK"===r.responseCode?(_.forEach(r.result.response.content,function(r){if(r.identifier!==e.userId&&n.filterUserSearchResult(r,t)){var s={id:r.identifier,name:r.firstName+(r.lastName?" "+r.lastName:""),avatar:r.avatar,otherDetail:n.getUserOtherDetail(r)};_.forEach(r.organisations,function(e){-1!==_.indexOf(e.roles,"COURSE_MENTOR")&&f.menterList.push(s)}),f.userList.push(s)}}),f.userList=_.uniqBy(f.userList,"id"),f.menterList=_.uniqBy(f.menterList,"id"),f.searchUserMap[t||""]={mentor:_.clone(f.menterList),user:_.clone(f.userList)},$("#users").dropdown("refresh"),$("#mentors").dropdown("refresh"),f.isUserSearch=0):(f.isUserSearch=0,c.error(e.messages.fmsg.m0056))}).catch(function(){f.isUserSearch=0,c.error(e.messages.fmsg.m0056)})},f.showBatchDetails=function(t){if(f.participants={},_.isUndefined(t.participant))e.$broadcast("batchDetails",t),$("#batchDetails").modal("show");else{var r={request:{filters:{identifier:_.keys(t.participant)}}};n.getUserList(r).then(function(r){r&&"OK"===r.responseCode?(_.forEach(r.result.response.content,function(e){f.participants[e.identifier]=e}),t.userList=f.participants,console.log("batchData ",t),e.$broadcast("batchDetails",t),$("#batchDetails").modal("show")):c.error(e.messages.fmsg.m0056)}).catch(function(){c.error(e.messages.fmsg.m0056)})}},f.enrollUserToCourse=function(r){var s={request:{courseId:f.courseId,userId:f.userId,batchId:r}};d.enrollUserToCourse(s).then(function(r){r&&"OK"===r.responseCode?(f.showEnroll=!1,c.success(e.messages.smsg.m0036),t(function(){l.location.reload()},2e3)):c.error(e.messages.emsg.m0001)}).catch(function(){c.error(e.messages.emsg.m0001)})}}]);
"use strict";angular.module("playerApp").controller("BatchUpdateController",["$rootScope","$timeout","$state","$scope","$stateParams","config","batchService","$filter","toasterService","userService","permissionsService",function(e,t,a,r,s,n,i,o,c,d,u){var l=this;l.userList=[],l.menterList=[],l.userId=e.userId,l.submitted=!1,l.batchId=s.batchId,l.coursecreatedby=s.coursecreatedby,l.searchUserMap={},l.userSearchTime=0,l.selectedUsers=[],l.selectedMentors=[],l.init=function(){l.getBatchDetails(),l.getUserList()},l.getSelectedUser=function(e){var t=[];for(var a in e)e[a]&&t.push(a);return t},l.getBatchDetails=function(){if(l.batchData=i.getBatchData(),_.isEmpty(l.batchData))i.getBatchDetails({batchId:l.batchId}).then(function(t){if(t&&"OK"===t.responseCode){l.batchData=t.result.response;var a=l.getSelectedUser(l.batchData.participant),r=_.concat(a,l.batchData.mentors);l.getUserList(void 0,r)}else c.error(e.messages.fmsg.m0054)}).catch(function(){c.error(e.messages.fmsg.m0054)});else{var t=l.getSelectedUser(l.batchData.participant),a=_.concat(t,l.batchData.mentors);l.getUserList(void 0,a)}},l.showUpdateBatchModal=function(e,t){l.coursecreatedby=l.coursecreatedby||l.batchData.courseCreator,_.forEach(l.batchData.participant,function(e,t){_.isUndefined(_.find(l.userList,["id",t]))||(l.selectedUsers.push(_.find(l.userList,["id",t])),l.userList=_.reject(l.userList,["id",t]),l.selectedUsers=_.uniqBy(l.selectedUsers,"id"))}),_.forEach(l.batchData.mentors,function(e,t){_.isUndefined(_.find(l.menterList,["id",e]))||(l.selectedMentors.push(_.find(l.menterList,["id",e])),l.menterList=_.reject(l.menterList,["id",e]),l.selectedMentors=_.uniqBy(l.selectedMentors,"id"))}),l.isUserSearch=0,$("#users").dropdown("refresh"),$("#mentors").dropdown("refresh"),Object.keys(l.searchUserMap).length<=2&&l.initializeUI()},l.initializeUI=function(){t(function(){l.initializeEvent(),"open"===l.batchData.enrollmentType?$('input:radio[name="enrollmentType"]').filter('[value="open"]').attr("checked",!0):$('input:radio[name="enrollmentType"]').filter('[value="invite-only"]').attr("checked",!0),$(".ui.calendar").calendar({refresh:!0});var e=new Date,t=new Date(l.batchData.startDate),r=new Date(e.setDate(e.getDate()+1));r<t&&(t=r),$("#updateBatchModal").modal({closable:!1,onShow:function(){$(".ui.calendar#rangestartAdd").calendar({type:"date",minDate:new Date(t.getFullYear(),t.getMonth(),t.getDate()),formatter:{date:function(e,t){return o("date")(e,"yyyy-MM-dd")}},onChange:function(e,a,r){l.batchData.startDate=a,$(".ui.calendar#rangeendAdd").calendar({type:"date",minDate:new Date(t.getFullYear(),t.getMonth(),parseInt(t.getDate())+1),formatter:{date:function(e,t){return o("date")(e,"yyyy-MM-dd")}},onChange:function(e,t,a){l.batchData.endDate=t}})}}),$(".ui.calendar#rangeendAdd").calendar({type:"date",minDate:new Date(t.getFullYear(),t.getMonth(),parseInt(t.getDate())+1),formatter:{date:function(e,t){return o("date")(e,"yyyy-MM-dd")}},startCalendar:$(".ui.calendar#rangestartAdd"),onChange:function(e,t,a){l.batchData.endDate=t}}),$(".ui.calendar #startDate").val(l.batchData.startDate),$(".ui.calendar #endDate").val(l.batchData.endDate),$(".ui.modal.transition.hidden").remove()},onHide:function(){var e=JSON.parse(window.localStorage.getItem("previousURl"));s.name!==e.name?a.go(e.name,e.params):a.go("Toc",{courseId:l.batchData.courseId,lectureView:"yes"})}}).modal("show")},10)},l.clearForm=function(){$("#updateBatch").form("clear"),$("#updateBatch").find(".search").val("")},l.initializeEvent=function(){$("#users,#mentors").dropdown({forceSelection:!1,fullTextSearch:!0}),$("#users input.search").on("keyup",function(e){l.isUserSearch=1,l.getUserListWithQuery(this.value)}),$("#mentors input.search").on("keyup",function(e){l.isUserSearch=2,l.getUserListWithQuery(this.value)})},l.getUserListWithQuery=function(e){l.userSearchTime&&clearTimeout(l.userSearchTime),l.userSearchTime=setTimeout(function(){var t=l.searchUserMap[e];t?(l.isUserSearch=0,l.userList=t.user,l.menterList=t.mentor,$("#users").dropdown("refresh"),$("#mentors").dropdown("refresh")):l.getUserList(e)},1e3)},l.getUserList=function(t,a){var r=i.getRequestBodyForUserSearch(t,a);i.getUserList(r).then(function(r){r&&"OK"===r.responseCode?(_.forEach(r.result.response.content,function(a){if(a.identifier!==e.userId&&i.filterUserSearchResult(a,t)){var r={id:a.identifier,name:a.firstName+(a.lastName?" "+a.lastName:""),avatar:a.avatar,otherDetail:i.getUserOtherDetail(a)};_.forEach(a.organisations,function(e){-1!==_.indexOf(e.roles,"COURSE_MENTOR")&&l.menterList.push(r)}),l.userList.push(r)}}),l.userList=_.uniqBy(l.userList,"id"),l.menterList=_.uniqBy(l.menterList,"id"),a||(l.searchUserMap[t||""]={mentor:_.clone(l.menterList),user:_.clone(l.userList)}),l.isUserSearch=0,l.showUpdateBatchModal()):(l.isUserSearch=0,c.error(e.messages.fmsg.m0056))}).catch(function(){l.isUserSearch=0,c.error(e.messages.fmsg.m0056)})},l.hideUpdateBatchModal=function(){$("#updateBatchModal").modal("hide"),$("#updateBatchModal").modal("hide others"),$("#updateBatchModal").modal("hide dimmer")},l.updateBatchDetails=function(t){if(r.updateBatch.$valid){var a={request:{name:t.name,description:t.description,enrollmentType:t.enrollmentType,startDate:t.startDate,endDate:t.endDate,createdFor:t.createdFor,id:t.id}};if("open"!==t.enrollmentType){t.mentors=$("#mentorSelList").val().split(",");var s=[];_.forEach(l.selectedMentors,function(e){s.push(e.id)}),a.request.mentors=_.concat(_.compact(t.mentors),s)}i.update(a).then(function(a){if(a&&"OK"===a.responseCode)if("open"!==t.enrollmentType)if(t.users=_.compact($("#userSelList").val().split(",")),t.users&&t.users.length>0){var r={request:{userIds:t.users}};i.addUsers(r,t.id).then(function(t){t&&"OK"===t.responseCode?l.hideUpdateBatchModal():c.error(e.messages.fmsg.m0053)}).catch(function(){c.error(e.messages.fmsg.m0053)})}else l.hideUpdateBatchModal();else l.hideUpdateBatchModal();else c.error(e.messages.fmsg.m0055)}).catch(function(t){c.error(e.messages.fmsg.m0055)})}}}]);
"use strict";angular.module("playerApp").controller("LessonPlanController",["contentService","$timeout","$state","config","$rootScope","toasterService","configService","$scope",function(e,o,n,a,r,t,s,d){var l=this;l.formDropdown=s.getWorkspaceFormDropdown(),l.boards=l.formDropdown.boards,l.mediums=l.formDropdown.medium,l.subjects=l.formDropdown.subjects,l.grades=l.formDropdown.grades,l.showCreateLessonPlanModal=!1,l.isLessonPlanCreated=!1,l.userId=r.userId,l.mimeType="application/vnd.ekstep.content-collection",l.defaultName="Untitled lesson plan",l.contentType="LessonPlan",l.resourceType="Lesson Plan",l.hideCreateLessonPlanModal=function(){$("#createLessonPlanModal").modal("hide"),$("#createLessonPlanModal").modal("hide others"),$("#createLessonPlanModal").modal("hide dimmer")},l.initializeModal=function(){l.showCreateLessonPlanModal=!0,o(function(){$("#boardDropDown").dropdown(),$("#mediumDropDown").dropdown(),$("#subjectDropDown").dropdown(),$("#gradeDropDown").dropdown(),$("#createLessonPlanModal").modal({observeChanges:!0,onHide:function(){l.data={},l.isLessonPlanCreated||n.go("WorkSpace.ContentCreation")}}).modal("show")},10)},l.createContent=function(o){l.loader=t.loader("",r.messages.stmsg.m0050),e.create(o).then(function(e){e&&"OK"===e.responseCode?(l.isLessonPlanCreated=!0,l.showCreateLessonPlanModal=!1,l.loader.showLoader=!1,l.hideCreateLessonPlanModal(),l.initEKStepCE(e.result.content_id)):(l.loader.showLoader=!1,t.error(r.messages.fmsg.m0026))}).catch(function(){l.loader.showLoader=!1,t.error(r.messages.fmsg.m0026)})},l.saveMetaData=function(e,o){l.framework=o;var n=angular.copy(e);n.name=n.name?n.name:l.defaultName,n.mimeType=l.mimeType,n.createdBy=l.userId,n.contentType=l.contentType,n.resourceType=l.resourceType,n.framework=l.framework,n.language&&(n.language=[n.language]);var a={content:n};l.createContent(a)},l.initEKStepCE=function(e){var o={contentId:e,type:l.contentType,framework:l.framework};n.go("CollectionEditor",o)};var c=r.$on("CreateLessonPlan",function(e,o){l.saveMetaData(o.Data,o.framework)});d.$on("$destroy",function(){c()})}]);
"use strict";angular.module("playerApp").controller("orgDashboardController",["$rootScope","$scope","$timeout","$state","$stateParams","toasterService","adminService","QueryService","Visualizer",function(e,r,a,o,t,n,i,s,d){function g(e){u.showLoader=e}var u=this;u.height=110,u.datasetPreviousValue="creation";var c=new d({type:"line"});$("#dropdownMenu").dropdown();var l=new s.CreateNewInstance({eid:"downloadReport"});u.getAdminDashboardData=function(e){g(!0);var r="creation"===u.datasetPreviousValue?new s.CreateNewInstance({eid:"orgCreation"}):new s.CreateNewInstance({eid:"orgConsumption"});u.showDataDiv=!1,u.showOrgWarningDiv=!1,u.timePeriod=e||"7d",r.getData({identifier:u.orgId,timePeriod:u.timePeriod}).then(function(e){u.graphArray=c.render(e),u.numericStatArray=e.numericData,u.showDataDiv=!0,g(!1)}).catch(function(e){g(!1),n.error(e.params.errmsg)})},u.onAfterFilterChange=function(e){if(u.timePeriod===e)return!1;u.getAdminDashboardData(e)},u.onAfterDatasetChange=function(e){if(u.datasetPreviousValue===e)return!1;u.datasetPreviousValue=e,u.getAdminDashboardData()},u.showData=function(){if(u.orgIds=e.organisationIds,1===u.orgIds.length)u.orgId=u.orgIds[0],u.getAdminDashboardData();else{u.showOrgWarningDiv=!0;var r={request:{filters:{id:u.orgIds}}};i.orgSearch(r).then(function(e){if("OK"===e.responseCode){var r=[];_.forEach(e.result.response.content,function(e){r.push({organisationId:e.id,orgName:e.orgName})}),u.orgDetails=r}else n.error(e.params.errmsg)}).catch(function(){n.error(e.messages.emsg.m0005)})}},u.initDropdwon=function(){$("#dashboardMenu").dropdown({onChange:function(){}})},u.onAfterOrgChange=function(e){u.orgId=e,u.getAdminDashboardData()},u.downloadReport=function(){u.disabledClass=!0;var r="creation"===u.datasetPreviousValue?"ORG_CREATION":"ORG_CONSUMPTION";l.download({identifier:u.orgId,timePeriod:u.timePeriod},r).then(function(r){u.downloadReportText=e.messages.stmsg.m0095,$("#downloadReportModal").modal({closable:!0,observeChanges:!0}).modal("show"),u.disabledClass=!1}).catch(function(e){u.disabledClass=!1,n.error(e.params.errmsg)})}}]);
"use strict";angular.module("playerApp").controller("contentSharingController",["$timeout","$state","$rootScope","$scope","workSpaceUtilsService","telemetryService",function(e,o,t,n,a,i){var l=this;l.showContentShareModal=!1,l.id=n.id,l.type=n.type,l.icon=n.icon,l.type&&(l.link=a.getPublicShareUrl(l.id,l.type)),n.data&&(l.link=a.getUnlistedShareUrl(n.data)),l.hideContentShareModal=function(){e(function(){l.showContentShareModal=!1,$("#contentShareModal").modal("hide"),$("#contentShareModal").modal("hide others"),$("#contentShareModal").modal("hide all"),$("#contentShareModal").modal("hide dimmer")},0)},l.initializeModal=function(){l.showContentShareModal=!0,i.interactTelemetryData(n.type,l.id,l.type,t.version,n.type+"-read","share-"+n.type),e(function(){$("#contentShareModal").modal({onHide:function(){l.hideContentShareModal()}}).modal("show")},10),e(function(){$("#copyLinkButton").trigger("click",function(){l.copyLink()})},1e3),i.shareTelemetryData(n.type,l.id,l.type,t.version)},l.close=function(){l.showContentShareModal=!1,l.hideContentShareModal()},l.copyLink=function(){$("#copyLinkData").select(),document.execCommand("copy"),$("#buttonPopUp").popup({popup:$("#LinkCopiedToClipboard"),on:"click",position:"top center",color:"#4183c4"})}}]);
"use strict";angular.module("playerApp").controller("PublicProfileController",["$scope","$rootScope","$stateParams","searchService","toasterService","$timeout","$state","userService",function(e,s,r,o,i,t,n,l){var d=this,a=window.atob(r.userId),u=s.userId;d.profile=function(e){d.loader=i.loader("",s.messages.stmsg.m0005),o.getPublicUserProfile(a,e).then(function(e){if(d.loader.showLoader=!1,"OK"===e.responseCode){d.user=e.result.response,d.user.dob=d.user.dob?new Date(d.user.dob):d.user.dob;var r=void 0!==d.user.skills?d.user.skills:[];r.length&&(r.forEach(function(e){if(e.endorsersUserId=[],e.endorsersList){_.map(e.endorsersList,"userId").forEach(function(s){e.endorsersUserId.push(s)})}}),r.forEach(function(e){e.isEndorsable=!e.endorsersUserId.includes(u)})),d.userSkills=r}else i.error(s.messages.fmsg.m0005)}).catch(function(){d.loader.showLoader=!1,i.error(s.messages.fmsg.m0005)})},d.close=function(){""!==s.search.searchKeyword?t(function(){s.$broadcast("initSearch",{})},500):n.go("Profile")},d.defaultLimit=4,d.limit=d.defaultLimit,d.resetLimit=0,d.setLimit=function(e){d.limit=e<=0?d.userSkills.length:e},d.endorsement=function(e){l.addSkills({request:{skillName:[e],endorsedUserId:a}}).then(function(e){e&&"OK"===e.responseCode?d.profile("endorsement"):i.error(s.messages.fmsg.m0063)})},d.profile()}]);
"use strict";angular.module("playerApp").controller("courseProgressDashboardCtrl",["$rootScope","$scope","QueryService","$timeout","$state","$stateParams","toasterService","batchService",function(e,o,t,r,s,a,i,n){function d(e){c.showLoader=e}var c=this;c.showError=!1,d(!0);var l=new t.CreateNewInstance({eid:"downloadReport"}),u={"7d":e.messages.imsg.m0022,"14d":e.messages.imsg.m0023,"5w":e.messages.imsg.m0024,fromBegining:e.messages.imsg.m0025};c.getCourseDashboardData=function(e){d(!0),c.timePeriod=e||"7d",c.dashboarData=[],new t.CreateNewInstance({eid:"courseProgress"}).getData({identifier:c.batchIdentifier,timePeriod:c.timePeriod}).then(function(e){c.showError=!1,c.filterText=u[c.timePeriod],c.dashboarData=e,d(!1)}).catch(function(e){c.showErrors()})},c.onAfterFilterChange=function(e){if(c.timePeriod===e)return console.log("avoid same apis call twice"),!1;c.orderByField="",c.getCourseDashboardData(e)},c.loadData=function(){var o={request:{filters:{courseId:a.courseId,status:["1","2","3"],createdBy:e.userId},sort_by:{createdDate:"desc"}}};c.myBatches=[],c.searchUser="",n.getAllBatchs(o).then(function(e){e&&"OK"===e.responseCode?e.result.response.content.length>0&&(c.myBatches=e.result.response.content,c.buildMyBatchesDropdown()):c.showErrors(),d(!1)}).catch(function(e){c.showErrors()})},c.buildMyBatchesDropdown=function(){if(1===c.myBatches.length){var e=_.first(_.values(c.myBatches),1);c.batchIdentifier=e.id,c.courseName=e.name,c.getCourseDashboardData("7d")}else d(!1),c.isMultipleCourses=c.myBatches.length>1},c.resetDropdown=function(){$("#courseDropdownValues").dropdown("restore defaults")},c.showErrors=function(){c.showError=!0,d(!1)},c.initDropdwon=function(){$("#myBatchesListFilter").dropdown({})},c.onAfterBatchChange=function(e){if(c.batchIdentifier===e)return console.log("avoid same apis call twice"),!1;c.batchIdentifier=e,c.isMultipleCourses=!1,c.getCourseDashboardData(c.timePeriod)},c.downloadReport=function(){c.disabledClass=!0,l.download({identifier:c.batchIdentifier,timePeriod:c.timePeriod},"COURSE_PROGRESS").then(function(o){c.downloadReportText=e.messages.stmsg.m0095,$("#downloadReportModal").modal({closable:!0,observeChanges:!0}).modal("show"),c.disabledClass=!1}).catch(function(e){c.disabledClass=!1,i.error(e.params.errmsg)})}}]);
"use strict";angular.module("playerApp").controller("courseConsumptionDashboardCtrl",["$rootScope","$scope","$state","$stateParams","toasterService","searchService","QueryService","Visualizer","telemetryService",function(e,r,t,o,s,n,i,a,u){function c(e){d.showLoader=e}var d=this;d.chartHeight=110,c(!0);var l=new i.CreateNewInstance({eid:"courseConsumption"}),f=new a({type:"line"});d.getCourseDashboardData=function(e){c(!0),d.timePeriod=e||"7d",l.getData({identifier:d.courseIdentifier,timePeriod:d.timePeriod}).then(function(e){d.data=f.render(e),d.consumptionNumericData=e.numericData,c(!1),d.showError=!1}).catch(function(e){d.showErrors()})},d.onAfterFilterChange=function(e){if(d.timePeriod===e)return!1;d.getCourseDashboardData(e)},d.loadData=function(){var r={filters:{status:["Live"],createdBy:e.userId,contentType:["Course"]},sort_by:{lastUpdatedOn:"desc"}};d.myCoursesList=[],n.search(r).then(function(e){e&&"OK"===e.responseCode?e.result.content&&e.result.content.length>0?(d.myCoursesList=e.result.content,d.buildMyCoursesDropdown(),d.version=e.ver):c(!1):d.showErrors()}).catch(function(e){d.showErrors()}),d.generateImpressionEvent("dasboard","profile-course-creator-dashboard","/course-creator-dashboard","profile",d.version)},d.buildMyCoursesDropdown=function(){if(1===d.myCoursesList.length){var e=_.first(_.values(d.myCoursesList),1);d.courseIdentifier=e.identifier,d.courseName=e.name,d.getCourseDashboardData("7d")}else c(!1),d.isMultipleCourses=d.myCoursesList.length>1},d.showErrors=function(){d.showError=!0,c(!1)},d.onAfterCourseChange=function(e){if(d.courseIdentifier===e)return!1;d.courseIdentifier=e,d.isMultipleCourses=!1,d.getCourseDashboardData(d.timePeriod)},d.initDropdwon=function(){$("#myCoursesListFilter").dropdown()},d.generateImpressionEvent=function(r,t,o,s,n){var i={env:s,rollup:u.getRollUpData(e.organisationIds)},a={id:"",type:r,ver:n},c={edata:u.impressionEventData("view","scroll",t,o),context:u.getContextData(i),object:u.getObjectData(a),tags:_.concat([],org.sunbird.portal.channel)};u.impression(c)}}]);
"use strict";angular.module("playerApp").controller("bulkUploadController",["adminService","$timeout","$state","config","$rootScope","$scope","contentService","toasterService",function(e,s,o,r,a,l,t,d){var u=this;u.bulkUsers={},u.sampleOrgCSV=[{orgName:"orgName",isRootOrg:"isRootOrg",channel:"channel",externalId:"externalId",provider:"provider",description:"description",homeUrl:"homeUrl",orgCode:"orgCode",orgType:"orgType",preferredLanguage:"preferredLanguage",contactDetail:"contactDetail"}],u.sampleUserCSV=[{firstName:"firstName",lastName:"lastName",phone:"phone",email:"email",userName:"userName",password:"password",provider:"provider",phoneVerified:"phoneVerified",roles:"roles",position:"position",grade:"grade",location:"location",dob:"dob",gender:"gender",language:"language",profileSummary:"profileSummary",subject:"subject"}],u.orgBulkUpload=function(){u.showUploadOrgModal=!0,s(function(){$("#orgBulkUpload").modal({onShow:function(){u.fileName="",u.bulkOrgProcessId="",u.loader={}},onHide:function(){return u.loader={},u.fileName="",u.bulkOrgProcessId="",s(function(){u.showUploadOrgModal=!1},0),!0}}).modal("show")},0),$("#orgBulkUpload").modal("refresh")},u.userBulkUpload=function(){$("#userBulkUpload").modal("refresh"),u.showUploadUserModal=!0,s(function(){$("#userBulkUpload").modal({onShow:function(){u.bulkUsers={},u.fileName="",u.bulkUsersProcessId="",$("#bulkUsers").form("reset"),u.loader={},u.isUploadLoader=!1},onHide:function(){return s(function(){u.showUploadUserModal=!1},0),!0}}).modal("show")},0),$("#userBulkUpload").modal("refresh")},u.statusBulkUpload=function(){u.showStatusModal=!0,s(function(){$("#statusBulkUpload").modal({onShow:function(){$("#statusForm").form("reset"),u.uploadStatusKey="",u.bulkUploadStatus={},u.bulkUploadStatus.processId="",u.processID=""},onHide:function(){return u.bulkUploadStatus={},u.bulkUploadStatus.processId="",s(function(){u.showStatusModal=!1},0),!0}}).modal("show")},0),$("#statusBulkUpload").modal("refresh")},u.openImageBrowser=function(e){"users"===e?u.bulkUsers.provider&&u.bulkUsers.externalid||u.bulkUsers.OrgId?u.bulkUploadError||(u.isUploadLoader=!0,$("#uploadUsrsCSV").click()):(u.bulkUploadError=!0,u.bulkUploadErrorMessage=a.messages.emsg.m0003,u.bulkUploadError||s(function(){u.bulkUploadError=!1,u.bulkUploadErrorMessage="",u.bulkUsers={}},5e3)):"organizations"===e&&(u.isUploadLoader=!0,$("#orgUploadCSV").click())},l.validateFile=function(e,s){var o=new FormData,r=new FileReader;e[0]&&e[0].name.match(/.(csv)$/i)?(r.onload=function(){"users"===s?(o.append("user",e[0]),u.bulkUploadUsers(o)):"organizations"===s&&(o.append("org",e[0]),u.bulkUploadOrganizations(o))},u.fileName=e[0].name,r.readAsDataURL(e[0]),u.fileToUpload=o):d.error(a.messages.stmsg.m0080)},u.bulkUploadUsers=function(){$("#uploadUsrsCSV").val(""),u.loader=d.loader("",a.messages.stmsg.m0079),u.fileToUpload.append("organisationId",u.bulkUsers.OrgId||""),u.fileToUpload.append("externalId",u.bulkUsers.externalid),u.fileToUpload.append("provider",u.bulkUsers.provider),e.bulkUserUpload(u.fileToUpload).then(function(e){u.loader.showLoader=!1,"OK"===e.responseCode?(u.bulkUsersProcessId=e.result.processId,u.bulkUsersRes=e.result.response,d.success(a.messages.smsg.m0030)):"CLIENT_ERROR"===e.responseCode?d.error(e.params.errmsg):d.error(a.messages.fmsg.m0051)}).catch(function(e){u.loader.showLoader=!1,d.error(a.messages.fmsg.m0051)})},u.bulkUploadOrganizations=function(){$("#orgUploadCSV").val(""),u.loader=d.loader("",a.messages.stmsg.m0078),e.bulkOrgrUpload(u.fileToUpload).then(function(e){u.loader.showLoader=!1,"OK"===e.responseCode?(u.bulkOrgProcessId=e.result.processId,u.bulkOrgRes=e.result.response,d.success(a.messages.smsg.m0031)):"CLIENT_ERROR"===e.responseCode?d.error(e.params.errmsg):d.error(a.messages.fmsg.m0051)}).catch(function(e){u.loader.showLoader=!1,d.error(a.messages.fmsg.m0051)})},u.closeBulkUploadError=function(){u.bulkUploadError=!1,u.bulkUploadErrorMessage="",u.bulkUsers={}},u.getBulkUloadStatus=function(s,o){u.loader=d.loader("","Getting status "),e.bulkUploadStatus(s).then(function(e){if(u.loader.showLoader=!1,$("#statusBulkUpload").modal({observeChanges:!0}).modal("refresh"),"OK"===e.responseCode)u.uploadStatusKey=o,"string"==typeof e.result.response?d.success(e.result.response):(e.result.response[0].successResult.forEach(function(e){if(e.createdDate){var s=new Date(e.createdDate);e.createdDate=moment(s).format("DD/MM/YYYY")}}),u.bulkUploadStatus.success=e.result.response[0].successResult,u.bulkUploadStatus.failure=e.result.response[0].failureResult,u.bulkUploadStatus.processId=e.result.response[0].processId,u.bulkUploadStatus.objectType=e.result.response[0].objectType,d.success(a.messages.smsg.m0032));else{var s=e.params&&e.params.errmsg?e.params.errmsg:a.messages.fmsg.m0051;d.error(s)}}).catch(function(e){u.loader.showLoader=!1,d.error(a.messages.fmsg.m0051)})},u.downloadSample=function(e){"users"===e?alasql("SELECT * INTO CSV('Sample_Users.csv', {headers: false,separator:\",\"}) FROM ?",[u.sampleUserCSV]):"organizations"===e&&alasql(" SELECT *  INTO CSV('Sample_Organizations.csv', {headers: false,separator:\",\"}) FROM ?",[u.sampleOrgCSV])}}]);
"use strict";angular.module("playerApp").filter("dateFilterWithMDY",function(){return function(t){return moment(t).format("MMMM Do YYYY")}}).filter("dateFilterXTimeAgo",function(){return function(t){var r=moment(t).local().format("YYYY-MM-DD HH:mm:ss");return moment(r).fromNow()}}).filter("dateFilterWithDMY",function(){return function(t){return moment(t).format("Do MMMM YYYY")}}).filter("dateFilterWithMY",function(){return function(t){return moment(t).format("MMM YYYY")}});
"use strict";angular.module("playerApp").filter("noteListFilter",function(){return function(e,r){if(r){var n=angular.lowercase(r);return e.filter(function(e){return angular.lowercase(e.title).includes(n)||angular.lowercase(e.note).includes(n)})}return e}});
angular.module("playerApp").filter("highlight",["$sce",function(e){return function(t,l){return l&&(t=t.replace(new RegExp("("+l+")","gi"),'<span id="highlighted" style = "color:#009fda">$1</span>')),e.trustAsHtml(t)}}]);
"use strict";angular.module("playerApp").directive("applyScript",["$timeout",function(e){return{restrict:"A",link:function(a,t,r){$(".popup-button").popup(),$("#content-search-filter-accordion").accordion(),$(".ui.accordion").accordion({exclusive:!1}),e(function(){$(".courseHeader-rating").rating("disable"),$(".ui .progress").progress(),$(".course-progress").progress()},0),$(".dropdown.resource-search-filter").dropdown({useLabels:!1,forceSelection:!1,label:{duration:0},debug:!1,performance:!0}),$(".dropdown.course-search-filter").dropdown({useLabels:!1,forceSelection:!1,label:{duration:0},debug:!1,performance:!0}),$(".signupMultiple").dropdown({}),$("#multi-select-sort").dropdown(),$("#dropdown-menu-list-header").dropdown({useLabels:!1,forceSelection:!1,label:{duration:0},debug:!1,performance:!0}),$("#headerSearch").dropdown();var n=new Date;a.getDate=function(e){if(!e)return"";var a=e.getDate(),t=e.getMonth()+1;return e.getFullYear()+"-"+t+"-"+a},$("#example2").calendar({type:"date",maxDate:n,formatter:{date:a.getDate}}),$("#start").calendar({type:"date",maxDate:n,endCalendar:$("#start"),formatter:{date:a.getDate}}),$("#end").calendar({type:"date",maxDate:n,startCalendar:$("#end"),formatter:{date:a.getDate},onChange:function(e,a){angular.element($("#endDateInput").val(a)).triggerHandler("input")}}),$("#rangestartAdd").calendar({type:"date",maxDate:n,endCalendar:$("#rangeendAdd"),formatter:{date:a.getDate}}),$("#rangeendAdd").calendar({type:"date",maxDate:n,startCalendar:$("#rangestartAdd"),formatter:{date:a.getDate}}),$(".rangeStart").calendar({type:"date",maxDate:n,endCalendar:$(".rangeEnd"),formatter:{date:a.getDate}}),$(".rangeEnd").calendar({type:"date",maxDate:n,startCalendar:$(".rangeStart"),formatter:{date:a.getDate}}),$("#editDob").calendar({type:"date",maxDate:n,formatter:{date:a.getDate}})}}}]);
"use strict";angular.module("playerApp").directive("appLoader",function(){return{templateUrl:"views/common/loaderWithMessage.html",restrict:"E",link:function(a,e,t){t.data=t.data?JSON.parse(t.data):void 0,a.headerMessage=t.data&&t.data.headerMessage?t.data.headerMessage:"Please wait.",a.loaderMessage=t.data&&t.data.loaderMessage?t.data.loaderMessage:"We are fetching details"}}});
"use strict";angular.module("playerApp").directive("errorMessage",function(){return{templateUrl:"views/common/errorPage.html",restrict:"E",scope:{visibility:"="},link:function(e,a,s){s.data=s.data?JSON.parse(s.data):void 0,e.isClose=!(!s.data||!s.data.isClose)&&s.data.isClose,s.data&&"info"===s.data.messageType?(e.message=s.data.message?s.data.message:"Something wrong try in sometime.",e.errorClass="info"):s.data&&"warning"===s.data.messageType?(e.message=s.data.message?s.data.message:"Something wrong try in sometime.",e.errorClass="warning"):s.data&&"error"===s.data.messageType?(e.message=s.data.message?s.data.message:"Something wrong try in sometime.",e.errorClass="error"):s.data&&"success"===s.data.messageType?(e.message=s.data.message?s.data.message:"Success.",e.errorClass="success"):s.data&&"no-results"===s.data.messageType&&(e.message=s.data.message?s.data.message:"",e.messageText=s.data.messageText,e.errorClass="no-results"),e.closeErrorMessage=function(){e.visibility=!1}}}});
"use strict";angular.module("playerApp").directive("contentPlayer",function(){return{templateUrl:"views/contentplayer/player.html",restrict:"E",scope:{id:"=",body:"=",visibility:"=",isshowmetaview:"=",isclose:"=",isheader:"=",height:"=",width:"=",ispercentage:"=",closeurl:"=",isworkspace:"=",contenteditmode:"=?"},link:function(e,t,i){e.ispercentage?($("#contentPlayer").css("height",e.height+"%"),$("#contentPlayer").css("width",e.width+"%")):($("#contentPlayer").css("height",e.height+"px"),$("#contentPlayer").css("width",e.width+"px")),e.$watch("body",function(t,i){i?t.identifier&&t.identifier!==i.identifier&&e.updateContent(e):void 0===i&&e.updateContent(e)}),e.$watch("id",function(){e.updateContent(e)})},controller:"contentPlayerCtrl"}});
"use strict";angular.module("playerApp").directive("noteCard",function(){return{templateUrl:"views/note/noteCard.html",restrict:"E",scope:{shownotecard:"=",courseid:"=",contentid:"="},link:function(t,e,n){t.$watch("contentid",function(){t.updateNoteMetaData(t.contentid)})},controller:"NoteCardCtrl as noteCard"}});
"use strict";angular.module("playerApp").directive("courseDiscussions",function(){return{templateUrl:"views/course/courseDiscussions.html",restrict:"E",scope:{showaskquestion:"="},link:function(s,e,i){s.showAskQuestion=s.showaskquestion}}});
"use strict";angular.module("playerApp").directive("addSlick",function(){return{restrict:"A",link:function(s,i,e){s.$last&&$(i).parent().not(".slick-initialized").slick({infinite:!1,slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:2800,settings:{slidesToShow:8,slidesToScroll:4}},{breakpoint:2200,settings:{slidesToShow:6,slidesToScroll:4}},{breakpoint:2e3,settings:{slidesToShow:5,slidesToScroll:4}},{breakpoint:1400,settings:{slidesToShow:4,slidesToScroll:4}},{breakpoint:1024,settings:{unslick:!0}},{breakpoint:600,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]}),$(i).closest(".slick-slider").find(".slick-prev").hide(),$(i).parent().not(".slick-initialized").on("afterChange",function(s,e,o){var l=$(i).closest(".slick-slider").find(".slick-prev"),t=$(i).closest(".slick-slider").find(".slick-next"),n=e.slideCount,r=Math.floor(n/4),d=Math.floor(o/4);n%4!=0?0===o&&n>4?(l.hide(),t.show()):o>0&&d===r?(l.show(),t.hide()):n>=o+4&&(t.show(),l.show()):0===o&&n>4?(l.hide(),t.show()):o>0&&d!==r?(l.show(),t.hide()):n>=o+4&&(t.show(),l.show())})}}});
"use strict";angular.module("playerApp").directive("addNote",function(){return{templateUrl:"views/note/noteAddCardModal.html",restrict:"E",scope:{shownoteinlecture:"=",shownoteincourse:"=",courseid:"=",contentid:"=",visibility:"="},link:function(t,e,n){t.$watch("contentid",function(){t.updateContentId(t.contentid)})},controller:"NoteCardCtrl as noteCard"}});
"use strict";angular.module("playerApp").directive("sbPermissions",["permissionsService","$rootScope",function(e,s){return{restrict:"A",scope:{},link:function(i,o,r){r.permissionOnly&&(e.checkRolesPermissions(r.permissionOnly.split(","),!0)?s.$broadcast("permissionOnlyViewUpdated",{action:"notRemoved",element:o,attrs:r}):(o.remove(),s.$broadcast("permissionOnlyViewUpdated",{action:"removed",element:o,attrs:r}))),r.permissionExcept&&e.checkRolesPermissions(r.permissionExcept.split(","),!1)&&o.remove()}}}]);
"use strict";angular.module("playerApp").directive("pageSection",function(){return{templateUrl:"views/common/pageSection.html",restrict:"E",scope:{type:"="},link:function(e,t,n){},controller:"pageSectionCtrl as section"}});
"use strict";angular.module("playerApp").directive("search",function(){return{templateUrl:"views/header/search.html",restrict:"E",scope:{type:"="},link:function(e,r,t){},controller:"SearchResultController"}});
"use strict";angular.module("playerApp").directive("contentFlag",function(){return{templateUrl:"views/common/contentFlagModal.html",restrict:"E",scope:{type:"=",contentid:"=",contentname:"=",versionkey:"=",redirect:"="},link:function(t,e,n){},controller:"contentFlagController as contentFlag"}});
"use strict";angular.module("playerApp").directive("batchCard",function(){return{templateUrl:"views/batch/batchCard.html",restrict:"E",scope:{showbatchcard:"=",coursecreatedby:"="},link:function(t,e,r,a){$("#batchStatusOptions").dropdown("set selected ",a.status),a.getCouserBatchesList()},controller:"BatchController as batch",bindToController:!0}});
"use strict";angular.module("playerApp").directive("conceptPicker",function(){return{templateUrl:"views/common/conceptSelector.html",restrict:"E",scope:{type:"=",selectedConcepts:"=",isSearchPage:"="},link:function(e,t,c){},controller:"ConceptPickerController"}});
"use strict";angular.module("playerApp").directive("userSearch",function(){return{templateUrl:"views/search/userSearch.html",restrict:"E",scope:{users:"=",type:"="},link:function(e,r,t){},controller:"adminController as admin"}});
"use strict";angular.module("playerApp").directive("bulkUpload",function(){return{templateUrl:"views/admin/uploadFile.html",restrict:"E",scope:{type:"="},link:function(l,e,t){},controller:"bulkUploadController as admin"}});
"use strict";angular.module("playerApp").directive("batchDetails",["$rootScope",function(t){return{restrict:"E",controller:"BatchController",controllerAs:"batch",scope:{batchInfo:"="},link:function(e,c,l,o){t.$on("batchDetails",function(t,e){o.batchInfo=e})},replace:!0,templateUrl:"views/batch/batchDetails.html"}}]);
"use strict";angular.module("playerApp").directive("contentShare",function(){return{templateUrl:"views/common/contentSharing.html",restrict:"E",scope:{id:"=",type:"=",icon:"=",data:"="},link:function(t,n,e){},controller:"contentSharingController as contentShare"}});
"use strict";angular.module("playerApp").service("setupService",["config","restfulLearnerService",function(e,r){this.addOrgType=function(t){var n=e.URL.ORG_TYPE.ADD;return r.post(n,t)},this.updateOrgType=function(t){var n=e.URL.ORG_TYPE.UPDATE;return r.patch(n,t)},this.getOrgTypes=function(){var t=e.URL.ORG_TYPE.GET;return r.get(t)}}]);
"use strict";angular.module("playerApp").controller("setupController",["$rootScope","setupService","toasterService",function(e,r,s){var o=this;o.getOrgTypes=function(){o.loader=s.loader("","loading please wait"),r.getOrgTypes().then(function(r){o.loader.showLoader=!1;try{if("OK"!==r.responseCode)throw"CLIENT_ERROR"===r.responseCode?new Error(r.params.errmsg):new Error("");var n=angular.copy(r.result.response);o.orgTypes=_.sortBy(n,function(e){return e.name.toLowerCase()})}catch(r){r.message?s.error(r.message):s.error(e.messages.fmsg.m0059)}})},o.openUpdateModal=function(e){$("#updateOrgType").modal({onShow:function(){o.selectedOrg={},o.selectedOrg.orgType=e,o.isUpdated=!1},onHide:function(){return o.selectedOrg={},o.isUpdated=!1,!0}}).modal("show"),$("#updateOrgType").modal("refresh")},o.openAddTypeModal=function(){$("#addOrgType").modal({onShow:function(){o.newOrgType=""},onHide:function(){return o.newOrgType="",!0}}).modal("show"),$("#addOrgType").modal("refresh")},o.addOrgType=function(n){var t={request:{name:n}};r.addOrgType(t).then(function(r){try{if("OK"!==r.responseCode)throw"CLIENT_ERROR"===r.responseCode?new Error(r.params.errmsg):new Error("");s.success(e.messages.smsg.m0035),o.getOrgTypes()}catch(r){r.message?s.error(r.message):s.error(e.messages.fmsg.m0058)}})},o.updateOrgType=function(n){var t={request:n};r.updateOrgType(t).then(function(r){try{if("OK"!==r.responseCode)throw"CLIENT_ERROR"===r.responseCode?new Error(r.params.errmsg):new Error("");s.success(e.messages.smsg.m0037),o.getOrgTypes()}catch(r){r.message?s.error(r.message):s.error(e.messages.fmsg.m0060)}})},o.getOrgTypes()}]);
"use strict";angular.module("playerApp").controller("LimitedPublishedContentController",["contentService","searchService","config","$rootScope","$state","toasterService","workSpaceUtilsService","$timeout","PaginationService","telemetryService",function(e,t,o,n,r,s,i,a,l,d){function m(e,t,o,n){var r={};return r.showError=!0,r.isClose=e,r.message=t,r.messageType=o,n&&(r.messageText=n),r}var c=this;c.userId=n.userId,c.status=["Unlisted"],c.sortBy="desc",c.selectedContentItem=[],c.pageLimit=9,c.pager={},c.getlimitedpublishedContent=function(e){e=e||1,c.loader=s.loader("",n.messages.stmsg.m0082),c.error={};var r={filters:{status:c.status,createdBy:c.userId,objectType:"Content",contentType:o.contributeContentType},sort_by:{lastUpdatedOn:c.sortBy},offset:(e-1)*c.pageLimit,limit:c.pageLimit};t.search(r).then(function(t){t&&"OK"===t.responseCode?(c.error.showError=!1,c.loader.showLoader=!1,c.pager=l.GetPager(t.result.count,e,c.pageLimit),c.limitedpublishedContentData=t.result.content||[],c.totalCount=t.result.count,c.pageNumber=e,c.version=t.ver,0===c.limitedpublishedContentData.length&&(c.error=m(!0,n.messages.stmsg.m0083,n.messages.stmsg.m0008))):(c.error.showError=!1,c.loader.showLoader=!1,s.error(n.messages.fmsg.m0064))}).catch(function(){c.error.showError=!1,c.loader.showLoader=!1,s.error(n.messages.fmsg.m0064)})},c.openContentPlayer=function(e){i.openContentEditor(e,r.current.name)},c.initializeUIElement=function(){$("#actionDropDown").dropdown()},c.openRemoveContentModel=function(e){c.removeContentId=e,c.showRemoveContentModel=!0,a(function(){$("#removeContentModel").modal({}).modal("show")},10)},c.hideRemoveContentModel=function(){i.hideRemoveModel("#removeContentModel"),c.removeContentId="",c.showRemoveContentModel=!1},c.deleteContent=function(t){var o=[t];c.hideRemoveContentModel(),c.loader=s.loader("",n.messages.stmsg.m0034);var r={contentIds:o};e.retire(r).then(function(e){e&&"OK"===e.responseCode?(c.loader.showLoader=!1,c.selectedContentItem=[],c.version=e.ver,s.success(n.messages.smsg.m0006),c.limitedpublishedContentData=i.removeContentLocal(c.limitedpublishedContentData,o),c.pager=l.GetPager(c.totalCount-o.length,c.pageNumber,c.pageLimit),0===c.limitedpublishedContentData.length&&c.getlimitedpublishedContent(c.pager.currentPage)):(c.loader.showLoader=!1,s.error(n.messages.fmsg.m0022))}).catch(function(){c.loader.showLoader=!1,s.error(n.messages.fmsg.m0022)})},c.setPage=function(e){e<1||e>c.pager.totalPages||c.getlimitedpublishedContent(e)},c.initTocPopup=function(){$(".cardTitleEllipse").popup({inline:!0})},c.generateInteractEvent=function(e,t){d.interactTelemetryData("workspace",t,e,"1.0","unlistedContent","workspace-unlisted-content")};var u=[];c.lineInView=function(e,t,o,n){var r=_.filter(u,function(e){return e.objid===o.identifier});!0===t&&0===r.length&&u.push({objid:o.identifier,objtype:o.contentType||"workspace",section:n,index:e}),console.log("------",u),d.setVisitData(u)}}]);
"use strict";angular.module("playerApp").directive("fineUploader",function(){return{templateUrl:"views/common/fileUploader.html",restrict:"A",require:"?ngModel",scope:{},link:function(e,r,i,l){}}});
angular.module("playerApp").service("geoService",["$rootScope","restfulLearnerService","config",function(e,r,o){this.getItems=function(e,o){var t="org/v1/location/read/"+e.id+"?type=organisation";return r.get(t,e)}}]);
angular.module("playerApp").component("parent",{transclude:!0,bindings:{config:"<"},templateUrl:"views/components/parent.html",controller:["$scope","$rootScope",function(t,e){this.items={};var i=this;this.$onInit=function(){e.$on("get:selected:items",function(){e.$emit("items:from:child"),e.$emit("selected:items",i.items)})},this.setItem=function(t){var e=this;_.isEmpty(t)?console.warn("Item is empty"):e.items[t.key]=t.value}}]});
angular.module("playerApp").component("geo",{require:{parent:"^parent"},controller:["$scope","$rootScope","$injector",function(e,t,i){var o=this;this.keyName="geo",this.items=void 0,this.receipients=[];var n={key:"geo",value:{}};this.$onInit=function(){var e=this,i=e.getConfig();e.receipients=t.receipients,_.has(i,e.keyName)&&e.initialize(i),t.$on("component:update",e.updateItems)},this.initialize=function(e){t.$on("items:from:child",function(){n.value=o.getSelectedItems(),o.parent.setItem(n)}),e[this.keyName].adopter?this.validateAdopter(e[this.keyName]):console.error("Adopter is required")},this.updateItems=function(e,n){var r=o.getConfig(),s=i.get(r[o.keyName].service),a={id:t.rootOrgId};s.getItems(a).then(function(e){if(e&&"OK"===e.responseCode){var t=e.result.response;_.forEach(t,function(e){-1!==n.indexOf(e.id)&&(e.selected=!0)}),o.renderItems(t)}else console.error("Locations are not found")}).catch(function(e){console.error("Unable to fetch the locations",e)})},this.getConfig=function(){if(this.parent)return this.parent.config;console.error("Parent component is need to initialize.")},this.renderItems=function(e){this.items=e},this.getSelectedItems=function(){return _.filter(o.items,["selected",!0])},this.validateAdopter=function(e){switch(e.adopter.toUpperCase()){case"JSON":this.initializeJsonAdopter(e);break;case"SERVICE":this.initializeServiceAdopter(e);break;default:console.error("Invalid Adopter, Current supported adopters are only JSON and SERVICE.")}},this.initializeJsonAdopter=function(e){this.renderItems(e.json)},this.initializeServiceAdopter=function(e){var o=this,n=i.get(e.service),r={id:t.rootOrgId};n.getItems(r).then(function(e){e&&"OK"===e.responseCode?o.renderItems(e.result.response):console.error("Locations are not found")}).catch(function(e){console.error("Unable to fetch the locations",e)})}}],templateUrl:"views/components/geo.html"});
"use strict";angular.module("playerApp").controller("announcementInboxListController",["$rootScope","$scope","$timeout","$state","$stateParams","$q","toasterService","announcementAdapter","PaginationService",function(n,e,t,o,a,i,r,u,c){var s=this;s.init=function(n){s.pageLimit=10,s.showLoader=!0,s.showDataDiv=!1;var e=parseInt(a.page)||1;s.renderAnnouncementList(n,e)},s.renderAnnouncementList=function(n,e){s.limit=n||s.pageLimit,u.getInboxAnnouncementList(s.limit,e).then(function(n){n.result.announcements.length>0&&(s.totalCount=n.result.count,s.showDataDiv=!0,s.showLoader=!1,s.result=n.result,s.listData=n.result.announcements,s.pageNumber=e,s.pager=c.GetPager(n.result.count,e,s.pageLimit),_.forEach(s.listData,function(n){!1===n.received&&u.receivedAnnouncement(n.id).then(function(n){})})),s.showLoader=!1},function(n){n&&(s.showLoader=!1)})},s.getFileExtension=function(n){return u.getFileExtension(n)},s.showAnnouncementDetails=function(n,e){!1===n.read&&(u.readAnnouncement(n.id),angular.element(document.querySelector("#annInboxDiv-"+e)).removeClass("announcementCardLeftBorder")),o.go("announcementDetails",{announcementId:n.id,announcementName:n.title,pageId:"announcement_inbox_list"})},s.setPage=function(n){n<1||n>s.pager.totalPages||o.go("announcementInbox",{page:n})}}]);
"use strict";angular.module("playerApp").controller("announcementOutboxListController",["$rootScope","$scope","$timeout","$state","$stateParams","toasterService","announcementAdapter","PaginationService","telemetryService",function(e,n,t,o,a,u,c,s,r){var i=this;i.init=function(){i.pager={},i.pageLimit=25,i.showLoader=!0,i.showDataDiv=!1;var e=parseInt(a.page)||1;i.renderAnnouncementList(e)},i.renderAnnouncementList=function(e){c.getOutBoxAnnouncementList(i.pageLimit,e).then(function(n){i.showLoader=!1,i.totalCount=n.result.count,i.result=n.result,i.listData=n.result.announcements,i.pageNumber=e,i.pager=s.GetPager(n.result.count,e,i.pageLimit),i.listData.length>0&&(i.showDataDiv=!0)},function(e){e&&(i.showLoader=!1)})},i.setPage=function(e){e<1||e>i.pager.totalPages||o.go("announcementOutbox",{page:e})},i.showModal=function(e,n){i.announcementId=n,$("#"+e).modal("show")},i.closeModal=function(e){$("#"+e).modal("hide")},i.deleteAnnouncement=function(){c.deleteAnnouncement(i.announcementId).then(function(n){"cancelled"===n.result.status?(i.closeModal("announcementDeleteModal"),u.success(e.messages.smsg.moo41),_.forEach(i.listData,function(e,n){if(i.announcementId===e.id)return i.listData[n].status="cancelled",e})):(u.error(n.params.errmsg),i.closeModal("announcementDeleteModal"))},function(e){e&&i.closeModal("announcementDeleteModal")})},i.getResend=function(e,n){o.go("announcementResend",{announcementId:e,stepNumber:"1",telemetryAnnTitle:n})},i.showAnnouncementDetails=function(e,n){o.go("announcementDetails",{announcementId:e,announcementName:n.title,pageId:"announcement_outbox_view"})},i.gotToAnnouncementCreateState=function(){o.go("announcementCreate",{stepNumber:"1"})}}]);
"use strict";angular.module("playerApp").controller("announcementDetailsController",["$state","$stateParams","$rootScope","toasterService","announcementAdapter",function(n,e,o,t,a){var r=this;r.showLoader=!0,r.renderAnnouncement=function(){a.getAnnouncementById(e.announcementId).then(function(n){r.announcementDetails=n.result.announcement,r.showLoader=!1,n.result.userid===o.userId&&(r.announcementDetails.showActions=!0),$("#annDetailsModal").modal({closable:!1,onHide:function(){window.history.back()}}).modal("show")},function(n){n&&(r.showLoader=!1)})}}]);
"use strict";angular.module("playerApp").controller("composeAnnouncementCtrl",["$rootScope","$scope","$state","$stateParams","$timeout","config","toasterService","fileUpload","AnnouncementModel","announcementAdapter","telemetryService",function(e,n,t,o,a,i,c,l,r,s,u){var d=this;d.targetIds=[],d.disableBtn=!0,d.showUrlField=!1,d.errorFlag=!1,d.isMetaModified=!1,d.announcementType=[],d.repeatableWebLinks=[],d.hideAnncmntBtn=!1,d.uploadAttchement=!1,d.editAction=!1,d.isApprove=!1,d.hideSendBtn=!1,d.config={geo:{adopter:"SERVICE",service:"geoService"}},d.initializeModal=function(){a(function(){$("#announcementType").dropdown({onChange:function(e,n,t){d.enableRecepientBtn()}})},100),e.$on("selected:items",function(e,n){d.announcement.selTar=_.clone(n.geo)})},d.createAnnouncement=function(){$("#createAnnouncementModal").modal({closable:!1,onShow:function(){$(".ui.modal.transition.hidden").remove()},onHide:d.onHideCreateAnnModal}).modal("show")},d.confirmationModal=function(){a(function(){$("#announcementCancelModal").modal({allowMultiple:!0,onDeny:function(){return!0},onApprove:d.onApproveConfirmationModal}).modal("show")},10)},d.hideModel=function(e){$("#"+e).modal("hide"),$("#"+e).modal("hide others"),$("#"+e).modal("hide all"),$("#"+e).modal("hide dimmer")},d.addNewLink=function(){var e=d.repeatableWebLinks.length+1;d.repeatableWebLinks.push({id:"choice"+e}),d.showUrlField=!0},d.removeLink=function(e){d.repeatableWebLinks.splice(e,1),d.announcement.links&&d.announcement.links.splice(e,1),d.showUrlField=!!d.repeatableWebLinks.length,d.enableRecepientBtn()},d.removeRecipients=function(n){_.remove(d.announcement.selTar,function(t){if(t.location===n.location)return n.selected=!1,c.info(n.location+" "+e.messages.imsg.m0020),t.location}),d.confirmRecipients()},d.confirmRecipients=function(){return e.$emit("get:selected:items"),!d.announcement.selTar||0!==d.announcement.selTar.length||(c.error(e.messages.emsg.m0006),!1)},d.enableRecepientBtn=function(e){if(void 0===e&&(e=!0),null!==d.announcement){var n=[];d.announcement.links&&angular.forEach(d.announcement.links,function(e,t){e.trim().length&&n.push(e)});var t=angular.element(document.querySelector("#selectRecipientBtn"));d.announcement.title&&d.announcement.from&&d.announcement.type&&(d.uploadAttchement||d.announcement.description||n.length)?(d.disableBtn=!1,t.removeClass("disabled")):(d.disableBtn=!0,t.addClass("disabled"))}d.isMetaModified=!1!==e},d.refreshFormValues=function(){d.disableBtn=!0,d.stepNumber=1,$("#announcementType").dropdown("restore defaults"),$("#createAnnouncementModal").modal("refresh"),d.isMetaModified=!1,d.repeatableWebLinks.length=0,d.showUrlField=!1,$(".qq-upload-list").children("li").remove()},d.saveAnnouncement=function(){d.editAction&&o.announcementId,d.isMetaModifiedSteps=!0,d.announcement.target.geo.ids=_.map(d.announcement.selTar,"id"),d.hideSendBtn=!0,d.endTelemetry(),s.createAnnouncement(d.announcement,d.editAction).then(function(n){d.hideSendBtn=!1,d.hideModel("createAnnouncementModal"),d.editAction?$("#announcementResendModal").modal({closable:!1}).modal("show"):$("#announcementSuccessModal").modal({closable:!1}).modal("show"),e.userIdHashTag=null,t.go("announcementOutbox")},function(e){d.isMetaModified=!0,d.hideSendBtn=!1,d.showError(e.data)})},d.showError=function(e){d.errorFlag=!0,"CLIENT_ERROR"===e.responseCode&&angular.isArray(e.params.errmsg)?angular.forEach(e.params.errmsg,function(e,n){c.error(e.description)}):c.error(e.params.errmsg)},d.getReadableFileSize=function(e){var n=["Bytes","KB","MB"];if(e){var t=parseInt(Math.floor(Math.log(e)/Math.log(1024)));d.convertedFileSize=Math.round(e/Math.pow(1024,t),2)+" "+n[t]}else d.convertedFileSize="0 Byte";return d.convertedFileSize},window.removeCreateAnnAttachment=function(e,n,t){$(e).closest("li").remove(),d.onUploadCancel(n,t)},d.initializeFileUploader=function(n){var t={fileSizeLimit:i.AnncmntMaxFileSizeToUpload,allowedExtensions:i.AnncmntAllowedFileExtension,fileSizeErrorText:e.messages.emsg.m0007,containerName:"attachments/announcement",uploadSuccess:d.onUploadComplete,onCancel:d.onUploadCancel};l.createFineUploadInstance(t,d.prepopulateFilesCallback)},d.prepopulateFilesCallback=function(e){$(".qq-uploader").eq(1).parent().remove();var n=[];null!==d.announcement&&(n=d.announcement.attachments);var t=angular.copy(n);$("#old-file-list").length<=0&&($(".qq-upload-list").parent().prepend('<ul id="old-file-list" class=" qq-upload-list"></ul>'),_.forEach(t,function(e,n){var t="'"+e.name+"'";$("#old-file-list").append('<li class="qq-upload-retryable w3-container w3-border w3-round-xlarge qq-upload-success"> <i id="removeFile" onclick="removeCreateAnnAttachment (this,'+n+", "+t+')" class="remove icon cursor-pointer" style="float:right;"></i><span class="qq-upload-file-selector qq-upload-file" style="width: 200px;">'+e.name+"</span></li>"),d.uploadAttchement=!0})),d.enableRecepientBtn()},d.onUploadComplete=function(e,n,t){t.size=d.getReadableFileSize(t.size),d.announcement.attachments.push(t),d.uploadAttchement=!0,d.enableRecepientBtn()},d.onUploadCancel=function(e,n){0===d.announcement.attachments.splice(e,1).length&&angular.forEach(d.announcement.attachments,function(e,t){e.name===n&&d.announcement.attachments.splice(t,1)}),0===d.announcement.attachments.length&&(d.uploadAttchement=!1),d.enableRecepientBtn(),$("#hide-section-with-button").css("style.display","block")},d.init=function(){if(d.stepNumber=parseInt(o.stepNumber)||1,d.announcement=o.announcement,d.isMetaModifiedSteps=o.isMetaModifiedSteps,d.editAction=o.isResend,1===d.stepNumber&&d.initializeModal(),d.createAnnouncement(),1===d.stepNumber&&null===d.announcement&&(d.editAction?(d.getResend(o.announcementId),u.startTelemetryData("announcement",o.announcementId,"announcement","1.0","workflow","announcement-resend","edit")):(d.announcement=new r.Announcement({}),d.announcement.hideDate=!0,u.startTelemetryData("announcement","","announcement","1.0","workflow","announcement-create","edit"))),1===d.stepNumber&&(d.getDefinitions(e.rootOrgId),null!==d.announcement&&void 0!==d.announcement.links&&angular.forEach(d.announcement.links,function(e,n){d.addNewLink()})),2===d.stepNumber&&null!==d.announcement&&void 0!==d.announcement.target){var n=[];d.editAction?n=d.announcement.target.geo.ids:(d.announcement.target.geo.ids=_.map(d.announcement.selTar,"id"),n=_.map(d.announcement.selTar,"id")),a(function(){e.$broadcast("component:update",n)},100)}},d.goToNextStep=function(n,o){if(1!==d.stepNumber){if(!d.confirmRecipients())return!1;_.isEmpty(d.announcement.sourceId)&&(d.announcement.sourceId=e.rootOrgId)}d.isMetaModifiedSteps=!0,t.go(t.current.name,{stepNumber:++d.stepNumber,announcement:d.announcement,isMetaModifiedSteps:!1,telemetryPageId:n,telemetryPageType:o},{reload:!0})},d.goToBackStep=function(){d.isMetaModifiedSteps=!0,t.go(t.current.name,{stepNumber:--d.stepNumber,announcement:d.announcement,isMetaModifiedSteps:!1},{reload:!0})},d.getResend=function(e){s.getResend(e).then(function(e){d.announcement=new r.Announcement(e.result.announcement),d.announcement.hideDate=!0,d.initializeModal(),d.enableRecepientBtn(),d.initializeFileUploader(!0),null!==d.announcement&&void 0!==d.announcement.links&&angular.forEach(d.announcement.links,function(e,n){d.addNewLink()}),d.uploadAttchement=d.announcement.attachments.length>0})},d.getDefinitions=function(n){s.getDefinitions(n).then(function(e){e.result.announcementTypes&&(d.announcementType=_.map(e.result.announcementTypes,"name")),""!==d.announcement.type&&$("#announcementType").dropdown("set text",d.announcement.type)},function(n){n&&(d.hideAnncmntBtn=!0,c.error(e.messages.fmsg.m0069))})},d.onHideCreateAnnModal=function(){if(null===d.announcement&&!0!==d.isMetaModified?d.isMetaModified=!1:!0===d.isApprove?d.isMetaModified=!1:d.isMetaModified=!0,!0===d.isMetaModified&&!0!==d.isMetaModifiedSteps)return d.confirmationModal(),!1;!1===d.isMetaModified&&1===d.stepNumber&&(d.refreshFormValues(),t.go("announcementOutbox"))},d.onApproveConfirmationModal=function(){return d.isApprove=!0,d.refreshFormValues(),d.endTelemetry(),d.hideModel("announcementCancelModal"),t.go("announcementOutbox"),!0},d.endTelemetry=function(){d.editAction?u.endTelemetryData("announcement",o.announcementId,"announcement","1.0","workflow","announcement-resend","edit"):u.endTelemetryData("announcement","","announcement","1.0","workflow","announcement-create","edit")}}]);
"use strict";angular.module("playerApp").directive("announcementDetailsDirective",function(){return{templateUrl:"views/announcement/announcementDetailsTemplate.html",scope:{announcementDetails:"="}}});
"use strict";angular.module("playerApp").controller("profileVisibilityController",["$timeout","$rootScope","$scope","toasterService","userService","telemetryService",function(e,i,l,r,t,o){var s=this;s.options=[{text:"Hide this from everyone",value:"private"},{text:"Show this to all",value:"public"}],s.loader={},s.privateProfileFields=[],s.publicProfileFields=[],l.visibility=i.privateProfileFields.indexOf(l.field)>=0?"private":"public",s.initDropdown=function(){e(function(){$(".profile-privacy-drpdwn").dropdown()},100)},s.setProfileFieldLbl=function(e){if(l.visibility!==e){var t={field:l.field,visibility:e,update:l.update};s.updateProfVisFields(t,function(o,d){o?r.error(i.messages.fmsg.m0048):(l.visibility=e,r.success(i.messages.smsg.m0040)),s.loader[t.field]=!1,s.privateProfileFields=[],s.publicProfileFields=[]})}},s.updateProfVisFields=function(e,l){s.loader[e.field]=!0;var r={request:{userId:i.userId}};"private"===e.visibility?(-1===s.privateProfileFields.indexOf(e.field)&&s.privateProfileFields.push(e.field),_.remove(s.publicProfileFields,function(i){return i===e.field})):"public"===e.visibility&&(-1===s.publicProfileFields.indexOf(e.field)&&s.publicProfileFields.push(e.field),_.remove(s.privateProfileFields,function(i){return i===e.field})),s.privateProfileFields.length>0&&(r.request.private=s.privateProfileFields),s.publicProfileFields.length>0&&(r.request.public=s.publicProfileFields),t.updateProfileFieldVisibility(r).then(function(e){e&&"OK"===e.responseCode?l(null,e):l(e,null)})},s.generateInteractEvent=function(e,r){var t=o.ProfileLockConfig[l.field];o.interactTelemetryData("profile",i.userId,l.field,r,t,e)}}]);
"use strict";angular.module("playerApp").directive("profileVisibility",function(){return{templateUrl:"views/common/profilePrivateField.html",restrict:"E",scope:{field:"=",update:"=",top:"="},controller:"profileVisibilityController as profVisCtrl"}});
"use strict";angular.module("playerApp").factory("fileUpload",["$filter","config","$timeout","toasterService","uuid4",function(e,t,i,n,o){var a={},l={},s={request:{endpoint:t.URL.BASE_PREFIX+t.URL.LEARNER_PREFIX+t.URL.CONTENT.UPLOAD_MEDIA,inputName:"file",customHeaders:{Accept:"application/json","X-Consumer-ID":"X-Consumer-ID","X-Device-ID":"X-Device-ID","X-msgid":o.generate(),ts:e("date")(new Date,"yyyy-MM-dd HH:mm:ss:sssZ"),"X-Source":"web","X-Org-code":"AP"}},failedUploadTextDisplay:{mode:"default",responseProperty:"error"},fileValidation:{itemLimit:10,sizeLimit:t.AnncmntMaxFileSizeToUpload,allowedExtensions:t.AnncmntAllowedFileExtension,stopOnFirstInvalidFile:!1}},r=function(e,t,i,n){if("OK"===i.responseCode){var o={name:t,mimetype:l.type,size:l.size,link:i.result.url};a.uploadSuccess(e,t,o)}},d=function(e,t){a.onCancel(e,t)},m=function(e){n.error(e)};return{createFineUploadInstance:function(e,t){a=_.merge({},e,s),i(function(){new qq.FineUploader({element:document.getElementById("fine-uploader-manual-trigger"),template:"qq-template-manual-trigger",autoUpload:!0,paramsInBody:!0,debug:!1,request:a.request,validation:a.fileValidation,messages:{sizeError:"{file} "+a.fileSizeErrorText+" "+a.fileSizeLimit/1024e3+" MB.",tooManyItemsError:"Too many items ({netItems}) would be uploaded. Item limit is {itemLimit}."},failedUploadTextDisplay:a.failedUploadTextDisplay,showMessage:m,text:{fileInputTitle:"UPLOAD ATTACHMENT"},callbacks:{onComplete:r,onSubmitted:function(e,t){this.setParams({filename:t,container:a.containerName}),l={type:this.getFile(e).type,size:this.getSize(e)}},onCancel:d}});t(!0),window.cancelUploadFile=function(){document.getElementById("hide-section-with-button").style.display="block"}},800)},onFileUploadSuccess:r,onFileUploadCancel:d,showErrorMessage:m}}]);
"use strict";angular.module("playerApp").factory("QueryService",["courseConsumptionDataSource","courseProgressDataSource","orgCreationDataSource","orgConsumptionDataSource","downloadReportDataSource",function(e,r,t,a,o){function n(n){switch(n.eid){case"courseConsumption":this.clientName=e;break;case"courseProgress":this.clientName=r;break;case"orgCreation":this.clientName=t;break;case"orgConsumption":this.clientName=a;break;case"downloadReport":this.clientName=o;break;default:this.clientName={error:"Invalid argument. Data source not found"}}return this.clientName}return{CreateNewInstance:function(e){return new n(e)}}}]);
"use strict";angular.module("playerApp").factory("Visualizer",["LineChart",function(t){function r(t){this.chartType=t.type,this.chartObj=this.getChartInstance()}return r.prototype.render=function(t){return this.chartObj.render(t)},r.prototype.getChartInstance=function(){var r=null;switch(this.chartType){case"line":r=new t}return r},r}]);
"use strict";angular.module("playerApp").factory("LineChart",[function(){function e(){}function r(e){for(var r=[],a=0;a<e;a++){var o=n();r.push({backgroundColor:o,borderColor:o,fill:!1})}return r}function n(){for(var e="#",r=0;r<6;r++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function a(e){return{legend:{display:!0},scales:{xAxes:[{gridLines:{display:!1}}],yAxes:[{scaleLabel:{display:!0,labelString:e},ticks:{beginAtZero:!0}}]}}}function o(e){var r=[],n=[];return _.forEach(e.buckets,function(e,a){r.push(e.value),n.push(e.key_name)}),{labels:n,values:r}}function t(e){if(e){var n=[],t={};return _.forEach(e.bucketData,function(n,u){var i={},s=e.name;""===e.series?(i.legend=[n.name],s=void 0!==n.time_unit?n.name+" ("+n.time_unit+")":n.name):i.legend=e.series;var l=angular.copy(o(n));i.yaxes=[l.values],i.xaxes=l.labels,i.options=a(s),t[n.group_id]?Array.prototype.push.apply(t[n.group_id].yaxes,i.yaxes):t[n.group_id]=i,i.colors=r(t[n.group_id].legend.length)}),_.forOwn(t,function(e,r){n.push([e.legend,e.xaxes,e.yaxes,e.colors,e.options,r])}),n}}return e.prototype.render=function(e){return t(e)},e}]);
"use strict";angular.module("playerApp").service("courseConsumptionDataSource",["$rootScope","$q","httpAdapter","toasterService","dataSourceUtils",function(e,t,r,s,o){var a=this;this.getData=function(c){var n,u,i;return n=o.constructApiUrl(c,"COURSE_CONSUMPTION"),i=o.getDefaultHeader(),u=t.defer(),r.httpCall(n,"","GET",i).then(function(t){t&&"OK"===t.responseCode?u.resolve(a.parseResponse(t.result)):(s.error(e.messages.fmsg.m0075),u.reject(t))}).catch(function(t){s.error(e.messages.emsg.m0005),u.reject(t)}),u.promise},a.parseResponse=function(e){return a.blockData=[],angular.forEach(e.snapshot,function(e,t){"course.consumption.users_completed"!==t&&o.secondsToMin(e),a.blockData.push(e)}),{bucketData:e.series,numericData:a.blockData,series:""}}}]);
"use strict";angular.module("playerApp").service("courseProgressDataSource",["$q","$rootScope","httpAdapter","toasterService","dataSourceUtils",function(e,r,t,s,a){var o=this;this.getData=function(c){var n,u,p;return n=a.constructApiUrl(c,"COURSE_PROGRESS"),u=e.defer(),p=a.getDefaultHeader(),t.httpCall(n,"","GET",p).then(function(e){e&&"OK"===e.responseCode?u.resolve(o.parseResponse(e.result)):(s.error(r.messages.fmsg.m0075),u.reject(e))}).catch(function(e){s.error(r.messages.emsg.m0005),u.reject(e)}),u.promise},o.parseResponse=function(e){return o.tableData=[],angular.forEach(e.series,function(e,r){"course.progress.course_progress_per_user.count"===r&&angular.forEach(e,function(e,r){"buckets"===r&&(o.tableData=e)})}),o.tableData}}]);
"use strict";angular.module("playerApp").service("orgCreationDataSource",["$q","$rootScope","httpAdapter","toasterService","dataSourceUtils",function(e,t,r,a,o){var n=this,s={"org.creation.content[@status=published].count":" LIVE","org.creation.content[@status=draft].count":" Created","org.creation.content[@status=review].count":" IN REVIEW"};this.getData=function(s){var c,u,i,p;return c=o.constructApiUrl(s,"ORG_CREATION"),p=o.getDefaultHeader(),u=e.defer(),i=r.httpCall(c,"","GET",p),i.then(function(e){e&&"OK"===e.responseCode?u.resolve(n.parseResponse(e.result)):(a.error(t.messages.fmsg.m0075),u.reject(e))},function(e){a.error(t.messages.emsg.m0005),u.reject(e)}),u.promise},n.parseResponse=function(e){return n.blockData=[],n.graphSeries=[],n.extractSnapshotData(e.snapshot),{bucketData:e.series,name:"5w"===e.period?"Content created per week":"Content created per day",numericData:n.blockData,series:n.graphSeries}},n.extractSnapshotData=function(e){angular.forEach(e,function(e,t){switch(t){case"org.creation.authors.count":case"org.creation.reviewers.count":case"org.creation.content.count":n.blockData.push(e);break;default:n.graphSeries.push(e.value+s[t])}})}}]);
"use strict";angular.module("playerApp").service("orgConsumptionDataSource",["$rootScope","$q","httpAdapter","toasterService","dataSourceUtils",function(e,t,a,r,s){var o=this;this.getData=function(n){var c,u,i,p;return c=s.constructApiUrl(n,"ORG_CONSUMPTION"),u=t.defer(),i=s.getDefaultHeader(),p=a.httpCall(c,"","GET",i),p.then(function(t){t&&"OK"===t.responseCode?u.resolve(o.parseResponse(t.result)):(r.error(e.messages.fmsg.m0075),u.reject(t))},function(t){r.error(e.messages.emsg.m0005),u.reject(t)}),u.promise},o.parseResponse=function(e){return{bucketData:e.series,numericData:o.extractSnapshotData(e.snapshot),series:""}},o.extractSnapshotData=function(e){return o.blockData=[],angular.forEach(e,function(e,t){switch(t){case"org.consumption.content.time_spent.sum":case"org.consumption.content.time_spent.average":o.blockData.push(s.secondsToMin(e));break;default:o.blockData.push(e)}}),o.blockData}}]);
"use strict";angular.module("playerApp").service("dataSourceUtils",["config",function(e){var R=this,i={ORG_CREATION:e.URL.DASHBOARD.ORG_CREATION,ORG_CONSUMPTION:e.URL.DASHBOARD.ORG_CONSUMPTION,COURSE_PROGRESS:e.URL.DASHBOARD.COURSE_PROGRESS,COURSE_CONSUMPTION:e.URL.DASHBOARD.COURSE_CONSUMPTION};R.secondsToMin=function(e){var R="";if(e.value<60)e.value+=" second(s)";else if(e.value>=60&&e.value<=3600)R=e.value/60,e.value=R.toFixed(2)+" min(s)";else{if(!(e.value>=3600))return e;R=e.value/3600,e.value=R.toFixed(2)+" hour(s)"}return e},R.constructDownloadReportUrl=function(R,r){var t=e.URL.BASE_PREFIX+e.URL.LEARNER_PREFIX+i[r]+"/"+R.identifier;return t+="/export?period="+R.timePeriod+"&format=csv"},R.constructApiUrl=function(R,r){return e.URL.BASE_PREFIX+e.URL.LEARNER_PREFIX+i[r]+"/"+R.identifier+"?period="+R.timePeriod},R.getDefaultHeader=function(){return{"Content-Type":"application/json",cid:"sunbird"}}}]);
"use strict";angular.module("playerApp").service("downloadReportDataSource",["$q","$rootScope","httpAdapter","toasterService","dataSourceUtils",function(e,r,t,o,s){this.download=function(a,n){var u,c,d,l;return u=s.constructDownloadReportUrl(a,n),c=e.defer(),l=s.getDefaultHeader(),d=t.httpCall(u,"","GET",l),d.then(function(e){e&&"OK"===e.responseCode?c.resolve({requestId:e.result.requestId}):(o.error(r.messages.fmsg.m0075),c.reject(e))},function(e){o.error(r.messages.emsg.m0005),c.reject(e)}),c.promise}}]);
"use strict";angular.module("playerApp").service("telemetryService",["$rootScope","config","$window",function(t,e,a){this.context=[],this.configData={message:"api call default message"},this.visitData=[],this.config={},this.getConfigData=function(t){return this.configData[t]?this.getConfigData[t]:this.config[t]},this.config={pdata:{id:org.sunbird.portal.appid||"sunbird.portal",ver:"1.5.1",pid:"sunbird-portal"},env:this.getConfigData("env")||"Home",channel:org.sunbird.portal.channel||"sunbird",did:void 0,authtoken:void 0,uid:t.userId,sid:t.sessionId,batchsize:e.TELEMETRY.MAX_BATCH_SIZE||10,host:"",endpoint:e.TELEMETRY.SYNC,apislug:e.URL.BASE_PREFIX+e.URL.CONTENT_PREFIX,dispatcher:void 0,runningEnv:"client",tags:[]},this.ProfileLockConfig={phone:"phn-number-lock",email:"email-lock",gender:"gender-lock",dob:"birthdate-lock",location:"current-location-lock",grade:"grade-lock",language:"known-language-lock",subject:"subject-experties-lock",webPages:"social-media-link-lock",address:"address-lock",profileSummary:"profile-summary-lock",education:"education-lock",jobProfile:"job-profile-lock",skills:"skills-lock"},this.ProfileSectionConfig={profileSummary:"profile-update-summary",editSummary:"profile-edit-summary",closeSummary:"profile-close-summary",addExperience:"profile-update-experience",editExperience:"profile-edit-experience",closeExperience:"profile-close-experience",experience:"add-experience",deleteExperience:"profile-delete-experience",address:"add-address",editAddress:"profile-edit-address",addAddress:"profile-add-address",deleteAddress:"profile-delete-address",closeAddress:"profile-close-address",addEducation:"profile-update-education",editEducation:"profile-edit-education",education:"add-education",deleteEducation:"profile-delete-education",closeEducation:"profile-close-education",skills:"add-skills",removeSkills:"profile-delete-skills",cancelSkills:"profile-cancel-skills",addSkills:"profile-add-skills",basicInfo:"profile-additional-info",editBasicInfo:"edit-additional-info",closeBasicInfo:"close-additional-info",phone:"add-phone-number",gender:"add-gender",dob:"add-dateof-birth",grade:"add-grade",language:"add-known-language",subject:"add-subject-experties",webPages:"add-social-media-link",location:"add-current-location"},this.setConfig=function(){this.config.pdata.id=org.sunbird.portal.appid,this.config.channel=org.sunbird.portal.channel,this.config.uid=t.userId,this.config.sid=t.sessionId},this.init=function(){this.setConfig(),console.log("Initialize telemetry"),IITBtelemetry.initialize(this.config)},this.start=function(t){t.context&&this.context.push(t.context),IITBtelemetry.start(this.config,t.contentId,t.contentVer,t.edata,{context:t.context,object:t.object,tags:_.compact(t.tags)||_.concat([],org.sunbird.portal.channel)})},this.end=function(t){console.log("Portal end event");var e=this.context.pop();IITBtelemetry.end(t.edata,{context:e,tags:_.compact(t.tags)||_.concat([],org.sunbird.portal.channel)}),IITBtelemetry.resetContext(e)},this.impression=function(t){IITBtelemetry.impression(t.edata,{context:t.context,object:t.object,tags:_.compact(t.tags)||_.concat([],org.sunbird.portal.channel)})},this.interact=function(t){IITBtelemetry.interact(t.edata,{context:t.context,object:t.object,tags:_.compact(t.tags)||_.concat([],org.sunbird.portal.channel)})},this.log=function(t){IITBtelemetry.log(t.edata,{context:t.context,object:t.object,tags:_.compact(t.tags)||_.concat([],org.sunbird.portal.channel)})},this.error=function(t){IITBtelemetry.error(t.edata,{context:t.context,object:t.object,tags:_.compact(t.tags)||_.concat([],org.sunbird.portal.channel)})},this.share=function(t){IITBtelemetry.share(t.edata,{context:t.context,object:t.object,tags:_.compact(t.tags)||_.concat([],org.sunbird.portal.channel)})},this.getUserSpec=function(){return{agent:a.navigator.appCodeName,ver:a.navigator.appVersion.split(" (")[0],system:"",platform:a.navigator.platform,raw:a.navigator.userAgent}},this.startEventData=function(t,e,a,i){var n={type:t,mode:a,duration:i,pageid:e,uaspec:this.getUserSpec()};return JSON.parse(JSON.stringify(n))},this.endEventData=function(t,e,a,i,n){var o={type:t,mode:a,duration:i,pageid:e,summary:n};return JSON.parse(JSON.stringify(o))},this.impressionEventData=function(t,e,a,i,n){var o={type:t,subtype:e,pageid:a,uri:i};return n&&(o.visits=n),JSON.parse(JSON.stringify(o))},this.interactEventData=function(t,e,a,i,n){var o={type:t,subtype:e,id:a,pageid:i,target:n};return JSON.parse(JSON.stringify(o))},this.logEventData=function(t,e,a,i,n){var o={type:t,level:e,message:a,pageid:i,params:n};return JSON.parse(JSON.stringify(o))},this.errorEventData=function(t,e,a,i){var n={err:t,errtype:e,stacktrace:a,pageid:i};return JSON.parse(JSON.stringify(n))},this.getItemData=function(t,e,a){var i={id:t,type:e,ver:a};return JSON.parse(JSON.stringify(i))},this.shareEventData=function(t,e,a){var i={type:t,items:e,dir:a};return JSON.parse(JSON.stringify(i))},this.getContextData=function(t){t=t||{};var e={};return e.channel=t.channel||this.config.channel,e.pdata=this.config.pdata,e.env=t.env||this.config.env,e.sid=this.config.sid,e.cdata=t.cdata,e.rollup=t.rollup,JSON.parse(JSON.stringify(e))},this.getObjectData=function(t){t=t||{};var e={};return e.id=t.id,e.type=t.type,e.ver=t.ver,t.rollup&&Object.keys(t.rollup).length>0&&(e.rollup=t.rollup),t.section&&(e.section=t.section),JSON.parse(JSON.stringify(e))},this.getRollUpData=function(t){var e={},a=1;return t=t||[],t.constructor===Array&&t.forEach(function(t){e["l"+a]=t,a+=1}),e},this.setConfigData=function(t,e){this.configData[t]=e},this.interactTelemetryData=function(e,a,i,n,o,r,s){var c={env:e,rollup:this.getRollUpData(t.organisationIds)},l={id:a,type:i,ver:n,rollup:this.getRollUpData(s)},d={edata:this.interactEventData("CLICK","",o,r),context:this.getContextData(c),object:this.getObjectData(l),tags:_.concat([],org.sunbird.portal.channel)};this.interact(d)},this.impressionTelemetryData=function(e,a,i,n,o,r,s,c,l){var d={env:e,rollup:this.getRollUpData(t.organisationIds)},p={};a&&a.length>0&&(p={id:a,type:i,ver:n,rollup:this.getRollUpData(c)});var g={edata:this.impressionEventData("view",o,r,s,l),context:this.getContextData(d),object:this.getObjectData(p),tags:_.concat([],org.sunbird.portal.channel)};this.impression(g)},this.startTelemetryData=function(e,a,i,n,o,r,s){var c={env:e,rollup:this.getRollUpData(t.organisationIds)},l={id:a,type:i,ver:n},d={edata:this.startEventData(o,r,s),contentId:a,contentVer:t.version,context:this.getContextData(c),object:this.getObjectData(l),tags:_.concat([],org.sunbird.portal.channel)};this.start(d)},this.endTelemetryData=function(e,a,i,n,o,r,s){var c={env:e,rollup:this.getRollUpData(t.organisationIds)},l={id:a,type:i,ver:n},d={edata:this.endEventData(o,r,s),contentId:a,contentVer:t.version,context:this.getContextData(c),object:this.getObjectData(l),tags:_.concat([],org.sunbird.portal.channel)};this.end(d)},this.shareTelemetryData=function(e,a,i,n){var o={env:e,rollup:this.getRollUpData(t.organisationIds)},r={id:a,type:i,ver:n},s=[this.getItemData(a,i,n)],c={edata:this.shareEventData("Link",s,"Out"),context:this.getContextData(o),object:this.getObjectData(r),tags:_.concat([],org.sunbird.portal.channel)};this.share(c)},this.errorTelemetryData=function(e,a,i,n,o,r,s){var c={env:e,rollup:this.getRollUpData(t.organisationIds)},l={id:t.userId,type:a,ver:i},d={edata:this.errorEventData(n,o,r,s),context:this.getContextData(c),object:this.getObjectData(l),tags:_.concat([],org.sunbird.portal.channel)};this.error(d)},this.setVisitData=function(t){this.visitData=t},this.getVisitData=function(){return this.visitData}}]);
"use strict";angular.module("playerApp").controller("DataDrivenFiltersController",["$scope","config","$rootScope","$timeout","$state","$stateParams","searchService","toasterService","$location","sessionService","adminService","permissionsService","PaginationService","telemetryService",function(e,r,s,a,c,t,o,n,h,i,l,u,d,g){function y(e,r,s,a){var c={};return c.showError=!0,c.isClose=e,c.message=r,c.messageType=s,a&&(c.messageText=a),c}var f=this;e.search={},f.search={},f.search.searchKeyword="",f.search.filters={},f.search.contentTypes=r.FILTER.RESOURCES.contentTypes,f.search.sortingOptions=r.sortingOptions,f.search.sortBy={createdOn:"asc"},f.search.sortIcon=!0,f.search.selectedLanguage=[],f.search.selectedContentType=[],f.search.sortByOption={},f.inviewLogs=[],f.dropdownId=[],f.dropdownValue=[],f.search.showFilters=!1,f.applyFilterOnly=!1;var p=s.$on("DynsetSearchKey",function(e,r){f.search.selectedSearchKey=r.key;var s={type:"content",action:"search"};switch(f.search.selectedSearchKey){case"Courses":s.subType="course",f.getChannel(s);break;case"Library":s.subType="library",f.getChannel(s)}}),m=s.$on("DynSearchKey",function(e,r){switch(f.searchKey=r.key,f.search.selectedSearchKey=f.searchKey,f.req={type:"content",action:"search"},f.search.selectedSearchKey){case"Courses":f.req.subType="course",f.getChannel(f.req);break;case"Library":f.req.subType="library",f.getChannel(f.req)}}),S=s.$on("initSearch",function(r,s){!1===f.applyFilterOnly&&e.search.initSearch()});f.search.selectFilter=function(e,r,s){a(function(){var a=f.search[e].indexOf(r);-1===a?(f.search[e].push(r),$(s.target).addClass("active")):(f.search[e].splice(a,1),$(s.target).removeClass("active"))},0)},f.getChannel=function(e){o.getChannel().then(function(e){"OK"===e.responseCode&&(f.frameworkId=e.result.channel.defaultFramework,o.getFramework(f.frameworkId).then(function(e){if("OK"===e.responseCode){f.req.framework=f.frameworkId;var r=_.cloneDeep(e.result.framework.categories);o.getDataDrivenFormsConfig(f.req).then(function(e){"OK"===e.responseCode?(f.search.showFilters=!0,f.formFieldProperties=_.sortBy(e.result.form.data.fields,["index"]),_.forEach(f.formFieldProperties,function(e){f.search["selected"+e.code]=[]}),f.formFieldProperties.sort(function(e,r){return e.index-r.index}),_.forEach(r,function(e){_.forEach(f.formFieldProperties,function(r){return e.code===r.code&&(r.category=e.terms),r})})):f.search.showFilters=!1}).catch(function(e){console.log("error is ......",e)})}}).catch(function(e){console.log("error is ......",e)}))}).catch(function(e){console.log("error is ......",e)})},f.search.dynamicSelectedSearch=function(e){return f.search["selected"+e]},f.search.removeFilterSelection=function(e,r){if("selectedConcepts"===e)f.search[e]=_.filter(f.search[e],function(e){return e.identifier!==r}),f.search.broadCastConcepts();else{var s=f.search[e].indexOf(r);-1!==s&&f.search[e].splice(s,1)}},f.getRoleName=function(e){return _.find(f.search.userRoles,{role:e}).roleName},f.getOrgName=function(e){return _.find(f.search.orgTypes,{id:e}).name},f.expandFilters=function(){$("#filterIcon").parents(".active").length<=0&&$("#filterIcon").trigger("click")},e.search.initSearch=function(){"Search"===c.current.name&&(f.isSearchPage=!0);var r=t;f.search.selectedSearchKey=f.searchKey||r.type,f.search.searchKeyword=f.search.searchKeyword||r.query,f.search.filters=JSON.parse(atob(r.filters||btoa("{}"))),f.search.sortBy=JSON.parse(atob(r.sort||btoa("{}"))),f.search.selectedContentType=f.search.filters.contentType||[],_.forEach(f.formFieldProperties,function(e){f.search["selected"+e.code]=f.search.filters[e.code]||[]}),f.search.broadCastConcepts(),f.search.sortByOption=Object.keys(f.search.sortBy).length>0?Object.keys(f.search.sortBy)[0]:"",f.search.searchFromSuggestion=t.autoSuggestSearch,e.search.searchRequest()},e.search.searchRequest=function(r){if(clearTimeout(f.search.typingTimer),!r||13===r.charCode)if(e.search.autoSuggest=!1,s.search.searchKeyword&&""!==s.search.searchKeyword||!s.isLearnPage&&!s.isResourcesPage||r){if(f.isSearchPage)if(s.isSearchResultsPage&&s.search.searchKeyword===t.query&&s.search.selectedSearchKey===t.type)s.search.error={},s.search.loader=n.loader("",s.messages.stmsg.m0005),e.search.handleSearch();else{e.search.autoSuggest=!1;var a={type:s.search.selectedSearchKey,query:s.search.searchKeyword,filters:btoa(JSON.stringify(f.search.filters)),autoSuggestSearch:s.search.searchFromSuggestion||!1};"null"!==_.keys(f.search.sortBy)[0]&&(a.sort=btoa(JSON.stringify(f.search.sortBy))),s.searchTelemetryId="search-"+s.search.selectedSearchKey.toLowerCase(),s.searchTelemetryPageid=s.search.selectedSearchKey.toLowerCase()+"-search",s.inviewLogs=[],c.go("Search",a,{reload:!0})}}else s.$broadcast("initPageSearchFromDynamicPage",{FilterData:f.search.filters,sortByData:f.search.sortBy})},e.search.handleSearch=function(r){r=r||1;var a={query:s.search.searchKeyword,filters:f.search.filters,sort_by:f.search.sortBy,offset:(r-1)*s.search.pageLimit,limit:s.search.pageLimit};if(e.search.autoSuggest&&!1!==e.search.autoSuggest||(s.search.loader||(s.search.loader=n.loader("",s.messages.stmsg.m0005)),s.search.loader.showLoader=!0),a.filters.concepts&&a.filters.concepts.length>0&&(a.filters.concepts=_.map(s.search.selectedConcepts,"identifier")),"true"===s.search.searchFromSuggestion?(a.filters.name=a.query,a.query="",s.search.searchFromSuggestion="false"):delete a.filters.name,"Courses"===s.search.selectedSearchKey)e.search.searchFn=o.courseSearch(a),e.search.resultType="course";else if("Library"===s.search.selectedSearchKey){var c=JSON.parse(JSON.stringify(a));(!a.filters.contentType||_.isArray(a.filters.contentType)&&0===a.filters.contentType.length)&&(c.filters.contentType=["Collection","TextBook","LessonPlan","Resource","Story","Worksheet","Game"]),e.search.searchFn=o.contentSearch(c),e.search.resultType="content",a.filters.objectType=["Content"]}e.search.searchFn.then(function(a){if(null===a||"OK"!==a.responseCode)throw s.search.loader.showLoader=!1,s.search.error=y(!0,s.messages.fmsg.m0004,s.messages.emsg.m0002),e.search.autoSuggest=!0,clearTimeout(s.search.typingTimer),new Error("");s.search.autosuggest_data=[];var c={};c="Organisations"===s.search.selectedSearchKey||"Users"===s.search.selectedSearchKey?a.result.response:a.result,e.search.autoSuggest&&s.search.searchKeyword!==t.query?(s.search.autosuggest_data=c[e.search.resultType]||[],s.search.autosuggest_data.length>0&&$("#search-suggestions").addClass("visible").removeClass("hidden")):(s.search.searchResultKeyword=s.search.searchKeyword,$("#search-suggestions").addClass("hidden").removeClass("visible"),s.search.loader.showLoader=!1,0===c.count?s.search.error=y(!0,s.messages.stmsg.m0006,s.messages.stmsg.m0008,s.messages.stmsg.m0007):(s.search.error={},s.search.searchResult=c,s.search.pager=d.GetPager(c.count,r,s.search.pageLimit))),e.search.autoSuggest=!0,clearTimeout(s.search.typingTimer)}).catch(function(e){s.search.loader.showLoader=!1,s.search.error=y(!0,s.messages.fmsg.m0004,s.messages.emsg.m0002)})};var C=e.$on("selectedConcepts",function(e,r){f.search.selectedConcepts=r.selectedConcepts});f.search.broadCastConcepts=function(){s.$broadcast("selectedConceptsFromSearch",{selectedConcepts:f.search.selectedConcepts})},f.search.applyFilter=function(){f.applyFilterOnly=!0,_.forEach(f.formFieldProperties,function(e){"select"!==e.inputType&&"multiselect"!==e.inputType||f.search["selected"+e.code].length&&(f.search.filters[e.code]=f.search["selected"+e.code])}),f.search.filters.concepts=f.search.selectedConcepts,f.search.filters.contentType=f.search.selectedContentType,s.isSearchResultsPage=!1,e.search.searchRequest()},f.search.resetFilter=function(){_.forEach(f.formFieldProperties,function(e){f.search["selected"+e.code].length&&(f.search["selected"+e.code]=[])}),f.search.selectedConcepts=[],f.search.selectedContentType=[],f.search.broadCastConcepts(),f.search.filters={},s.isSearchResultsPage=!1,f.isSearchPage=!0,e.search.searchRequest()},f.search.applySorting=function(){var r=f.search.sortByOption;f.search.sortBy={},f.search.sortBy[r]=!0===f.search.sortIcon?"asc":"desc",e.search.searchRequest()},e.$on("$destroy",function(){C(),S(),m(),p()}),f.search.getSelectedContentTypeValue=function(e,r){var s=_.filter(e,function(e){return e.key===r});return s?s[0].value:""},f.lineInView=function(e,r,s,a){var c=_.filter(f.inviewLogs,function(e){return e.objid===s.identifier});!0===r&&0===c.length&&f.inviewLogs.push({objid:s.identifier,objtype:a,index:e}),g.setVisitData(f.inviewLogs)}}]);
"use strict";angular.module("playerApp").directive("contentBadge",function(){return{templateUrl:"views/badge/contentBadge.html",restrict:"E",scope:{contentid:"=",data:"="},link:function(t,e,n){},controller:"contentBadgeController as contentBadge"}});
"use strict";angular.module("playerApp").directive("profileBadge",function(){return{templateUrl:"views/badge/profileBadge.html",restrict:"E",scope:{isshowadd:"=",badgelist:"=",otheruserid:"=",isprofileinfo:"="},link:function(e,r,i){},controller:"profileBadgeController as profileBadge"}});
"use strict";angular.module("playerApp").controller("contentBadgeController",["$timeout","$state","$rootScope","$scope","workSpaceUtilsService","telemetryService","badgeService","permissionsService","$q","toasterService",function(e,s,t,d,o,a,n,i,r,g){var l=this;l.showBadgeAssingModel=!1,l.selectedBadgeList=d.data&&d.data.badgeAssertions||[],l.type="content",l.contentId=d.contentid,l.getAllBadges=function(){var e={request:{filters:{issuerList:[],rootOrgId:t.rootOrgId,type:l.type,roles:i.getCurrentUserRoles()}}};n.getAllBadgesList(e).then(function(e){e&&"OK"===e.responseCode?l.allBadgeList=_.differenceBy(e.result.badges,l.selectedBadgeList,"badgeId"):g.error(t.messages.fmsg.m0078)}).catch(function(){g.error(t.messages.fmsg.m0078)})},l.hideContentBadgeModal=function(){$("#badgeAssignModel").modal("hide"),$("#badgeAssignModel").modal("hide all"),$("#badgeAssignModel").modal("hide dimmer")},l.initializeModal=function(s){l.showBadgeAssingModel=!0,e(function(){$("#badgeAssignModel").modal({onHide:function(){l.showBadgeAssingModel=!1,l.selectedBadge={}},onShow:function(){l.selectedBadge=s}}).modal("show")},0)},l.assignBadge=function(e){var s={issuerId:e.issuerId,badgeId:e.badgeId,recipientId:l.contentId,recipientType:l.type};n.addBadges({request:s}).then(function(s){s&&"OK"===s.responseCode?(l.hideContentBadgeModal(),g.success(t.messages.smsg.moo42),l.selectedBadgeList.push(e),l.allBadgeList=l.allBadgeList.filter(function(s){return s.badgeId!==e.badgeId})):g.error(t.messages.fmsg.m0079)}).catch(function(){g.error(t.messages.fmsg.m0079)})}}]);
"use strict";angular.module("playerApp").service("badgeService",["restfulLearnerService","config","permissionsService","userService","$rootScope",function(e,r,t,n,s){this.addBadges=function(t){var n=r.URL.BADGE.ASSIGN;return e.post(n,t)},this.getAllBadgesList=function(t){var n=r.URL.BADGE.BADGE_CLASS_SEARCH;return e.post(n,t)},this.getDetailedBadgeAssertions=function(t,n){return new Promise(function(s,i){var o=r.URL.BADGE.BADGE_CLASS_SEARCH;e.post(o,t).then(function(e){var r=n;e&&"OK"===e.responseCode&&e.result&&e.result.badges&&angular.forEach(r,function(r){var t=_.find(e.result.badges,{badgeId:r.badgeId});t&&(r.description=t.description)}),s(r)}).catch(function(e){i(e)})})}}]);
"use strict";angular.module("playerApp").controller("DataDrivenFormController",["contentService","$timeout","$state","config","$rootScope","$scope","toasterService","searchService","configService","telemetryService",function(e,o,r,a,t,n,i,s,c,d){var u=this;u.categoryModelList={},u.formDropdown=c.getWorkspaceFormDropdown(),u.years=u.formDropdown.years,u.categoryList={},u.dropdownId=[],u.dropdownValue=[],u.selectedContent="",n.validation={},u.isSubmit=!1,u.mapMasterCategoryList=function(e,o){_.forEach(e,function(e,r){o?e.code===o&&(u.categoryList[e.code]=e.range):e.range&&(u.categoryList[e.code]=e.range)})},u.dispatchEvent=function(e,o){org.sunbird.portal.eventManager.dispatchEvent(e,o)},u.initDropdown=function(){},u.onConfigChange=function(e,o){u.isSubmit=!1,u.updateForm(o)},u.updateForm=function(e){e.field.range&&u.getAssociations(e.value,e.field.range,function(o){u.applyDependencyRules(e.field,o,!0)})},u.getAssociations=function(e,o,r){var a=[],t=[],n=[];_.isString(e)?a.push(e):a=e,_.filter(o,function(e){_.forEach(a,function(o,r){e.name===o&&n.push(e)})}),_.forEach(n,function(e,o){e.associations&&_.forEach(e.associations,function(e,o){t.push(e)})}),r&&r(t)},u.applyDependencyRules=function(e,o,r){var a,t;e.depends&&e.depends.length&&_.forEach(e.depends,function(e){r&&u.resetSelectedField(e),a=_.map(o,function(e){return _.pick(e,"name","category")}),t=_.chain(a).groupBy("category").map(function(e,o){return{name:e,category:o}}).value(),u.updateDropDownList(e,a),t.length?_.forEach(t,function(e,o){u.updateDropDownList(e.category,_.map(e.name,function(e){return _.pick(e,"name")}))}):u.updateDropDownList(e,[])})},u.updateDropDownList=function(e,o){o.length?u.categoryList[e]=_.unionBy(o,"name"):u.mapMasterCategoryList(u.formFieldProperties,e)},u.resetSelectedField=function(e){setTimeout(function(){$("#"+e).dropdown("restore defaults"),$("#"+e).dropdown("refresh")},0)},u.saveMetaData=function(e,o){if(u.isSubmit=!0,void 0!==e&&null!==e&&""!==e||(e={}),!n.metaForm.$valid&&u.updateErrorMessage(n.metaForm),n.metaForm.$valid)switch(r.current.name){case"CreateTextbook":t.$broadcast("CreateTextbook",{Data:e,framework:u.framework});break;case"CreateCourse":t.$broadcast("CreateCourse",{Data:e,framework:u.framework});break;case"CreateCollection":t.$broadcast("CreateCollection",{Data:e,framework:u.framework});break;case"CreateLesson":t.$broadcast("CreateLesson",{Data:e,framework:u.framework});break;case"CreateLessonPlan":t.$broadcast("CreateLessonPlan",{Data:e,framework:u.framework})}},u.updateErrorMessage=function(){n.metaForm.$valid||_.forEach(u.formFieldProperties,function(e,o){if(n.metaForm[e.code]&&n.metaForm[e.code].$invalid)switch(n.validation[e.code]={},_.keys(n.metaForm[e.code].$error)[0]){case"pattern":n.validation[e.code].errorMessage=e.validation.regex.message;break;case"required":n.validation[e.code].errorMessage="Plese Input a value";break;case"maxlength":n.validation[e.code].errorMessage=e.validation.max.message;break;default:n.validation[e.code].errorMessage="Invalid Input"}})},u.configureDropdowns=function(e,r){o(function(){$(".ui.dropdown").dropdown({useLabels:e,forceSelection:r,direction:"downward"}),u.loader.showLoader&&(u.loader.showLoader=!1)},1e3)},u.init=function(){u.loader=i.loader("",t.messages.stmsg.m0014),org.sunbird.portal.eventManager.addEventListener("editor:form:change",u.onConfigChange,u.formFieldProperties);var e={type:"content",action:"create"};switch(r.current.name){case"CreateTextbook":e.subType="textbook";break;case"CreateCourse":e.subType="course";break;case"CreateCollection":e.subType="collection";break;case"CreateLesson":e.subType="resource";break;case"CreateLessonPlan":e.subType="lessonplan"}s.getChannel().then(function(r){"OK"===r.responseCode&&(u.version=r.ver,u.framework=null,u.framework=r.result.channel.defaultFramework,s.getFramework(u.framework).then(function(r){if("OK"===r.responseCode){u.frameworkData=r.result.framework.categories;var a=_.cloneDeep(r.result.framework.categories);e.framework=u.framework,s.getDataDrivenFormsConfig(e).then(function(e){u.formFieldProperties=_.sortBy(e.result.form.data.fields,["index"]),_.forEach(a,function(e){_.forEach(u.formFieldProperties,function(o){return"year"===o.code&&(o.range=u.years),o.validation&&_.forEach(o.validation,function(e,r){"regex"===e.type&&(e.value=new RegExp(e.value)),o.validation[e.type]=e}),e.code===o.code&&e.terms&&(o.range=e.terms),o})});var r=["select","multiSelect"];o(function(){_.forEach(u.formFieldProperties,function(e){_.includes(r,e.inputType)&&($("#"+e.code).dropdown("set selected",u.frameworkData[e.code]),e.depends&&e.depends.length&&u.getAssociations(u.frameworkData[e.code],e.range,function(o){u.applyDependencyRules(e,o,!1)}))}),u.configureDropdowns(!1,!1)},0),u.mapMasterCategoryList(u.formFieldProperties)}).catch(function(e){console.log("error is ......",e)})}}).catch(function(e){console.log("error is ......",e)}))}).catch(function(e){console.log("error is ......",e)})}}]);
"use strict";angular.module("playerApp").controller("profileBadgeController",["$rootScope","$scope","badgeService","toasterService",function(e,t,r,o){var a=this;a.badges=t.badgelist||[],a.type="user",a.getAllBadges=function(){var t=_.map(a.badges,"badgeId"),o={request:{filters:{badgeList:t,type:a.type,rootOrgId:e.rootOrgId}}};r.getDetailedBadgeAssertions(o,a.badges).then(function(e){a.badges=e}).catch(function(e){console.log("error = ",e)})}}]);