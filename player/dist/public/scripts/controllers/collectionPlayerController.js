"use strict";!function(){angular.module("loginApp").controller("CollectionPlayerCtrl",["$state","$timeout","contentService","$rootScope","$stateParams",function(e,n,o,a,t){var c=this;c.treeKey=0,c.loader={showLoader:!1,loaderMessage:"",enrollLoader:!1},c.error={showError:!1,message:"",messageType:"error",isClose:!1,showEnrollError:!1},c.collectionMeta={creator:"-",language:"-",gradeLevel:"-",subject:"-",medium:"-",lastUpdatedOn:"-",createdOn:"-"},c.showPlayer=!1,c.name=e.params.name,a.titleName=c.name,c.loadData=function(){c.loader.showLoader=!0,c.loader.loaderMessage=a.messages.stmsg.m0076,o.courseHierarchy(e.params.contentId).then(function(e){e&&"OK"===e.responseCode?(c.loader.showLoader=!1,e.result.content.children=_.sortBy(e.result.content.children,["index"]),c.courseHierachy=e.result.content,c.collectionMeta.creator=c.courseHierachy.creator,c.collectionMeta.language=c.courseHierachy.language,c.collectionMeta.gradeLevel=c.courseHierachy.gradeLevel,c.collectionMeta.subject=c.courseHierachy.subject,c.collectionMeta.medium=c.courseHierachy.medium,c.collectionMeta.lastUpdatedOn=c.courseHierachy.lastUpdatedOn,c.collectionMeta.createdOn=c.courseHierachy.createdOn,c.applyAccordion()):c.showError(a.messages.emsg.m0004)},function(){c.showError(a.messages.emsg.m0004)})},c.constructTree=function(e,n){c.fancyTree=[],angular.forEach(n,function(e,n){c.getTreeData(e,c.fancyTree)}),c.initializeFancyTree("#FT_"+e,c.fancyTree)},c.getTreeData=function(e,n){return"application/vnd.ekstep.content-collection"!==e.mimeType?(n.push({title:"<span id='node"+c.treeKey+"' class='padded'><i class='"+c.getContentIcon(e.mimeType)+"'></i>"+e.name+"</span>",key:c.treeKey,data:e,icon:!1}),c.treeKey+=1):(n.push({title:"<span class='courseAccordianDesc'><i class='"+c.getContentIcon(e.mimeType)+"'></i>"+e.name+"</span>",key:-1,children:[],icon:!1}),angular.forEach(e.children,function(o,a){c.getTreeData(e.children[a],n[n.length-1].children)})),c.fancyTree},c.initializeFancyTree=function(e,o){n(function(){$(e).fancytree({checkbox:!1,source:o,click:function(e,n){var o=n.node;-1!==o.key&&c.expandMe(o.key,o.data)},create:function(e,n){$(".fancytree-container").addClass("fancytree-connectors")}})},0)},c.expandMe=function(e,n){if(n&&n.mimeType&&"application/vnd.ekstep.content-collection"!==n.mimeType)c.playContent(n);else{var o=$(e.target).closest(".title").find("i");c.updateIcon(o,!$(o).hasClass("plus"))}},c.getContentIcon=function(e){return{"application/pdf":"large file pdf outline icon","image/jpeg":"large file image outline icon","image/jpg":"large file image outline icon","image/png":"large file image outline icon","video/mp4":"large file video outline icon","video/ogg":"large file video outline icon","video/youtube":"large youtube square icon","application/vnd.ekstep.html-archive":"large html5 icon","application/vnd.ekstep.ecml-archive":"large file archive outline icon","application/vnd.ekstep.content-collection":"large folder open outline icon grey icon"}[e]},c.updateIcon=function(e,n){n?$(e).addClass("plus").removeClass("minus"):$(e).addClass("minus").removeClass("plus")},c.applyAccordion=function(){n(function(){$(".ui.accordion").accordion({exclusive:!1})},100)},c.playContent=function(e){c.contentId=e.identifier,c.showPlayer=!0},c.closePlayer=function(){if("Profile"===t.backState)return void e.go(t.backState);""!==a.search.searchKeyword?n(function(){a.$emit("initSearch",{})},0):e.go("Resources")},c.loadData()}])}();