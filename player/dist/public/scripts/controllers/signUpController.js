"use strict";angular.module("loginApp").controller("SignUpCtrl",["signUpService","$timeout","$filter","$location","$rootScope","toasterService",function(e,s,a,r,o,t){var m=this,n=new Date;m.languages=o.frmelmnts.lbl.languages.split(","),m.formValidation=function(){$(".ui.form").form({fields:{userName:{rules:[{type:"regExp[^[-\\w.\\$@*\\!]{5,256}$]",prompt:o.messages.stmsg.m0087}]},password:{rules:[{type:"empty",prompt:o.messages.stmsg.m0088}]},firstName:{rules:[{type:"regExp[^[0-9]*[A-Za-z\\s][0-9A-Za-z\\s]*$]",prompt:o.messages.stmsg.m0092}]},phone:{rules:[{type:"regExp[^\\d{10}$]",prompt:o.messages.stmsg.m0091}]},email:{rules:[{type:"regExp[/^([a-zA-Z0-9_.+\\-])+\\@(([a-zA-Z0-9-])+\\.)+([a-zA-Z0-9]{2,4})+$/]",prompt:o.messages.stmsg.m0089}]},language:{rules:[{type:"empty",prompt:o.messages.stmsg.m0090}]}},onSuccess:function(){return!0},onFailure:function(){return!1}})},m.dropdown=function(){$("#headerSearchtab").dropdown(),$("#headerSearchmob").dropdown()},m.showModal=function(){m.firstName="",m.lastName="",m.password="",m.email="",m.userName="",m.phone="",m.language=[],s(function(){$(".ui.form").trigger("reset"),$(".ui.form .field.error").removeClass(o.messages.emsg.m0002),$(".ui.form.error").removeClass(o.messages.emsg.m0002),$(".dropdown").dropdown("clear"),$("ui.fluid.dropdown.signupMultiple").dropdown({placeholder:"Languages"}),$(".ui .modal").modal("show"),$("#signupModal").modal({closable:!1})}),s(function(){$("#dobCalendar").calendar({type:"date",maxDate:n,formatter:{date:function(e){return e?e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear():""}}})},1500)},m.formInit=function(){s(function(){$(".signupMultiple").dropdown(),$("#dobCalendar").calendar({type:"date",maxDate:n,formatter:{date:function(e){return e?e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear():""}}})},1500)},m.submitForm=function(){var e=$("#dobCalendar").calendar("get date");if(m.dob=a("date")(e,"yyyy-MM-dd"),m.formValidation(),!0!==$(".ui.form").form("validate form"))return $(".ui .modal").modal("refresh"),!1;m.signUp()},m.getErrorMsg=function(e){return"USER_ALREADY_EXIST"===e?o.messages.stmsg.m0085:"USERNAME_EMAIL_IN_USE"===e?o.messages.stmsg.m0086:o.messages.emsg.m0005},m.signUp=function(){m.request={params:{},request:{firstName:m.firstName,lastName:m.lastName,password:m.password,email:m.email,userName:m.userName.trim(),phone:m.phone,language:[m.language]}},m.loader=t.loader("",o.messages.stmsg.m0084);var a=m.request;$(".ui .modal").modal("show"),$("#signupModal").modal({closable:!1}),e.signUp(a).then(function(e){if(e&&"OK"===e.responseCode)m.loader.showLoader=!1,r.path("/private/index"),m.loader.showLoader=!1,t.success(o.messages.smsg.m0039),s(function(){$(".ui .modal").modal("hide")},2e3);else{m.loader.showLoader=!1;var a=_.get(e,"params.errmsg")||o.messages.fmsg.m0051;t.error(a)}}).catch(function(){m.loader.showLoader=!1,t.error(o.messages.emsg.m0005)})}}]);